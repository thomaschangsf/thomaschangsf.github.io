

<!doctype html>






<html  data-paige="Paige theme from https://github.com/willfaught/paige"   lang="en" >

    










    

    

    

    

    

    

    

    

    




<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    

    

<meta charset="utf-8">




    <meta content="Great book on how to implement data science from first principles." name="description">




<meta content="#0d6efd" name="msapplication-TileColor">


    <meta content="/browserconfig.xml" name="msapplication-config">


<meta content="https://github.com/willfaught/paige" name="theme">
<meta content="#0d6efd" name="theme-color">
<meta content="width=device-width, initial-scale=1" name="viewport">

<meta property="og:url" content="http://localhost:1313/books/machine-learning/data-science-from-scratch/">
  <meta property="og:title" content="DataScience From Scratch">
  <meta property="og:description" content="Great book on how to implement data science from first principles.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="books">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="DataScience From Scratch">
  <meta name="twitter:description" content="Great book on how to implement data science from first principles.">



    
        <title>DataScience From Scratch · Machine Learning ·  · Paige</title>
    

    


    <link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">



    <link href="/favicon.ico" rel="shortcut icon">



    <link href="/favicon.png" rel="icon" type="image/png">



    <link href="/favicon.svg" rel="icon" type="image/svg+xml">



    <link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">



    <link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">



    <link color="#0d6efd" href="/safari-pinned-tab.svg" rel="mask-icon">



    <link href="/site.webmanifest" rel="manifest">
























    

    
        
        
        
    

    
        
    

    
    
    


<link  crossorigin="anonymous"  href="/css/paige/bootstrap/6186ad141d391e4c0c10d2e9cb4eaeaadf75e809-paige.min.5a695f13e40d00e33dc2ef3b080efa570bbcc6991647824214ff6d7f4b20527e.css"  integrity="sha256-WmlfE&#43;QNAOM9wu87CA76Vwu8xpkWR4JCFP9tf0sgUn4="   referrerpolicy="no-referrer"  rel="stylesheet">



















    

    

    

    
    
    


<link  crossorigin="anonymous"  href="/css/paige/bootstrap-icons/bootstrap-icons.min.540116b7267d4b2410c74086ae6497566928c6d5715900be7ce7279ad45addcd.css"  integrity="sha256-VAEWtyZ9SyQQx0CGrmSXVmkoxtVxWQC&#43;fOcnmtRa3c0="   referrerpolicy="no-referrer"  rel="stylesheet">



    

















    

    

    

    
    
    


<link  crossorigin="anonymous"  href="/css/paige/katex/katex.min.min.c12d9cca9aa0af743d947ef8c8f5fabaad13e5b4c9fed061fbdf7c9d3c387581.css"  integrity="sha256-wS2cypqgr3Q9lH74yPX6uq0T5bTJ/tBh&#43;998nTw4dYE="   referrerpolicy="no-referrer"  rel="stylesheet">





    

<style>


.paige-figure-numbered {
    counter-increment: paige-figure-numbered;
}

.paige-figure-numbered > div > figure > figcaption::before {
    content: "Figure " counter(paige-figure-numbered) ": ";
}

.paige-figure-numbered > div > figure > figcaption:empty::before {
    content: "Figure " counter(paige-figure-numbered);
}

.paige-header-link {
    opacity: 0;
    margin-left: 0.5rem;
    position: absolute;
    transition: color 0.15s ease-in-out, opacity 0.15s ease-in-out;
}

.paige-header-link::after {
    content: "#";
}

.paige-quote .blockquote-footer {
    margin-top: 0;
}

.paige-quote blockquote {
    border-left: 0;
    border-right: 0;
    margin-bottom: 0;
    padding: 0;
}

#paige-content > * {
    margin-bottom: 1rem;
}

blockquote {
    padding: 0.5rem 1rem;
    border-left: 0.25rem solid var(--bs-border-color);
    border-right: 0.25rem solid var(--bs-body-bg);
}

td, th {
    padding: 0.25rem;
}

.highlight .chroma .hl,
.highlight .chroma .lnt {
    display: flex;
}

.paige-figure .paige-quote,
.paige-figure .paige-video,
.paige-figure .highlight pre.chroma,
.paige-figure .highlight .chroma pre,
.paige-figure .paige-quote blockquote,
.paige-figure figure > div > :last-child,
.paige-gallery .paige-figure,
.paige-gallery .paige-image,
blockquote > p:last-of-type {
    margin-bottom: 0;
}

.paige-figure,
.paige-gallery,
.paige-image,
.paige-quote,
.paige-video,
table {
    margin-bottom: 1rem;
}

.paige-header-link:focus,
.paige-header-link:hover,
:hover > .paige-header-link,
:target > .paige-header-link {
    opacity: 1;
}




    @media (prefers-color-scheme: dark) {
        /* Background */ .bg { color: #c9d1d9; background-color: var(--bs-body-bg); }
/* PreWrapper */ .chroma { color: #c9d1d9; background-color: var(--bs-body-bg); }
/* Other */ .chroma .x {  }
/* Error */ .chroma .err { color: #f85149 }
/* CodeLine */ .chroma .cl {  }
/* LineLink */ .chroma .lnlinks { outline: none; text-decoration: none; color: inherit }
/* LineTableTD */ .chroma .lntd { vertical-align: top; padding: 0; margin: 0; border: 0; }
/* LineTable */ .chroma .lntable { border-spacing: 0; padding: 0; margin: 0; border: 0; }
/* LineHighlight */ .chroma .hl { background-color: #4f4f4d }
/* LineNumbersTable */ .chroma .lnt { white-space: pre; user-select: none; margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #64686c }
/* LineNumbers */ .chroma .ln { white-space: pre; user-select: none; margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #6e7681 }
/* Line */ .chroma .line { display: flex; }
/* Keyword */ .chroma .k { color: #ff7b72 }
/* KeywordConstant */ .chroma .kc { color: #79c0ff }
/* KeywordDeclaration */ .chroma .kd { color: #ff7b72 }
/* KeywordNamespace */ .chroma .kn { color: #ff7b72 }
/* KeywordPseudo */ .chroma .kp { color: #79c0ff }
/* KeywordReserved */ .chroma .kr { color: #ff7b72 }
/* KeywordType */ .chroma .kt { color: #ff7b72 }
/* Name */ .chroma .n {  }
/* NameAttribute */ .chroma .na {  }
/* NameBuiltin */ .chroma .nb {  }
/* NameBuiltinPseudo */ .chroma .bp {  }
/* NameClass */ .chroma .nc { color: #f0883e; font-weight: bold }
/* NameConstant */ .chroma .no { color: #79c0ff; font-weight: bold }
/* NameDecorator */ .chroma .nd { color: #d2a8ff; font-weight: bold }
/* NameEntity */ .chroma .ni { color: #ffa657 }
/* NameException */ .chroma .ne { color: #f0883e; font-weight: bold }
/* NameFunction */ .chroma .nf { color: #d2a8ff; font-weight: bold }
/* NameFunctionMagic */ .chroma .fm {  }
/* NameLabel */ .chroma .nl { color: #79c0ff; font-weight: bold }
/* NameNamespace */ .chroma .nn { color: #ff7b72 }
/* NameOther */ .chroma .nx {  }
/* NameProperty */ .chroma .py { color: #79c0ff }
/* NameTag */ .chroma .nt { color: #7ee787 }
/* NameVariable */ .chroma .nv { color: #79c0ff }
/* NameVariableClass */ .chroma .vc {  }
/* NameVariableGlobal */ .chroma .vg {  }
/* NameVariableInstance */ .chroma .vi {  }
/* NameVariableMagic */ .chroma .vm {  }
/* Literal */ .chroma .l { color: #a5d6ff }
/* LiteralDate */ .chroma .ld { color: #79c0ff }
/* LiteralString */ .chroma .s { color: #a5d6ff }
/* LiteralStringAffix */ .chroma .sa { color: #79c0ff }
/* LiteralStringBacktick */ .chroma .sb { color: #a5d6ff }
/* LiteralStringChar */ .chroma .sc { color: #a5d6ff }
/* LiteralStringDelimiter */ .chroma .dl { color: #79c0ff }
/* LiteralStringDoc */ .chroma .sd { color: #a5d6ff }
/* LiteralStringDouble */ .chroma .s2 { color: #a5d6ff }
/* LiteralStringEscape */ .chroma .se { color: #79c0ff }
/* LiteralStringHeredoc */ .chroma .sh { color: #79c0ff }
/* LiteralStringInterpol */ .chroma .si { color: #a5d6ff }
/* LiteralStringOther */ .chroma .sx { color: #a5d6ff }
/* LiteralStringRegex */ .chroma .sr { color: #79c0ff }
/* LiteralStringSingle */ .chroma .s1 { color: #a5d6ff }
/* LiteralStringSymbol */ .chroma .ss { color: #a5d6ff }
/* LiteralNumber */ .chroma .m { color: #a5d6ff }
/* LiteralNumberBin */ .chroma .mb { color: #a5d6ff }
/* LiteralNumberFloat */ .chroma .mf { color: #a5d6ff }
/* LiteralNumberHex */ .chroma .mh { color: #a5d6ff }
/* LiteralNumberInteger */ .chroma .mi { color: #a5d6ff }
/* LiteralNumberIntegerLong */ .chroma .il { color: #a5d6ff }
/* LiteralNumberOct */ .chroma .mo { color: #a5d6ff }
/* Operator */ .chroma .o { color: #ff7b72; font-weight: bold }
/* OperatorWord */ .chroma .ow { color: #ff7b72; font-weight: bold }
/* Punctuation */ .chroma .p {  }
/* Comment */ .chroma .c { color: #8b949e; font-style: italic }
/* CommentHashbang */ .chroma .ch { color: #8b949e; font-style: italic }
/* CommentMultiline */ .chroma .cm { color: #8b949e; font-style: italic }
/* CommentSingle */ .chroma .c1 { color: #8b949e; font-style: italic }
/* CommentSpecial */ .chroma .cs { color: #8b949e; font-weight: bold; font-style: italic }
/* CommentPreproc */ .chroma .cp { color: #8b949e; font-weight: bold; font-style: italic }
/* CommentPreprocFile */ .chroma .cpf { color: #8b949e; font-weight: bold; font-style: italic }
/* Generic */ .chroma .g {  }
/* GenericDeleted */ .chroma .gd { color: #ffa198; background-color: #490202 }
/* GenericEmph */ .chroma .ge { font-style: italic }
/* GenericError */ .chroma .gr { color: #ffa198 }
/* GenericHeading */ .chroma .gh { color: #79c0ff; font-weight: bold }
/* GenericInserted */ .chroma .gi { color: #56d364; background-color: #0f5323 }
/* GenericOutput */ .chroma .go { color: #8b949e }
/* GenericPrompt */ .chroma .gp { color: #8b949e }
/* GenericStrong */ .chroma .gs { font-weight: bold }
/* GenericSubheading */ .chroma .gu { color: #79c0ff }
/* GenericTraceback */ .chroma .gt { color: #ff7b72 }
/* GenericUnderline */ .chroma .gl { text-decoration: underline }
/* TextWhitespace */ .chroma .w { color: #6e7681 }

    }

    @media (prefers-color-scheme: light) {
        /* Background */ .bg { background-color: #ffffff; }
/* PreWrapper */ .chroma { background-color: #ffffff; }
/* Other */ .chroma .x {  }
/* Error */ .chroma .err { color: #a61717; background-color: #e3d2d2 }
/* CodeLine */ .chroma .cl {  }
/* LineLink */ .chroma .lnlinks { outline: none; text-decoration: none; color: inherit }
/* LineTableTD */ .chroma .lntd { vertical-align: top; padding: 0; margin: 0; border: 0; }
/* LineTable */ .chroma .lntable { border-spacing: 0; padding: 0; margin: 0; border: 0; }
/* LineHighlight */ .chroma .hl { background-color: #ffffcc }
/* LineNumbersTable */ .chroma .lnt { white-space: pre; user-select: none; margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #7f7f7f }
/* LineNumbers */ .chroma .ln { white-space: pre; user-select: none; margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #7f7f7f }
/* Line */ .chroma .line { display: flex; }
/* Keyword */ .chroma .k { color: #000000; font-weight: bold }
/* KeywordConstant */ .chroma .kc { color: #000000; font-weight: bold }
/* KeywordDeclaration */ .chroma .kd { color: #000000; font-weight: bold }
/* KeywordNamespace */ .chroma .kn { color: #000000; font-weight: bold }
/* KeywordPseudo */ .chroma .kp { color: #000000; font-weight: bold }
/* KeywordReserved */ .chroma .kr { color: #000000; font-weight: bold }
/* KeywordType */ .chroma .kt { color: #445588; font-weight: bold }
/* Name */ .chroma .n {  }
/* NameAttribute */ .chroma .na { color: #008080 }
/* NameBuiltin */ .chroma .nb { color: #0086b3 }
/* NameBuiltinPseudo */ .chroma .bp { color: #999999 }
/* NameClass */ .chroma .nc { color: #445588; font-weight: bold }
/* NameConstant */ .chroma .no { color: #008080 }
/* NameDecorator */ .chroma .nd { color: #3c5d5d; font-weight: bold }
/* NameEntity */ .chroma .ni { color: #800080 }
/* NameException */ .chroma .ne { color: #990000; font-weight: bold }
/* NameFunction */ .chroma .nf { color: #990000; font-weight: bold }
/* NameFunctionMagic */ .chroma .fm {  }
/* NameLabel */ .chroma .nl { color: #990000; font-weight: bold }
/* NameNamespace */ .chroma .nn { color: #555555 }
/* NameOther */ .chroma .nx {  }
/* NameProperty */ .chroma .py {  }
/* NameTag */ .chroma .nt { color: #000080 }
/* NameVariable */ .chroma .nv { color: #008080 }
/* NameVariableClass */ .chroma .vc { color: #008080 }
/* NameVariableGlobal */ .chroma .vg { color: #008080 }
/* NameVariableInstance */ .chroma .vi { color: #008080 }
/* NameVariableMagic */ .chroma .vm {  }
/* Literal */ .chroma .l {  }
/* LiteralDate */ .chroma .ld {  }
/* LiteralString */ .chroma .s { color: #dd1144 }
/* LiteralStringAffix */ .chroma .sa { color: #dd1144 }
/* LiteralStringBacktick */ .chroma .sb { color: #dd1144 }
/* LiteralStringChar */ .chroma .sc { color: #dd1144 }
/* LiteralStringDelimiter */ .chroma .dl { color: #dd1144 }
/* LiteralStringDoc */ .chroma .sd { color: #dd1144 }
/* LiteralStringDouble */ .chroma .s2 { color: #dd1144 }
/* LiteralStringEscape */ .chroma .se { color: #dd1144 }
/* LiteralStringHeredoc */ .chroma .sh { color: #dd1144 }
/* LiteralStringInterpol */ .chroma .si { color: #dd1144 }
/* LiteralStringOther */ .chroma .sx { color: #dd1144 }
/* LiteralStringRegex */ .chroma .sr { color: #009926 }
/* LiteralStringSingle */ .chroma .s1 { color: #dd1144 }
/* LiteralStringSymbol */ .chroma .ss { color: #990073 }
/* LiteralNumber */ .chroma .m { color: #009999 }
/* LiteralNumberBin */ .chroma .mb { color: #009999 }
/* LiteralNumberFloat */ .chroma .mf { color: #009999 }
/* LiteralNumberHex */ .chroma .mh { color: #009999 }
/* LiteralNumberInteger */ .chroma .mi { color: #009999 }
/* LiteralNumberIntegerLong */ .chroma .il { color: #009999 }
/* LiteralNumberOct */ .chroma .mo { color: #009999 }
/* Operator */ .chroma .o { color: #000000; font-weight: bold }
/* OperatorWord */ .chroma .ow { color: #000000; font-weight: bold }
/* Punctuation */ .chroma .p {  }
/* Comment */ .chroma .c { color: #999988; font-style: italic }
/* CommentHashbang */ .chroma .ch { color: #999988; font-style: italic }
/* CommentMultiline */ .chroma .cm { color: #999988; font-style: italic }
/* CommentSingle */ .chroma .c1 { color: #999988; font-style: italic }
/* CommentSpecial */ .chroma .cs { color: #999999; font-weight: bold; font-style: italic }
/* CommentPreproc */ .chroma .cp { color: #999999; font-weight: bold; font-style: italic }
/* CommentPreprocFile */ .chroma .cpf { color: #999999; font-weight: bold; font-style: italic }
/* Generic */ .chroma .g {  }
/* GenericDeleted */ .chroma .gd { color: #000000; background-color: #ffdddd }
/* GenericEmph */ .chroma .ge { color: #000000; font-style: italic }
/* GenericError */ .chroma .gr { color: #aa0000 }
/* GenericHeading */ .chroma .gh { color: #999999 }
/* GenericInserted */ .chroma .gi { color: #000000; background-color: #ddffdd }
/* GenericOutput */ .chroma .go { color: #888888 }
/* GenericPrompt */ .chroma .gp { color: #555555 }
/* GenericStrong */ .chroma .gs { font-weight: bold }
/* GenericSubheading */ .chroma .gu { color: #aaaaaa }
/* GenericTraceback */ .chroma .gt { color: #aa0000 }
/* GenericUnderline */ .chroma .gl { text-decoration: underline }
/* TextWhitespace */ .chroma .w { color: #bbbbbb }

    }


@media (prefers-reduced-motion: reduce) {
    .paige-header-link {
        transition: none;
    }
}




</style>


    
</head>

    <body class="d-flex flex-column">

        

        <div class="container flex-fill" id="paige-root">
            <div class="row">
                <div class="col">
                    
                    


    <header class="my-3" id="paige-header">
        

        




        








    





    



    <nav>
        <ul class="align-items-center justify-content-center nav ">
            
                
                
                
                
                

                <li class="nav-item ">
                    <a   class="  nav-link   text-decoration-underline "  href="/"    >Home</a>

                    
                </li>
            
                
                
                
                
                

                <li class="nav-item ">
                    <a  aria-current="page"   class=" active  text-body-emphasis    nav-link   text-decoration-underline "  href="/books/"    >Books</a>

                    
                </li>
            
                
                
                
                
                

                <li class="nav-item ">
                    <a   class="  nav-link   text-decoration-underline "  href="/blogs/"    >Blogs</a>

                    
                </li>
            
                
                
                
                
                

                <li class="nav-item ">
                    <a   class="  nav-link   text-decoration-underline "  href="/resume/"    >Resume</a>

                    
                </li>
            
                
                
                
                
                

                <li class="nav-item ">
                    <a   class="  nav-link   text-decoration-underline "  href="/github/"    >Github</a>

                    
                </li>
            
                
                
                
                
                

                <li class="nav-item ">
                    <a   class="  nav-link   text-decoration-underline "  href="/search/"    >Search</a>

                    
                </li>
            
        </ul>
    </nav>


        

        
    </header>



                    <main class="mt-3" id="paige-main">
                        

                        



















    



    
        
    




<article  class="paige-published paige-single"  id="paige-article">
    <div class="align-items-center d-flex flex-column mb-0">
        













<div class="mw-100" id="paige-metadata">
    
        <h1 class="fw-bold text-center" id="paige-title">DataScience From Scratch</h1>
    

    
        <p class="lead text-center" id="paige-description">Great book on how to implement data science from first principles.</p>
    

    
        <div class="mb-3">
            

            

            

            

            
                <p class="mb-0 text-center text-secondary" id="paige-reading-time">65 minutes</p>
            
        </div>
    
</div>

        



        


    <div class="mw-100" id="paige-toc">
        <div class="border mb-3 pe-3 ps-3 pt-3 rounded">
            <nav id="TableOfContents">
  <ol>
    <li>
      <ol>
        <li><a href="#31-matplotlib">3.1 matplotlib</a></li>
        <li><a href="#32-bar-charts">3.2 Bar Charts</a></li>
        <li><a href="#33-line-charts">3.3 Line Charts</a></li>
        <li><a href="#34-scatter-plots">3.4 Scatter Plots</a></li>
        <li><a href="#35-further-exploration">3.5 Further Exploration</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#41-vectors">4.1 Vectors</a></li>
        <li><a href="#42-matrices">4.2 Matrices</a></li>
        <li><a href="#43-further-exploration">4.3 Further Exploration</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#51-describing-a-single-set-of-data">5.1 Describing a Single Set of Data</a></li>
        <li><a href="#52-correlation">5.2 Correlation</a></li>
        <li><a href="#53-simpsons-paradox">5.3 Simpson&rsquo;s Paradox</a></li>
        <li><a href="#54-other-correlation-caveats">5.4 Other Correlation Caveats</a></li>
        <li><a href="#55-correlation-and-causation">5.5 Correlation and Causation</a></li>
        <li><a href="#56-further-exploration">5.6 Further Exploration</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#61-dependence-and-independence">6.1 Dependence and Independence</a></li>
        <li><a href="#62-conditional-probability">6.2 Conditional Probability</a></li>
        <li><a href="#63-bayes-theorem">6.3 Baye&rsquo;s Theorem</a></li>
        <li><a href="#64-random-variables">6.4 Random Variables</a></li>
        <li><a href="#65-continuous-distribution">6.5 Continuous Distribution</a></li>
        <li><a href="#66-normal-distribution">6.6 Normal Distribution</a></li>
        <li><a href="#67-central-limit-theorem">6.7 Central Limit Theorem</a></li>
        <li><a href="#68-further-exploration">6.8 Further Exploration</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#71--statistical-hypothesis-testing">7.1  Statistical Hypothesis Testing</a></li>
        <li><a href="#72-example-flipping-a-coin">7.2 Example: Flipping a Coin</a></li>
        <li><a href="#74-approach-3-confidence-intervals">7.4 Approach 3: Confidence Intervals</a></li>
        <li><a href="#75-p-hacking">7.5 p-Hacking</a></li>
        <li><a href="#76-example-running-on-ab-test">7.6 Example: Running on A/B Test</a></li>
        <li><a href="#77-approach-4-bayesian-inference">7.7 Approach 4: Bayesian Inference</a></li>
        <li><a href="#78-further-exploration">7.8 Further Exploration</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#81-estimating-gradient">8.1 Estimating Gradient</a></li>
        <li><a href="#using-the-gradient">Using the Gradient</a></li>
        <li><a href="#choosing-the-right-step-size">Choosing the Right Step Size</a></li>
        <li><a href="#using-gradient-descent-to-fit-models">Using Gradient Descent to Fit Models</a></li>
        <li><a href="#mini-batch-and-stochastic-gradient-descent">Mini-batch and Stochastic Gradient Descent</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#91-stdin-and-stdout">9.1 stdin and stdout</a></li>
        <li><a href="#94-using-the-apis">9.4 Using the APIs</a></li>
        <li><a href="#95-using-twitter-apis">9.5 Using Twitter APIs</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#101-exploring-your-data">10.1 Exploring Your data</a></li>
        <li><a href="#102-using-named-tuples-to-model-data">10.2 Using Named Tuples To Model Data</a></li>
        <li><a href="#103-dataclasses">10.3 Dataclasses</a></li>
        <li><a href="#104-cleaning-and-munging">10.4 Cleaning and Munging</a></li>
        <li><a href="#105-manipulating-data">10.5 Manipulating data</a></li>
        <li><a href="#106-rescaling">10.6 Rescaling</a></li>
        <li><a href="#107-tqdm">10.7 TQDM</a></li>
        <li><a href="#108-dimension-reduction">10.8 Dimension Reduction</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#111-modeling">11.1 Modeling</a></li>
        <li><a href="#112-what-is-ml">11.2 What is ML?</a></li>
        <li><a href="#113-overfitting-and-underfitting">11.3 Overfitting and Underfitting</a></li>
        <li><a href="#114-bias-variance-tradeoffs">11.4 Bias Variance TradeOffs</a></li>
        <li><a href="#115-feature-extraction-and-selection">11.5 Feature Extraction and Selection</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#121-the-model">12.1 The Model</a></li>
        <li><a href="#122-example-iris-dataset">12.2 Example: Iris Dataset</a></li>
        <li><a href="#123-curse-of-dimensionality">12.3 Curse of Dimensionality</a></li>
        <li><a href="#124-further-exploration">12.4 Further Exploration</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#131-really-dumb-spam-filter">13.1 Really Dumb Spam Filter</a></li>
        <li><a href="#132-more-sophisticated-spam-filter">13.2 More Sophisticated Spam Filter</a></li>
        <li><a href="#133-implementation">13.3 Implementation</a></li>
        <li><a href="#134-testing">13.4 Testing</a></li>
        <li><a href="#135-using-the-model">13.5 Using The Model</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#141-the-model">14.1 The Model</a></li>
        <li><a href="#142-using-gradient-descent">14.2 Using Gradient Descent</a></li>
        <li><a href="#143-maximum-liklihood-estmation-mle">14.3 Maximum Liklihood Estmation (MLE)</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#15-1-the-model">15. 1 The Model</a></li>
        <li><a href="#15-2-further-assumptions-of-least-squares-model">15. 2 Further Assumptions of Least Squares Model</a></li>
        <li><a href="#153-fitting-the-model">15.3 Fitting the Model</a></li>
        <li><a href="#154-interpreting-the-model">15.4 Interpreting the Model</a></li>
        <li><a href="#155-goodness-of-fit">15.5 Goodness of Fit</a></li>
        <li><a href="#156-the-bootstrap">15.6 The Bootstrap</a></li>
        <li><a href="#157-standard-errors-of-regression-coefficient">15.7 Standard Errors of Regression Coefficient</a></li>
        <li><a href="#158-regularization">15.8 Regularization</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#161-the-problem">16.1 The Problem</a></li>
        <li><a href="#162-the-logistic-function">16.2 The Logistic Function</a></li>
        <li><a href="#163-applying-the-model">16.3 Applying the Model</a></li>
        <li><a href="#164-goodness-of-fit">16.4 Goodness of Fit</a></li>
        <li><a href="#165-support-vector-machines">16.5 Support Vector Machines</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#171-what-is-a-decision-tree">17.1 What is a Decision Tree</a></li>
        <li><a href="#172-entropy">17.2 Entropy</a></li>
        <li><a href="#173-entropy-of-a-partition">17.3 Entropy of a Partition</a></li>
        <li><a href="#174-creating-a-decision-tree">17.4 Creating a Decision Tree</a>
          <ol>
            <li>
              <ol>
                <li><a href="#1741-example-decision-tree-to-see-whether-to-interview-someone-based-on-the-features-level-language-tweets-and-phd">17.4.1 Example: Decision tree to see whether to interview someone based on the features level, language, tweets, and phd</a></li>
              </ol>
            </li>
          </ol>
        </li>
        <li><a href="#175-putting-it-all-together">17.5 Putting It All Together</a></li>
        <li><a href="#176-random-forests">17.6 Random Forests</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#181-perceptrons">18.1 Perceptrons</a></li>
        <li><a href="#182-feed-forward-neural-network">18.2 Feed Forward Neural Network</a></li>
        <li><a href="#183-back-propagation">18.3 Back propagation</a></li>
        <li><a href="#184-example-fiz-fuzz">18.4 Example: Fiz Fuzz</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#191-the-tensor">19.1 The Tensor</a></li>
        <li><a href="#192-the-layer-abstraction">19.2 The Layer Abstraction</a></li>
        <li><a href="#193-linear-layer">19.3 Linear Layer</a></li>
        <li><a href="#194-nn-as-a-sequence-of-layers">19.4 NN As a Sequence of Layers</a></li>
        <li><a href="#195-loss-and-optimization">19.5 Loss and Optimization</a></li>
        <li><a href="#196-example-xor-revisited">19.6 Example: XOR Revisited</a></li>
        <li><a href="#197-other-activation-functions">19.7 Other Activation Functions</a></li>
        <li><a href="#198-fizzbuzz-revisited">19.8 FizzBuzz Revisited</a></li>
        <li><a href="#199-softmaxes-and-cross-entropy">19.9 Softmaxes and Cross Entropy</a></li>
        <li><a href="#1910-dropout">19.10 Dropout</a></li>
        <li><a href="#1911-example-mnist">19.11 Example: MNIST</a></li>
        <li><a href="#1912-saving-and-loading-models">19.12 Saving and Loading Models</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#201-the-idea-k-means">20.1 The Idea (K-Means)</a></li>
        <li><a href="#202-the-model">20.2 The Model</a></li>
        <li><a href="#203-example-meetups">20.3 Example: Meetups</a></li>
        <li><a href="#204-choosing-k">20.4 Choosing K</a></li>
        <li><a href="#205-example-clustering-colors">20.5 Example: Clustering Colors</a></li>
        <li><a href="#206-bottom-up-hierarchical-clustering">20.6 Bottom Up Hierarchical Clustering</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#211-word-clouds">21.1 Word Clouds</a></li>
        <li><a href="#212-n-gram-language-models">21.2 n-Gram Language Models</a></li>
        <li><a href="#213-grammers">21.3 Grammers</a></li>
        <li><a href="#214-gibbs-sampling">21.4 Gibbs Sampling</a></li>
        <li><a href="#215-topics-modeling">21.5 ==Topics Modeling==</a></li>
        <li><a href="#216-word-vectors">21.6 ==Word Vectors==</a></li>
        <li><a href="#217-rnn">21.7 RNN</a></li>
        <li><a href="#218-example-using-a-character-level-rnn">21.8 Example: Using a Character Level RNN</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#221-betweenness-centrality">22.1 Betweenness Centrality</a></li>
        <li><a href="#222-eigenvector-centrality">22.2 Eigenvector Centrality</a></li>
        <li><a href="#223-directed-graphs-and-page-ranks">22.3 Directed Graphs and Page Ranks</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#231-manual-curations">23.1 Manual Curations</a></li>
        <li><a href="#232-recommending-whats-popular">23.2 Recommending What&rsquo;s Popular</a></li>
        <li><a href="#233-user-based-collaborative-filtering">23.3 User Based Collaborative Filtering</a></li>
        <li><a href="#234-item-based-collaborative-filtering">23.4 Item Based Collaborative Filtering</a></li>
        <li><a href="#235-matrix-factorization">23.5 Matrix Factorization</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#241-create-and-insert">24.1 Create and Insert</a></li>
        <li><a href="#242-update">24.2 Update</a></li>
        <li><a href="#243-delete">24.3 Delete</a></li>
        <li><a href="#244-select">24.4 Select</a></li>
        <li><a href="#245-group-by">24.5 Group By</a></li>
        <li><a href="#246-order-by">24.6 Order By</a></li>
        <li><a href="#247-join">24.7 Join</a></li>
        <li><a href="#248-query-optimization">24.8 Query Optimization</a></li>
        <li><a href="#249-nosql">24.9 NoSQL</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#251-example-word-count">25.1 Example: Word Count</a></li>
        <li><a href="#252-why-mapreduce">25.2 Why MapReduce</a></li>
        <li><a href="#253-mapreduce-more-generally">25.3 MapReduce More Generally</a></li>
        <li><a href="#254-example-analyzing-status-update">25.4 Example: Analyzing Status Update</a></li>
        <li><a href="#255-example-matrix-multiplication">25.5 Example: Matrix Multiplication</a></li>
        <li><a href="#256-combiners">25.6 Combiners</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </div>


        




    <div class="mw-100" id="paige-content"><h1 id="1-introduction">1 Introduction<a aria-label="Link to this section" class="paige-header-link" href="#1-introduction"></a></h1>
<h1 id="2-crash-course-in-python">2 Crash Course In Python<a aria-label="Link to this section" class="paige-header-link" href="#2-crash-course-in-python"></a></h1>
<p><em>Tuples</em></p>
<ul>
<li>List&rsquo;s immutable cousin</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">my_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">other_tuple</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">my_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>      <span class="c1"># my_list is now [1, 3]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">my_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;cannot modify a tuple&#34;</span><span class="p">)</span>
</span></span></code></pre></div><ul>
<li>convenient way to return multiple values and multiple assignment</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">sum_and_product</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sp</span> <span class="o">=</span> <span class="n">sum_and_product</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>     <span class="c1"># now x is 1, y is 2</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span>     <span class="c1"># Pythonic way to swap variables; now x is 2, y is 1</span>
</span></span></code></pre></div><p><em>Dict</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Literal assignment</span>
</span></span><span class="line"><span class="cl"><span class="n">grades</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;Joel&#34;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="s2">&#34;Tim&#34;</span><span class="p">:</span> <span class="mi">95</span><span class="p">}</span>    <span class="c1"># dictionary literal</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Access non-existent key will throw KeyError exception</span>
</span></span><span class="line"><span class="cl"><span class="n">grade</span><span class="p">[</span><span class="s2">&#34;Kate&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Better way; </span>
</span></span><span class="line"><span class="cl"><span class="c1"># defaults to None</span>
</span></span><span class="line"><span class="cl"><span class="n">grades</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;Kate&#34;</span><span class="p">)</span> <span class="c1"># or grades.get(&#34;Kate&#34;, 0)</span>
</span></span></code></pre></div><p><em>DefaultDict</em></p>
<ul>
<li>Handling non-existent keys is cumbersome; defaultdict can help for various types, such as int, list.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">word_counts</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>          <span class="c1"># int() produces 0</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">document</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">word_counts</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dd_list</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>             <span class="c1"># list() produces an empty list</span>
</span></span><span class="line"><span class="cl"><span class="n">dd_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                    <span class="c1"># now dd_list contains {2: [1]}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dd_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>             <span class="c1"># dict() produces an empty dict</span>
</span></span><span class="line"><span class="cl"><span class="n">dd_dict</span><span class="p">[</span><span class="s2">&#34;Joel&#34;</span><span class="p">][</span><span class="s2">&#34;City&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;Seattle&#34;</span>     <span class="c1"># {&#34;Joel&#34; : {&#34;City&#34;: Seattle&#34;}}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dd_pair</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">dd_pair</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>                       <span class="c1"># now dd_pair contains {2: [0, 1]}</span>
</span></span></code></pre></div><p><em>Counters</em></p>
<ul>
<li>Turns a sequence of values into a defauldict(int)</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>          <span class="c1"># c is (basically) {0: 2, 1: 1, 2:1}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># recall, document is a list of words</span>
</span></span><span class="line"><span class="cl"><span class="n">word_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">word_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># returns top 10 common word</span>
</span></span></code></pre></div><p><em>Set</em></p>
<ul>
<li>if you want fast lookup time, use a set and not a tuple</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">primes_below_10</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">}</span>
</span></span></code></pre></div><p><em>Truthiness</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># None indicates nonexistent value</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="p">{}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;Something&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="c1"># more pythonic than x == None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Empty containers and values are Falsy</span>
</span></span><span class="line"><span class="cl"><span class="c1"># [], {}, set, 0, </span>
</span></span></code></pre></div><p><em>Sorting a List</em></p>
<ul>
<li>2 methods
<ul>
<li>sort method sorts in place</li>
<li>sorted returns a new list</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>     <span class="c1"># y is [1, 2, 3, 4], x is unchanged</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>          <span class="c1"># now x is [1, 2, 3, 4]</span>
</span></span></code></pre></div><ul>
<li>By default, sort in ascending order. To reverse, we have two options</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># sort the list by absolute value from largest to smallest</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="nb">abs</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># is [-4, 3, -2, 1]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># sort the words and counts from highest count to lowest</span>
</span></span><span class="line"><span class="cl"><span class="n">wc</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">word_counts</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">word_and_count</span><span class="p">:</span> <span class="n">word_and_count</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></div><p><em>Generators</em></p>
<ul>
<li>Generators are useful when you need to access 1 element at a time; unlike lists where all the elements are stored in memory</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">generate_range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">yield</span> <span class="n">i</span>   <span class="c1"># every call to yield produces a value of the generator</span>
</span></span><span class="line"><span class="cl">        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">generate_range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;i: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><ul>
<li>Iterable signifies it&rsquo;s lazy</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="n">evens</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span></span></code></pre></div><p><em>Regular Expressions</em></p>
<ul>
<li>Fairly complex and powerful module for expression matching
<ul>
<li><a href="https://docs.python.org/3/library/re.html">doc</a></li>
</ul>
</li>
<li>re.match checks whether the beginning of a string matches a regular expression</li>
<li>re.search checks whether any part of a string matches a regular expression.</li>
<li>Example</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">re_examples</span> <span class="o">=</span> <span class="p">[</span>                        <span class="c1"># All of these are True, because</span>
</span></span><span class="line"><span class="cl">    <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="s2">&#34;a&#34;</span><span class="p">,</span> <span class="s2">&#34;cat&#34;</span><span class="p">),</span>              <span class="c1">#  &#39;cat&#39; doesn&#39;t start with &#39;a&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&#34;a&#34;</span><span class="p">,</span> <span class="s2">&#34;cat&#34;</span><span class="p">),</span>                 <span class="c1">#  &#39;cat&#39; has an &#39;a&#39; in it</span>
</span></span><span class="line"><span class="cl">    <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&#34;c&#34;</span><span class="p">,</span> <span class="s2">&#34;dog&#34;</span><span class="p">),</span>             <span class="c1">#  &#39;dog&#39; doesn&#39;t have a &#39;c&#39; in it.</span>
</span></span><span class="line"><span class="cl">    <span class="mi">3</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;[ab]&#34;</span><span class="p">,</span> <span class="s2">&#34;carbs&#34;</span><span class="p">)),</span>   <span class="c1">#  Split on a or b to [&#39;c&#39;,&#39;r&#39;,&#39;s&#39;].</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;R-D-&#34;</span> <span class="o">==</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&#34;[0-9]&#34;</span><span class="p">,</span> <span class="s2">&#34;-&#34;</span><span class="p">,</span> <span class="s2">&#34;R2D2&#34;</span><span class="p">)</span> <span class="c1">#  Replace digits with dashes.</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">re_examples</span><span class="p">),</span> <span class="s2">&#34;all the regex examples should be True&#34;</span>
</span></span></code></pre></div><p><em>args and kwargs</em></p>
<ul>
<li>
<p>args and kwargs enables one to specify a function that takes arbitrary arguments</p>
<ul>
<li>args is a tuple of its unnamed arguments</li>
<li>kwargs is a dict of its named arguments</li>
</ul>
</li>
<li>
<p>Simple example</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">magic</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;unnamed args:&#34;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;keyword args:&#34;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">magic</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&#34;word&#34;</span><span class="p">,</span> <span class="n">key2</span><span class="o">=</span><span class="s2">&#34;word2&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># prints</span>
</span></span><span class="line"><span class="cl"><span class="c1">#  unnamed args: (1, 2)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#  keyword args: {&#39;key&#39;: &#39;word&#39;, &#39;key2&#39;: &#39;word2&#39;}</span>
</span></span></code></pre></div><ul>
<li>More complex function with high order function (function that takes a function as its input)</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">doubler_correct</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;works no matter what kind of inputs f expects&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;whatever arguments g is supplied, pass them through to f&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">g</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">doubler_correct</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">g</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&#34;doubler should work now&#34;</span>
</span></span></code></pre></div><p><em>Type Annotation</em></p>
<ul>
<li>Python is dynamically typed;  types operations are loosely enforced as long as it runs</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">add</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mi">15</span><span class="p">,</span>                  <span class="s2">&#34;+ is valid for numbers&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">add</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>     <span class="s2">&#34;+ is valid for lists&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">add</span><span class="p">(</span><span class="s2">&#34;hi &#34;</span><span class="p">,</span> <span class="s2">&#34;there&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&#34;hi there&#34;</span><span class="p">,</span> <span class="s2">&#34;+ is valid for strings&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">add</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&#34;five&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;cannot add an int to a string&#34;</span><span class="p">)</span>
</span></span></code></pre></div><ul>
<li>
<p>While python does not enforce strict type, type annotation in python has these benefits</p>
<ul>
<li>types are a form of documentation</li>
<li>External tools (ie mypy) leverages types
<ul>
<li>autocompletion</li>
</ul>
</li>
<li>Thinking about types may help/highlight need for simpler design</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Hmm.. is operation too wide?  we are allowing so many different operators</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">ugly_function</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="n">operation</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span></span></code></pre></div></li>
<li>
<p>Some Types in typing module</p>
<ul>
<li>Dict, Iterable, Tuple</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Tuple</span>
</span></span><span class="line"><span class="cl"><span class="c1"># keys are strings, values are ints</span>
</span></span><span class="line"><span class="cl"><span class="n">counts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1"># lists and generators are both iterable</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">lazy</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">evens</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">evens</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># tuples specify a type for each element</span>
</span></span><span class="line"><span class="cl"><span class="n">triple</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span></span></code></pre></div><ul>
<li>Optional</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
</span></span><span class="line"><span class="cl"><span class="n">best_so_far</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># allowed to be either a float or None</span>
</span></span></code></pre></div><ul>
<li>Callable is a type annotation for function</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># The type hint says that repeater is a function that takes</span>
</span></span><span class="line"><span class="cl"><span class="c1"># two arguments, a string and an int, and returns a string.</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">twice</span><span class="p">(</span><span class="n">repeater</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span> <span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">repeater</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">comma_repeater</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">n_copies</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">n_copies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">twice</span><span class="p">(</span><span class="n">comma_repeater</span><span class="p">,</span> <span class="s2">&#34;type hints&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&#34;type hints, type hints&#34;</span>
</span></span></code></pre></div></li>
</ul>
<h1 id="3--visualizing-data">3  Visualizing Data<a aria-label="Link to this section" class="paige-header-link" href="#3--visualizing-data"></a></h1>
<h3 id="31-matplotlib">3.1 matplotlib<a aria-label="Link to this section" class="paige-header-link" href="#31-matplotlib"></a></h3>
<ul>
<li>matplotlib python module is good for basic visualizations (bar, line, scatter). For more interactive alternatives, see section 5.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1950</span><span class="p">,</span> <span class="mi">1960</span><span class="p">,</span> <span class="mi">1970</span><span class="p">,</span> <span class="mi">1980</span><span class="p">,</span> <span class="mi">1990</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2010</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">gdp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">300.2</span><span class="p">,</span> <span class="mf">543.3</span><span class="p">,</span> <span class="mf">1075.9</span><span class="p">,</span> <span class="mf">2862.5</span><span class="p">,</span> <span class="mf">5979.6</span><span class="p">,</span> <span class="mf">10289.7</span><span class="p">,</span> <span class="mf">14958.3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># create a line chart, years on x-axis, gdp on y-axis</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">gdp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># add a title</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Nominal GDP&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># add a label to the y-axis</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;Billions of $&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><h3 id="32-bar-charts">3.2 Bar Charts<a aria-label="Link to this section" class="paige-header-link" href="#32-bar-charts"></a></h3>
<p><em>Basic Example</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">movies</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Annie Hall&#34;</span><span class="p">,</span> <span class="s2">&#34;Ben-Hur&#34;</span><span class="p">,</span> <span class="s2">&#34;Casablanca&#34;</span><span class="p">,</span> <span class="s2">&#34;Gandhi&#34;</span><span class="p">,</span> <span class="s2">&#34;West Side Story&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">num_oscars</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># plot bars with left x-coordinates [0, 1, 2, 3, 4], heights [num_oscars]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">movies</span><span class="p">)),</span> <span class="n">num_oscars</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;My Favorite Movies&#34;</span><span class="p">)</span>     <span class="c1"># add a title</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;# of Academy Awards&#34;</span><span class="p">)</span>   <span class="c1"># label the y-axis</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># label x-axis with movie names at bar centers</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">movies</span><span class="p">)),</span> <span class="n">movies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><p>_Histograms: Buckets _</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</span></span><span class="line"><span class="cl"><span class="n">grades</span> <span class="o">=</span> <span class="p">[</span><span class="mi">83</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Bucket grades by decile, but put 100 in with the 90s</span>
</span></span><span class="line"><span class="cl"><span class="n">histogram</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">grade</span> <span class="o">//</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span> <span class="k">for</span> <span class="n">grade</span> <span class="ow">in</span> <span class="n">grades</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="n">x</span> <span class="o">+</span> <span class="mi">5</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">histogram</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span>  <span class="c1"># Shift bars right by 5</span>
</span></span><span class="line"><span class="cl">        <span class="n">histogram</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>                 <span class="c1"># Give each bar its correct height</span>
</span></span><span class="line"><span class="cl">        <span class="mi">10</span><span class="p">,</span>                                 <span class="c1"># Give each bar a width of 10</span>
</span></span><span class="line"><span class="cl">        <span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>                <span class="c1"># Black edges for each bar</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>                  <span class="c1"># x-axis from -5 to 105,</span>
</span></span><span class="line"><span class="cl">                                           <span class="c1"># y-axis from 0 to 5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">10</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">)])</span>    <span class="c1"># x-axis labels at 0, 10, ..., 100</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&#34;Decile&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;# of Students&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Distribution of Exam 1 Grades&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><h3 id="33-line-charts">3.3 Line Charts<a aria-label="Link to this section" class="paige-header-link" href="#33-line-charts"></a></h3>
<ul>
<li>Good for showing trends</li>
<li>Example: Bias vs Variance Tradeoff
<ul>
<li>x-axis: model complexity</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Each index in the 3 lists below corresponds to a model complexity</span>
</span></span><span class="line"><span class="cl"><span class="n">variance</span>     <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">bias_squared</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">total_error</span>  <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">variance</span><span class="p">,</span> <span class="n">bias_squared</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variance</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># We can make multiple calls to plt.plot</span>
</span></span><span class="line"><span class="cl"><span class="c1"># to show multiple series on the same chart</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span>     <span class="s1">&#39;g-&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;variance&#39;</span><span class="p">)</span>    <span class="c1"># green solid line</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">bias_squared</span><span class="p">,</span> <span class="s1">&#39;r-.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;bias^2&#39;</span><span class="p">)</span>      <span class="c1"># red dot-dashed line</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">total_error</span><span class="p">,</span>  <span class="s1">&#39;b:&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;total error&#39;</span><span class="p">)</span> <span class="c1"># blue dotted line</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Because we&#39;ve assigned labels to each series,</span>
</span></span><span class="line"><span class="cl"><span class="c1"># we can get a legend for free (loc=9 means &#34;top center&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&#34;model complexity&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;The Bias-Variance Tradeoff&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><h3 id="34-scatter-plots">3.4 Scatter Plots<a aria-label="Link to this section" class="paige-header-link" href="#34-scatter-plots"></a></h3>
<ul>
<li>Good to visualizing ==relationship== between 2 sets of data</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">friends</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">70</span><span class="p">,</span>  <span class="mi">65</span><span class="p">,</span>  <span class="mi">72</span><span class="p">,</span>  <span class="mi">63</span><span class="p">,</span>  <span class="mi">71</span><span class="p">,</span>  <span class="mi">64</span><span class="p">,</span>  <span class="mi">60</span><span class="p">,</span>  <span class="mi">64</span><span class="p">,</span>  <span class="mi">67</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">minutes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">175</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">190</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">labels</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">friends</span><span class="p">,</span> <span class="n">minutes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># label each point</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">friend_count</span><span class="p">,</span> <span class="n">minute_count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">friends</span><span class="p">,</span> <span class="n">minutes</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">label</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">friend_count</span><span class="p">,</span> <span class="n">minute_count</span><span class="p">),</span> <span class="c1"># Put the label with its point</span>
</span></span><span class="line"><span class="cl">        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">),</span>                  <span class="c1"># but slightly offset</span>
</span></span><span class="line"><span class="cl">        <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Daily Minutes vs. Number of Friends&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&#34;# of friends&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;daily minutes spent on the site&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><h3 id="35-further-exploration">3.5 Further Exploration<a aria-label="Link to this section" class="paige-header-link" href="#35-further-exploration"></a></h3>
<ul>
<li>The matplotlib <a href="https://matplotlib.org/2.0.2/gallery.html">Gallery</a> will give you a good idea of the sorts of things you can do with matplotlib (and how to do them).</li>
<li>seaborn is built on top of matplotlib and allows you to easily produce prettier (and more complex) visualizations.</li>
<li>Altair is a newer Python library for creating declarative visualizations.</li>
<li>D3.js is a JavaScript library for producing sophisticated interactive visualizations for the web. Although it is not in Python, it is widely used, and it is well worth your while to be familiar with it.</li>
<li>Bokeh is a library that brings D3-style visualizations into Python.</li>
</ul>
<h1 id="4-linear-algebra">4 Linear Algebra<a aria-label="Link to this section" class="paige-header-link" href="#4-linear-algebra"></a></h1>
<h3 id="41-vectors">4.1 Vectors<a aria-label="Link to this section" class="paige-header-link" href="#41-vectors"></a></h3>
<ul>
<li>Vector are objects that
<ul>
<li>can be added with other vectors</li>
<li>multiplied by a scalar to form another vector</li>
</ul>
</li>
<li>Defining our Vector type alias</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span></span><span class="line"><span class="cl">	<span class="n">Vector</span> <span class="o">=</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
</span></span></code></pre></div><ul>
<li>Common vector operators</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="c1"># Add 2 vectors </span>
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="s2">&#34;&#34;&#34;Adds corresponding elements&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="s2">&#34;vectors must be the same length&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="p">[</span><span class="n">v_i</span> <span class="o">+</span> <span class="n">w_i</span> <span class="k">for</span> <span class="n">v_i</span><span class="p">,</span> <span class="n">w_i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span>	
</span></span><span class="line"><span class="cl">	<span class="k">assert</span> <span class="n">add</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># Scale a vector by a scalar</span>
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">scalar_multiply</span><span class="p">(</span><span class="n">scalar</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="p">[</span><span class="n">scalar</span> <span class="o">*</span> <span class="n">v_i</span> <span class="k">for</span> <span class="n">v_i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">assert</span> <span class="n">scalar_multiply</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># Dot product measures the similarity of 2 vectors based on the direction they are pointing to.</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># dot_exact(a,b) = |a| [b] cos(theta)</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># dot_approx = sum(a_i * b_i + a_j * b_j ...)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">#    WOW: don&#39;t need to know the angle theta</span>
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">dot</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v_i</span> <span class="o">*</span> <span class="n">w_i</span> <span class="k">for</span> <span class="n">v_i</span><span class="p">,</span> <span class="n">w_i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">assert</span> <span class="n">dot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span> <span class="o">==</span> <span class="mi">32</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># sum of sqaures of 1 vector can be defined in terms of dot function</span>
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">sum_of_squares</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">assert</span> <span class="n">sum_of_squares</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="mi">14</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># mangnitude of a vector can be defined using sum_of_squares</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># aka L2 Norm</span>
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">magnitude</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sum_of_sqaures</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">assert</span> <span class="n">magnitude</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span> <span class="o">==</span> <span class="mi">5</span>
</span></span></code></pre></div><ul>
<li>Distance between two vectors (Euclidean)
$$ \sqrt{(v_1-w_1)^2 + .. + (v_n-w_n)^2}$$</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">squared_distance</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="s2">&#34;&#34;&#34;Computes (v_1 - w_1) ** 2 + ... + (v_n - w_n) ** 2&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">sum_of_squares</span><span class="p">(</span><span class="n">subtract</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="s2">&#34;&#34;&#34;Computes the distance between v and w&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">squared_distance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>
</span></span></code></pre></div><ul>
<li>
<ul>
<li>other distance measurements <a href="https://machinelearningmastery.com/distance-measures-for-machine-learning/#:~:text=Euclidean%20distance%20is%20calculated%20as,differences%20between%20the%20two%20vectors.&text=If%20the%20distance%20calculation%20is,to%20speed%20up%20the%20calculation.">blog</a>
<ul>
<li>L2 norm calculates the distance of ==1== vector from the origin</li>
<li>Manhattan distance - shortest path between 2 points on the grid</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">manhattan_distance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">e1</span><span class="o">-</span><span class="n">e2</span><span class="p">)</span> <span class="k">for</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">))</span>
</span></span></code></pre></div><ul>
<li>Minkowski distance: generalization of euclidean and manhattan</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="42-matrices">4.2 Matrices<a aria-label="Link to this section" class="paige-header-link" href="#42-matrices"></a></h3>
<ul>
<li>In practice, use numpy for better performance. But we will implement our own for better understanding</li>
<li>Type aliases</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Another type alias</span>
</span></span><span class="line"><span class="cl"><span class="n">Matrix</span> <span class="o">=</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>  <span class="c1"># A has 2 rows and 3 columns</span>
</span></span><span class="line"><span class="cl">     <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>     <span class="c1"># B has 3 rows and 2 columns</span>
</span></span><span class="line"><span class="cl">     <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">     <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>
</span></span></code></pre></div><ul>
<li>Matrix accessor</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="n">A</span><span class="p">:</span> <span class="n">Matrix</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Returns (# of rows of A, # of columns of A)&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">num_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">num_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">A</span> <span class="k">else</span> <span class="mi">0</span>   <span class="c1"># number of elements in first row</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_row</span><span class="p">(</span><span class="n">A</span><span class="p">:</span> <span class="n">Matrix</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Returns the i-th row of A (as a Vector)&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>             <span class="c1"># A[i] is already the ith row</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_column</span><span class="p">(</span><span class="n">A</span><span class="p">:</span> <span class="n">Matrix</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Returns the j-th column of A (as a Vector)&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="n">A_i</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>          <span class="c1"># jth element of row A_i</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">A_i</span> <span class="ow">in</span> <span class="n">A</span><span class="p">]</span>   <span class="c1"># for each row A_i</span>
</span></span></code></pre></div><ul>
<li>Matrix creation</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">make_matrix</span><span class="p">(</span><span class="n">num_rows</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">num_cols</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">entry_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Matrix</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns a num_rows x num_cols matrix
</span></span></span><span class="line"><span class="cl"><span class="s2">    whose (i,j)-th entry is entry_fn(i, j)
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[[</span><span class="n">entry_fn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>             <span class="c1"># given i, create a list</span>
</span></span><span class="line"><span class="cl">             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cols</span><span class="p">)]</span>  <span class="c1">#   [entry_fn(i, 0), ... ]</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_rows</span><span class="p">)]</span>   <span class="c1"># create one list for each i</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">identity_matrix</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Matrix</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Returns the n x n identity matrix&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">make_matrix</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="43-further-exploration">4.3 Further Exploration<a aria-label="Link to this section" class="paige-header-link" href="#43-further-exploration"></a></h3>
<h1 id="5-statistics">5 Statistics<a aria-label="Link to this section" class="paige-header-link" href="#5-statistics"></a></h1>
<h3 id="51-describing-a-single-set-of-data">5.1 Describing a Single Set of Data<a aria-label="Link to this section" class="paige-header-link" href="#51-describing-a-single-set-of-data"></a></h3>
<p><em>Central Tendencies</em></p>
<ul>
<li>A common metric is to quantify where our data is centered (mean and median)</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># median</span>
</span></span><span class="line"><span class="cl"><span class="c1"># if odd length --&gt; mid element; if even length --&gt; avg of the middel two elements</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">_median_odd</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">mid_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">xs</span><span class="p">)[</span><span class="n">mid_index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">_median_even</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">sorted_xs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">high_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="p">(</span><span class="n">sorted_xs</span><span class="p">[</span><span class="n">high_index</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sorted_xs</span><span class="p">[</span><span class="n">high_index</span><span class="p">])</span> <span class="o">/</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">_median_even</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">_median_odd</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
</span></span></code></pre></div><ul>
<li>Percentile: generalization of median</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">quantile</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">percentile</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">percentile</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">xs</span><span class="p">)[</span><span class="n">p_index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	
</span></span></code></pre></div><ul>
<li>Mode : most common values</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">mode</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">	<span class="n">counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">max_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="p">[</span> <span class="n">x_i</span> <span class="k">for</span> <span class="n">x_i</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="n">max_count</span> <span class="p">]</span>
</span></span></code></pre></div><p><em>Dispersion</em></p>
<ul>
<li>Dispersion measures how spread out our data is</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># CON: does not use the entire data set</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">data_range</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">variance</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">xs_mean</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">deviations</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="n">xs_mean</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="n">deviations</span><span class="p">,</span> <span class="n">deviations</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">standard_deviation</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">variance</span><span class="p">(</span><span class="n">xs</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">										  
</span></span></code></pre></div><h3 id="52-correlation">5.2 Correlation<a aria-label="Link to this section" class="paige-header-link" href="#52-correlation"></a></h3>
<ul>
<li>Correlation measures the relationship between two arrays</li>
</ul>
<p><em>Covariance</em></p>
<ul>
<li>Covariance vs variance
<ul>
<li>Variance measures how variable deviate from the mean</li>
<li>Covariance measures how 2 variables vary in tandem from their respective means</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">covariance</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">ys</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;&#34;&#34; +1 -&gt; pos relationship; 0 no relationship &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ys</span><span class="p">),</span> <span class="s2">&#34;xs and ys must be same length&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">mean_diff</span><span class="p">(</span><span class="n">ls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">		<span class="n">mean_ls</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">mean_ls</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ls</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="n">mean_diff</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span> <span class="n">mean_diff</span><span class="p">(</span><span class="n">ys</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span></code></pre></div><ul>
<li>Correlation
<ul>
<li>Covariance is hard to interpret because each input is not normalized to standard deviation of each inputs;</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">correlation</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">ys</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Measures how much xs and ys vary in tandem about their means&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">stdev_x</span> <span class="o">=</span> <span class="n">standard_deviation</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">stdev_y</span> <span class="o">=</span> <span class="n">standard_deviation</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">stdev_x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">stdev_y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">covariance</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span> <span class="o">/</span> <span class="n">stdev_x</span> <span class="o">/</span> <span class="n">stdev_y</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span>    <span class="c1"># if no variation, correlation is zero</span>
</span></span></code></pre></div><h3 id="53-simpsons-paradox">5.3 Simpson&rsquo;s Paradox<a aria-label="Link to this section" class="paige-header-link" href="#53-simpsons-paradox"></a></h3>
<ul>
<li>Correlation may be misleading
<ul>
<li>Correlation assume ==all else being equal==</li>
<li>But factors like
<ul>
<li>how we sample/construct the dataset can affect the correlation result significantly</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="54-other-correlation-caveats">5.4 Other Correlation Caveats<a aria-label="Link to this section" class="paige-header-link" href="#54-other-correlation-caveats"></a></h3>
<h3 id="55-correlation-and-causation">5.5 Correlation and Causation<a aria-label="Link to this section" class="paige-header-link" href="#55-correlation-and-causation"></a></h3>
<ul>
<li>Correlation is not causation</li>
</ul>
<h3 id="56-further-exploration">5.6 Further Exploration<a aria-label="Link to this section" class="paige-header-link" href="#56-further-exploration"></a></h3>
<h1 id="6-probability">6 Probability<a aria-label="Link to this section" class="paige-header-link" href="#6-probability"></a></h1>
<h3 id="61-dependence-and-independence">6.1 Dependence and Independence<a aria-label="Link to this section" class="paige-header-link" href="#61-dependence-and-independence"></a></h3>
<ul>
<li>
<p>2 events E and F are dependent if knowing something about E gives us information whether F happens; otherwise they are independent.</p>
</li>
<li>
<p>If events E and F are independent, then probability of both event E and F happening
$$ P(E,F) = P(E) P(F)$$</p>
</li>
<li>
<p>Examples</p>
<ul>
<li>probability of rolling 2 dices is 1/2 * 1/2</li>
</ul>
</li>
</ul>
<h3 id="62-conditional-probability">6.2 Conditional Probability<a aria-label="Link to this section" class="paige-header-link" href="#62-conditional-probability"></a></h3>
<ul>
<li>If two events are dependent
$$P(E | F) = P(E,F)/P(F)$$</li>
</ul>
<h3 id="63-bayes-theorem">6.3 Baye&rsquo;s Theorem<a aria-label="Link to this section" class="paige-header-link" href="#63-bayes-theorem"></a></h3>
<ul>
<li>Think of it as a way to reverse conditional probabilities
$$P(E | F) = P(E,F)/P(F)$$
$$P(E|F) = F(F|E) P(E) / P(F)$$</li>
</ul>
<h3 id="64-random-variables">6.4 Random Variables<a aria-label="Link to this section" class="paige-header-link" href="#64-random-variables"></a></h3>
<ul>
<li>Random variable have values which has a probability distribution.</li>
<li>Expected value: the average of a random&rsquo;s variable weighted by its probability
<ul>
<li>Ex: Coin toss where head=0 and tail=1</li>
</ul>
</li>
</ul>
<p>$$Expected Value = value_{head} * prob_{head} + value_{tail} * prob_{tail} $$
$$Expected Value = 0 * 0.5 + 1 * 0.5 $$</p>
<h3 id="65-continuous-distribution">6.5 Continuous Distribution<a aria-label="Link to this section" class="paige-header-link" href="#65-continuous-distribution"></a></h3>
<ul>
<li>
<p>Random variables value can follow a</p>
<ul>
<li>discrete distribution:  dices rolls: {1,2,3,4,5,6}</li>
<li>continuous distribution - values falls within a continuous spectrum
<ul>
<li>calculus integration:
<ul>
<li>if value follows a density function f</li>
<li>then probability of seeing a value between x and x+h is  h* f(x) for small h</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Cumulative distribution function (CDF)</p>
<ul>
<li>gives probability variable is less than or equal to a value</li>
</ul>
</li>
</ul>
<h3 id="66-normal-distribution">6.6 Normal Distribution<a aria-label="Link to this section" class="paige-header-link" href="#66-normal-distribution"></a></h3>
<ul>
<li>Normal distribution is a particular continuous distribution described by its mean $\mu$ and standard deviation $\sigma$</li>
</ul>
<p>$$f(x|\sigma, \mu) = \frac{1}{\sqrt{2\pi\sigma}}exp(-\frac{(x-\mu^2)}{2\sigma^2})$$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">import</span> <span class="nn">math</span>
</span></span><span class="line"><span class="cl">	<span class="n">SQRT_TWO_PI</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">normal_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">SQRT_TWO_PI</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">))</span>
</span></span></code></pre></div><p><em>Probability Distribution Function PDF</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl">	<span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">/</span> <span class="mf">10.0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,[</span><span class="n">normal_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">],</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;mu=0,sigma=1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,[</span><span class="n">normal_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">],</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;mu=0,sigma=2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,[</span><span class="n">normal_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">],</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;mu=0,sigma=0.5&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,[</span><span class="n">normal_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">mu</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>   <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">],</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;mu=-1,sigma=1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Various Normal pdfs&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><p><em>CDFs for Normal Distribution</em> using the erf function</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">normal_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">erf</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># PLOTS for normal CDF for various values for mean and deviation</span>
</span></span><span class="line"><span class="cl"><span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">/</span> <span class="mf">10.0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,[</span><span class="n">normal_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">],</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;mu=0,sigma=1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,[</span><span class="n">normal_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">],</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;mu=0,sigma=2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,[</span><span class="n">normal_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">],</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;mu=0,sigma=0.5&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,[</span><span class="n">normal_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">mu</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">],</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;mu=-1,sigma=1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="c1"># bottom right</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Various Normal cdfs&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><ul>
<li>Use CDF to find value ($\mu \sigma$?) corresponding to a certain probability</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">inverse_normal_cdf</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.00001</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Find approximate inverse using binary search&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># if not standard, compute standard and rescale</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">mu</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">sigma</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">inverse_normal_cdf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">low_z</span> <span class="o">=</span> <span class="o">-</span><span class="mf">10.0</span>                      <span class="c1"># normal_cdf(-10) is (very close to) 0</span>
</span></span><span class="line"><span class="cl">    <span class="n">hi_z</span>  <span class="o">=</span>  <span class="mf">10.0</span>                      <span class="c1"># normal_cdf(10)  is (very close to) 1</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="n">hi_z</span> <span class="o">-</span> <span class="n">low_z</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">mid_z</span> <span class="o">=</span> <span class="p">(</span><span class="n">low_z</span> <span class="o">+</span> <span class="n">hi_z</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>     <span class="c1"># Consider the midpoint</span>
</span></span><span class="line"><span class="cl">        <span class="n">mid_p</span> <span class="o">=</span> <span class="n">normal_cdf</span><span class="p">(</span><span class="n">mid_z</span><span class="p">)</span>      <span class="c1"># and the CDF&#39;s value there</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">mid_p</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">low_z</span> <span class="o">=</span> <span class="n">mid_z</span>              <span class="c1"># Midpoint too low, search above it</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">hi_z</span> <span class="o">=</span> <span class="n">mid_z</span>               <span class="c1"># Midpoint too high, search below it</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">mid_z</span>
</span></span></code></pre></div><h3 id="67-central-limit-theorem">6.7 Central Limit Theorem<a aria-label="Link to this section" class="paige-header-link" href="#67-central-limit-theorem"></a></h3>
<ul>
<li>
<p>a random variable defined as the average of a ==large number of independent and identically distributed random variables== is itself approximately normally distributed.</p>
</li>
<li>
<p>Ex: Bernouli distribution with large enough sample size follows a normal distribution</p>
<ul>
<li>Bernouli:
<ul>
<li>mean of Bernouli is p</li>
<li>standard deviation is $\sqrt{p(1-p)}$</li>
</ul>
</li>
<li>Large sample &ndash;&gt; follows normal distribution
<ul>
<li>mean = np</li>
<li>standard deviation = $\sqrt{np(1-p)}$</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">bernoulli_trial</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Returns 1 with probability p and 0 with probability 1-p&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">p</span> <span class="k">else</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">binomial</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Returns the sum of n bernoulli(p) trials&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">bernoulli_trial</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">binomial_histogram</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_points</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Picks points from a Binomial(n, p) and plots their histogram&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">binomial</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_points</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># use a bar chart to show the actual binomial samples</span>
</span></span><span class="line"><span class="cl">    <span class="n">histogram</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.4</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">histogram</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span><span class="n">v</span> <span class="o">/</span> <span class="n">num_points</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">histogram</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span>
</span></span><span class="line"><span class="cl">            <span class="mf">0.8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.75&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">mu</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">n</span>
</span></span><span class="line"><span class="cl">    <span class="n">sigma</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># use a line chart to show the normal approximation</span>
</span></span><span class="line"><span class="cl">    <span class="n">xs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">normal_cdf</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">-</span> <span class="n">normal_cdf</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Binomial Distribution vs. Normal Approximation&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><h3 id="68-further-exploration">6.8 Further Exploration<a aria-label="Link to this section" class="paige-header-link" href="#68-further-exploration"></a></h3>
<h1 id="7-hypothesis-and-inference">7 Hypothesis and Inference<a aria-label="Link to this section" class="paige-header-link" href="#7-hypothesis-and-inference"></a></h1>
<h3 id="71--statistical-hypothesis-testing">7.1  Statistical Hypothesis Testing<a aria-label="Link to this section" class="paige-header-link" href="#71--statistical-hypothesis-testing"></a></h3>
<ul>
<li>
<p>Terminologies</p>
<ul>
<li>$H_0$ : aka null hypothesis, represent the default position
<ul>
<li>Type 1 error (false positive) : wrongly reject $H_0$ even though it is true
<ul>
<li>Significance : how willing we are to make a type 1 error (usually 5% or 1%)</li>
</ul>
</li>
<li>Type 2 error (false negative) : fail to reject $H_0$ even though it&rsquo;s false
<ul>
<li>power of test:</li>
</ul>
</li>
</ul>
</li>
<li>$H_1$ : alternative hypothesis</li>
</ul>
</li>
<li>
<p>We use statistics to decide whether we can reject $H_0$</p>
<ul>
<li>The different approaches below differ on the what the probability is on, ie parameters like normal distribution $\mu, \sigma$, value, etc..</li>
</ul>
</li>
<li>
<p>Approach 1: Choose bounds based on some probability cutoff using the CDF</p>
<ul>
<li>See 7.2 below</li>
</ul>
</li>
</ul>
<h3 id="72-example-flipping-a-coin">7.2 Example: Flipping a Coin<a aria-label="Link to this section" class="paige-header-link" href="#72-example-flipping-a-coin"></a></h3>
<ul>
<li>
<p>Overview</p>
<ul>
<li>Our default hypothesis: probability of head is 0.5
<ul>
<li>What is the range of  head counts we need to observe to satisfy our requirements on
<ul>
<li>significance: type 1 error</li>
<li>power: type 2 error?</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li>Model probability of head in coin toss as Bernoulli</li>
<li>Central limit theorem &ndash;&gt; Bernoulli distribution becomes normal distribution</li>
<li>Use CDF to calculate various count_head needs to be observed</li>
</ol>
</li>
<li>
<p>Null hypothesis : probability of head is 0.5 (p_head = 0.5)</p>
</li>
<li>
<p>Model random variable&rsquo;s value as binomial(n=#numSamples, p=probability_head)</p>
</li>
<li>
<p>If large enough sample, binomial distribution can be approximated as normal distribution, and characterized by $\mu, \sigma$</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">math</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">normal_approximation_to_binomial</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Returns mu and sigma corresponding to a Binomial(n, p)&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">mu</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">n</span>
</span></span><span class="line"><span class="cl">    <span class="n">sigma</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span>
</span></span></code></pre></div><ul>
<li>Since we assume random variable follows normal distribution, we can use norml_cdf to quantify the probability that the value (p_head or ($\mu, \sigma)$?) lies within or outside a particular interval</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scratch.probability</span> <span class="kn">import</span> <span class="n">normal_cdf</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># The normal cdf _is_ the probability the variable is below a threshold</span>
</span></span><span class="line"><span class="cl"><span class="n">normal_probability_below</span> <span class="o">=</span> <span class="n">normal_cdf</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># It&#39;s above the threshold if it&#39;s not below the threshold</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">normal_probability_above</span><span class="p">(</span><span class="n">lo</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                             <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                             <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;The probability that an N(mu, sigma) is greater than lo.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">normal_cdf</span><span class="p">(</span><span class="n">lo</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># It&#39;s between if it&#39;s less than hi, but not less than lo</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">normal_probability_between</span><span class="p">(</span><span class="n">lo</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                               <span class="n">hi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                               <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                               <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;The probability that an N(mu, sigma) is between lo and hi.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">normal_cdf</span><span class="p">(</span><span class="n">hi</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">-</span> <span class="n">normal_cdf</span><span class="p">(</span><span class="n">lo</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># It&#39;s outside if it&#39;s not between</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">normal_probability_outside</span><span class="p">(</span><span class="n">lo</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                               <span class="n">hi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                               <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                               <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;The probability that an N(mu, sigma) is not between lo and hi.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">normal_probability_between</span><span class="p">(</span><span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</span></span></code></pre></div><ul>
<li>Similarly, we can find either the nontail region or the (symmetric) interval around the mean that accounts for a certain level of likelihood
<ul>
<li>Ex: we want to find an interval centered at the mean and containing 60% probability, then we find the cutoffs where the upper and lower tails each contain 20% of the probability (leaving 60%)</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scratch.probability</span> <span class="kn">import</span> <span class="n">inverse_normal_cdf</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">normal_upper_bound</span><span class="p">(</span><span class="n">probability</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Returns the z for which P(Z &lt;= z) = probability&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">inverse_normal_cdf</span><span class="p">(</span><span class="n">probability</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">normal_lower_bound</span><span class="p">(</span><span class="n">probability</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Returns the z for which P(Z &gt;= z) = probability&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">inverse_normal_cdf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">probability</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">normal_two_sided_bounds</span><span class="p">(</span><span class="n">probability</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns the symmetric (about the mean) bounds
</span></span></span><span class="line"><span class="cl"><span class="s2">    that contain the specified probability
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">tail_probability</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">probability</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># upper bound should have tail_probability above it</span>
</span></span><span class="line"><span class="cl">    <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">normal_lower_bound</span><span class="p">(</span><span class="n">tail_probability</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># lower bound should have tail_probability below it</span>
</span></span><span class="line"><span class="cl">    <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">normal_upper_bound</span><span class="p">(</span><span class="n">tail_probability</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span>
</span></span></code></pre></div><ul>
<li>
<p>If our hypothesis is correct, then $\mu=500, $\sigma=15.8$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">mu_0</span><span class="p">,</span> <span class="n">sigma_0</span> <span class="o">=</span> <span class="n">normal_approximation_to_binomial</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
</span></span></code></pre></div></li>
<li>
<p>Signficance: What&rsquo;s our appetite for false positive (Type 1 error)?</p>
<ul>
<li>Let&rsquo;s choose significance (ie willingness to make a false positive) to be 5% &ndash;&gt; p=0.95</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># (469, 531)</span>
</span></span><span class="line"><span class="cl"><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">normal_two_sided_bounds</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">mu_0</span><span class="p">,</span> <span class="n">sigma_0</span><span class="p">)</span>
</span></span></code></pre></div><ul>
<li>In order for us to reject H0 with 5% chance of false positive, we need to see between 469 and 531 heads</li>
</ul>
</li>
<li>
<p>Power of Test : What&rsquo;s our appetite for false negative (Type 2 error)</p>
<ul>
<li>this quantifies our probability of a type 2 error</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="c1"># 95% bounds based on assumption p is 0.5</span>
</span></span><span class="line"><span class="cl">	<span class="c1">#(469, 531)</span>
</span></span><span class="line"><span class="cl">	<span class="n">lo</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="n">normal_two_sided_bounds</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">mu_0</span><span class="p">,</span> <span class="n">sigma_0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># actual mu and sigma based on p = 0.55</span>
</span></span><span class="line"><span class="cl">	<span class="n">mu_1</span><span class="p">,</span> <span class="n">sigma_1</span> <span class="o">=</span> <span class="n">normal_approximation_to_binomial</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># a type 2 error means we fail to reject the null hypothesis,</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># which will happen when X is still in our original interval</span>
</span></span><span class="line"><span class="cl">	<span class="n">type_2_probability</span> <span class="o">=</span> <span class="n">normal_probability_between</span><span class="p">(</span><span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">mu_1</span><span class="p">,</span> <span class="n">sigma_1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">power</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">type_2_probability</span>      <span class="c1"># 0.887</span>
</span></span><span class="line"><span class="cl">	<span class="err">```</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"> <span class="o">-</span> 
</span></span><span class="line"><span class="cl">	<span class="o">-</span> <span class="n">We</span> <span class="n">reject</span> <span class="n">H_0</span> <span class="n">when</span> <span class="n">we</span> <span class="n">see</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### 7.3 Approach 2: p-Values</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">We</span> <span class="n">compute</span> <span class="n">the</span> <span class="n">probability</span><span class="p">,</span> <span class="n">assuming</span> <span class="err">$</span><span class="n">H_0</span><span class="err">$</span> <span class="ow">is</span> <span class="n">true</span><span class="p">,</span> <span class="n">that</span> <span class="n">we</span> <span class="n">see</span> <span class="n">a</span> <span class="n">value</span> <span class="k">as</span> <span class="n">extreme</span> <span class="k">as</span> <span class="n">the</span> <span class="n">one</span> <span class="n">we</span> <span class="n">actually</span> <span class="n">observed</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">```</span><span class="n">python</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">two_sided_p_value</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    How likely are we to see a value at least as extreme as x (in either
</span></span></span><span class="line"><span class="cl"><span class="s2">    direction) if our values are from an N(mu, sigma)?
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">mu</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># x is greater than the mean, so the tail is everything greater than x</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">normal_probability_above</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># x is less than the mean, so the tail is everything less than x</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">normal_probability_below</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</span></span></code></pre></div><ul>
<li>If we were to see 530 heads, our p value is 0.062; so our $H_0$ hypothesis is valid</li>
</ul>
<h3 id="74-approach-3-confidence-intervals">7.4 Approach 3: Confidence Intervals<a aria-label="Link to this section" class="paige-header-link" href="#74-approach-3-confidence-intervals"></a></h3>
<ul>
<li>Quantify the confidence interval around the observed value of the parameter, ie probability of head in a coin toss.</li>
<li>Ex:
<ul>
<li>If we observe 525 heads out of 1000 flips, &ndash;&gt; p_head = 0.525.</li>
<li>What is our confidence level that p_head is actually 0.525?
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># We use our observation, and assign p_hat = 0.525</span>
</span></span><span class="line"><span class="cl"><span class="n">p_hat</span> <span class="o">=</span> <span class="mf">0.525</span>
</span></span><span class="line"><span class="cl"><span class="n">sigma</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p_hat</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p_hat</span><span class="p">)</span> <span class="c1">#0.0158</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># probability threadhold where we are 95% confident is the true p</span>
</span></span><span class="line"><span class="cl"><span class="n">p_lower</span><span class="p">,</span> <span class="n">p_higher</span> <span class="o">=</span> <span class="n">normal_two_sided_bounds</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>        
</span></span><span class="line"><span class="cl"><span class="c1"># [0.4940, 0.5560]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Since H_0 has p=0.5, then H_0 falls within our 95% confidence interval</span>
</span></span></code></pre></div></li>
</ul>
</li>
</ul>
<h3 id="75-p-hacking">7.5 p-Hacking<a aria-label="Link to this section" class="paige-header-link" href="#75-p-hacking"></a></h3>
<h3 id="76-example-running-on-ab-test">7.6 Example: Running on A/B Test<a aria-label="Link to this section" class="paige-header-link" href="#76-example-running-on-ab-test"></a></h3>
<ul>
<li>
<p>Given 2 Ads A and B</p>
<ul>
<li>where
<ul>
<li>$n_A$ = number of users we clicked on Ad A</li>
<li>$N_A$= total number of ad A shown</li>
<li>$n_B$ = number of users we clicked on Ad B</li>
<li>$N_B$= total number of ad B shown</li>
</ul>
</li>
<li>Our null hypothesis $H_0$ is the original ad A is better</li>
<li>We want to know if we should roll out A or B</li>
</ul>
</li>
<li>
<p>Click is a Bernouli distribution, but with enough sample, it follows a normal distribution which can be characterized by $\mu , \sigma$</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">estimated_parameters</span><span class="p">(</span><span class="n">N</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">	    <span class="n">p</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="n">N</span>
</span></span><span class="line"><span class="cl">	    <span class="n">sigma</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">p</span><span class="p">,</span> <span class="n">sigma</span>
</span></span><span class="line"><span class="cl">	<span class="err">```</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">Calculate</span> <span class="n">the</span> <span class="n">difference</span> <span class="n">of</span> <span class="err">$</span>\<span class="n">mu</span> <span class="p">,</span> \<span class="n">sigma</span><span class="err">$</span>
</span></span><span class="line"><span class="cl">	<span class="o">-</span> <span class="n">The</span> <span class="mi">2</span> <span class="n">normal</span> <span class="n">distribution</span> <span class="n">A</span> <span class="ow">and</span> <span class="n">B</span> <span class="n">are</span> <span class="n">independent</span>
</span></span><span class="line"><span class="cl">		<span class="o">-</span> <span class="err">$</span><span class="n">p_</span><span class="p">{</span><span class="n">diff</span><span class="p">}</span> <span class="o">=</span> <span class="n">p_a</span> <span class="o">-</span> <span class="n">p_b</span><span class="err">$</span>
</span></span><span class="line"><span class="cl">		<span class="o">-</span> <span class="err">$</span>\<span class="n">sigma_</span><span class="p">{</span><span class="n">diff</span><span class="p">}</span> <span class="o">=</span> \<span class="n">sqrt</span><span class="p">{</span>\<span class="n">sigma_a</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> \<span class="n">sigma_b</span><span class="o">^</span><span class="mi">2</span><span class="p">}</span><span class="err">$</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">Our</span> <span class="n">Null</span> <span class="n">hypothesis</span> <span class="ow">is</span> <span class="err">$</span><span class="n">p_A</span><span class="err">$</span> <span class="ow">and</span> <span class="err">$</span><span class="n">p_B</span><span class="err">$</span> <span class="n">are</span> <span class="n">the</span> <span class="n">same</span>
</span></span><span class="line"><span class="cl"><span class="err">```</span><span class="n">python</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># returns the z value</span>
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">a_b_test_statistic</span><span class="p">(</span><span class="n">N_A</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_A</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">N_B</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_B</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="n">p_A</span><span class="p">,</span> <span class="n">sigma_A</span> <span class="o">=</span> <span class="n">estimated_parameters</span><span class="p">(</span><span class="n">N_A</span><span class="p">,</span> <span class="n">n_A</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">p_B</span><span class="p">,</span> <span class="n">sigma_B</span> <span class="o">=</span> <span class="n">estimated_parameters</span><span class="p">(</span><span class="n">N_B</span><span class="p">,</span> <span class="n">n_B</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="p">(</span><span class="n">p_B</span> <span class="o">-</span> <span class="n">p_A</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma_A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">sigma_B</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span></span></code></pre></div><ul>
<li>Ex 1: Insufficient to disprove null hypothesis</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">z</span> <span class="o">=</span> <span class="n">a_b_test_statistic</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>    <span class="c1"># -1.14</span>
</span></span><span class="line"><span class="cl"><span class="n">two_sided_p_value</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>                            <span class="c1"># 0.254</span>
</span></span></code></pre></div><ul>
<li>Ex 2: Sufficient to disprove null hypothesis</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">z</span> <span class="o">=</span> <span class="n">a_b_test_statistic</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>    <span class="c1"># -2.94</span>
</span></span><span class="line"><span class="cl"><span class="n">two_sided_p_value</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>                            <span class="c1"># 0.003</span>
</span></span></code></pre></div><h3 id="77-approach-4-bayesian-inference">7.7 Approach 4: Bayesian Inference<a aria-label="Link to this section" class="paige-header-link" href="#77-approach-4-bayesian-inference"></a></h3>
<ul>
<li>Rather than making probability judgments about the tests, you make probability judgments about the parameters.
<ul>
<li>Assume a prior distribution; collect data ; update the posterior</li>
</ul>
</li>
</ul>
<h3 id="78-further-exploration">7.8 Further Exploration<a aria-label="Link to this section" class="paige-header-link" href="#78-further-exploration"></a></h3>
<h1 id="8-gradient-descent">8 Gradient Descent<a aria-label="Link to this section" class="paige-header-link" href="#8-gradient-descent"></a></h1>
<ul>
<li>In ML, training a model often means finding the best parameters.
<ul>
<li>minimization problem: minimize the error of its prediction</li>
<li>maximization problem: maximize the likelihood of the data</li>
</ul>
</li>
<li>Gradient gives the input direction which the function increases most quickly
<ul>
<li>maximization -&gt; gradient</li>
<li>minimization -&gt; - gradient</li>
</ul>
</li>
</ul>
<h3 id="81-estimating-gradient">8.1 Estimating Gradient<a aria-label="Link to this section" class="paige-header-link" href="#81-estimating-gradient"></a></h3>
<ul>
<li>Defining Scalar Gradient</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># returns gradient</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">gradient_scalar</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">h</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="n">h</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Funtion we are trying to calculate the derivative</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Test</span>
</span></span><span class="line"><span class="cl"><span class="n">xs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">estimates</span> <span class="o">=</span> <span class="p">[</span><span class="n">gradient_scalar</span><span class="p">(</span><span class="n">square</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># plot to show they&#39;re basically the same --&gt; shows a line with a slope of 2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Actual Derivatives vs. Estimates&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">estimates</span><span class="p">,</span> <span class="s1">&#39;b+&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Estimate&#39;</span><span class="p">)</span>   <span class="c1"># blue +</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><ul>
<li>When the function f has many variables (ie input is a vector), each element has a gradient; it is a partial derivative</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">gradient_vector</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Vector</span><span class="p">],</span> <span class="nb">float</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                                <span class="n">v</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">h</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Returns the i-th partial difference quotient of f at v&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="n">v_j</span> <span class="o">+</span> <span class="p">(</span><span class="n">h</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">i</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>    <span class="c1"># add h to just the ith element of v</span>
</span></span><span class="line"><span class="cl">         <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">v_j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">/</span> <span class="n">h</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">estimate_gradient</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Vector</span><span class="p">],</span> <span class="nb">float</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="n">v</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="n">h</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="n">gradient_vector</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">))]</span>
</span></span></code></pre></div><h3 id="using-the-gradient">Using the Gradient<a aria-label="Link to this section" class="paige-header-link" href="#using-the-gradient"></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scratch.linear_algebra</span> <span class="kn">import</span> <span class="n">distance</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">scalar_multiply</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">gradient_step</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">gradient</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">step_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Moves `step_size` in the `gradient` direction from `v`&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">step</span> <span class="o">=</span> <span class="n">scalar_multiply</span><span class="p">(</span><span class="n">step_size</span><span class="p">,</span> <span class="n">gradient</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># pick a random starting point</span>
</span></span><span class="line"><span class="cl"><span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># let f be the function we are trying to optimize</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># compute the gradient at v</span>
</span></span><span class="line"><span class="cl">    <span class="n">grad</span> <span class="o">=</span> <span class="n">estimate_gradient</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">    <span class="n">v</span> <span class="o">=</span> <span class="n">gradient_step</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">)</span>    <span class="c1"># take a negative gradient step</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="choosing-the-right-step-size">Choosing the Right Step Size<a aria-label="Link to this section" class="paige-header-link" href="#choosing-the-right-step-size"></a></h3>
<ul>
<li>Some options are:
<ul>
<li>Use a fixed step size</li>
<li>Gradually shrink the step size over time</li>
<li>At each step, choose the step size that minimizes the value of the objective function</li>
</ul>
</li>
</ul>
<h3 id="using-gradient-descent-to-fit-models">Using Gradient Descent to Fit Models<a aria-label="Link to this section" class="paige-header-link" href="#using-gradient-descent-to-fit-models"></a></h3>
<ul>
<li>Let&rsquo;s assume we have a linear model where we are trying to learn the parameter theta, (ie slope and intercept)</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Method clculates the error between prediction and actual</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">linear_gradient</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span>            <span class="c1"># theta is the parameter vector we are learning</span>
</span></span><span class="line"><span class="cl">    <span class="n">predicted</span> <span class="o">=</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">intercept</span>    <span class="c1"># The prediction of the model.</span>
</span></span><span class="line"><span class="cl">    <span class="n">error</span> <span class="o">=</span> <span class="p">(</span><span class="n">predicted</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>              <span class="c1"># error is (predicted - actual).</span>
</span></span><span class="line"><span class="cl">    <span class="n">squared_error</span> <span class="o">=</span> <span class="n">error</span> <span class="o">**</span> <span class="mi">2</span>           <span class="c1"># We&#39;ll minimize squared error</span>
</span></span><span class="line"><span class="cl">    <span class="n">grad</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">error</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">error</span><span class="p">]</span>    <span class="c1"># using its gradient.</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">grad</span>
</span></span></code></pre></div><ul>
<li>Code steps through
<ol>
<li>Start with a random value for theta.</li>
<li>Compute the mean of the gradients.</li>
<li>Adjust theta in that direction.</li>
<li>Repeat.</li>
</ol>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scratch.linear_algebra</span> <span class="kn">import</span> <span class="n">vector_mean</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Start with random values for slope and intercept</span>
</span></span><span class="line"><span class="cl"><span class="n">theta</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.001</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Compute the mean of the gradients</span>
</span></span><span class="line"><span class="cl">    <span class="n">grad</span> <span class="o">=</span> <span class="n">vector_mean</span><span class="p">([</span><span class="n">linear_gradient</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Take a step in that direction</span>
</span></span><span class="line"><span class="cl">    <span class="n">theta</span> <span class="o">=</span> <span class="n">gradient_step</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="o">-</span><span class="n">learning_rate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="mini-batch-and-stochastic-gradient-descent">Mini-batch and Stochastic Gradient Descent<a aria-label="Link to this section" class="paige-header-link" href="#mini-batch-and-stochastic-gradient-descent"></a></h3>
<ul>
<li>mini-batch gradient descent: calculate gradient descent using only a subset of larger dataset:</li>
<li>stochastic gradient descent: calculate gradient descent using only ==ONE== sample:</li>
</ul>
<h1 id="9-getting-data">9 Getting Data<a aria-label="Link to this section" class="paige-header-link" href="#9-getting-data"></a></h1>
<h3 id="91-stdin-and-stdout">9.1 stdin and stdout<a aria-label="Link to this section" class="paige-header-link" href="#91-stdin-and-stdout"></a></h3>
<ul>
<li>
<p>We can use unix pipe with python files to create interesting functionality</p>
<ul>
<li>pipes takes the output from the left cmd as input to the next output command</li>
</ul>
</li>
<li>
<p>Example 1: Pipe with greps</p>
<pre tabindex="0"><code> cat SomeFile.txt | python egrep.py &#34;[0-9]&#34; | python line_count.py
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># egrep.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># sys.argv is the list of command-line arguments</span>
</span></span><span class="line"><span class="cl"><span class="c1"># sys.argv[0] is the name of the program itself</span>
</span></span><span class="line"><span class="cl"><span class="c1"># sys.argv[1] will be the regex specified at the command line</span>
</span></span><span class="line"><span class="cl"><span class="n">regex</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># for every line passed into the script</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># if it matches the regex, write it to stdout</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="c1"># line_cout.py</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># print goes to sys.stdout</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span></code></pre></div></li>
<li>
<p>Ex 2: Most common word of files</p>
<pre tabindex="0"><code class="language-terminal" data-lang="terminal">cat the_bible.txt `|` python most_common_words.py 10
</code></pre></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="c1"># most_common_words.py</span>
</span></span><span class="line"><span class="cl">	<span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># pass in number of words as first argument</span>
</span></span><span class="line"><span class="cl">	<span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="n">num_words</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;usage: most_common_words.py num_words&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># nonzero exit code indicates error</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>                      <span class="c1"># lowercase words</span>
</span></span><span class="line"><span class="cl">	                  <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>
</span></span><span class="line"><span class="cl">	                  <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>  <span class="c1"># split on spaces</span>
</span></span><span class="line"><span class="cl">	                  <span class="k">if</span> <span class="n">word</span><span class="p">)</span>                          <span class="c1"># skip empty &#39;words&#39;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counter</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="n">num_words</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="err">```</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### 9.2 Reading Files</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">Basic</span><span class="p">:</span> <span class="n">Read</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">domains</span> <span class="n">of</span> <span class="n">a</span> <span class="n">file</span>
</span></span><span class="line"><span class="cl">	<span class="err">```</span><span class="n">python</span>
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">get_domain</span><span class="p">(</span><span class="n">email_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="s2">&#34;&#34;&#34;Split on &#39;@&#39; and return the last piece&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">email_address</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;@&#34;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># a couple of tests</span>
</span></span><span class="line"><span class="cl">	<span class="k">assert</span> <span class="n">get_domain</span><span class="p">(</span><span class="s1">&#39;joelgrus@gmail.com&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;gmail.com&#39;</span>
</span></span><span class="line"><span class="cl">	<span class="k">assert</span> <span class="n">get_domain</span><span class="p">(</span><span class="s1">&#39;joel@m.datasciencester.com&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;m.datasciencester.com&#39;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;email_addresses.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="n">domain_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">get_domain</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	                            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span>
</span></span><span class="line"><span class="cl">	                            <span class="k">if</span> <span class="s2">&#34;@&#34;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="err">```</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### 9.3 Scraping the Web</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">Tools</span>
</span></span><span class="line"><span class="cl">	<span class="o">-</span> <span class="n">Use</span> <span class="n">Beautiful</span> <span class="n">Soup</span> <span class="n">Library</span> <span class="n">to</span> <span class="n">build</span> <span class="n">a</span> <span class="n">tree</span> <span class="n">out</span> <span class="n">of</span> <span class="n">the</span> <span class="n">web</span> <span class="n">page</span>
</span></span><span class="line"><span class="cl">	<span class="o">-</span> <span class="n">Use</span> <span class="n">Request</span> <span class="n">library</span> <span class="n">to</span> <span class="n">make</span> <span class="n">HTTP</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">	<span class="o">-</span> <span class="n">Parser</span><span class="p">:</span>  <span class="n">html5lib</span>
</span></span><span class="line"><span class="cl">	<span class="o">-</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">beautifulsoup4</span> <span class="n">requests</span> <span class="n">html5lib</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">Ex</span><span class="p">:</span> <span class="n">Scrape</span> <span class="n">house</span> <span class="n">of</span> <span class="n">representative</span> <span class="n">_</span><span class="p">[</span><span class="n">web</span><span class="p">](</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">house</span><span class="o">.</span><span class="n">gov</span><span class="o">/</span><span class="n">representatives</span><span class="p">)</span><span class="n">_</span> <span class="n">who</span> <span class="n">mentioned</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">their</span> <span class="n">press</span> <span class="n">link</span>
</span></span><span class="line"><span class="cl">	<span class="n">_HTML</span><span class="p">:</span> <span class="n">view</span> <span class="n">source_</span>
</span></span><span class="line"><span class="cl">	<span class="err">```</span><span class="n">html</span>
</span></span><span class="line"><span class="cl">	<span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">	  <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&#34;https://jayapal.house.gov&#34;</span><span class="o">&gt;</span><span class="n">Jayapal</span><span class="p">,</span> <span class="n">Pramila</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="err">```</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">_Code</span> <span class="mi">1</span><span class="p">:</span> <span class="n">Find</span> <span class="n">the</span> <span class="n">Valid</span> <span class="n">URLS</span> <span class="n">of</span> <span class="n">representative_</span>
</span></span><span class="line"><span class="cl">	<span class="err">```</span><span class="n">python</span>
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
</span></span><span class="line"><span class="cl">	<span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;https://www.house.gov/representatives&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="n">text</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">	<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&#34;html5lib&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># Must start with http:// or https://</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># Must end with .house.gov or .house.gov/</span>
</span></span><span class="line"><span class="cl">	<span class="n">regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&#34;^https?://.*\.house\.gov/?$&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># Let&#39;s write some tests!</span>
</span></span><span class="line"><span class="cl">	<span class="k">assert</span> <span class="n">re</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="s2">&#34;http://joel.house.gov&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">assert</span> <span class="n">re</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="s2">&#34;https://joel.house.gov&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">all_urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">soup</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">has_attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># And now apply</span>
</span></span><span class="line"><span class="cl">	<span class="n">good_urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">url</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">all_urls</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">url</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_urls</span><span class="p">)))</span>  <span class="c1"># 965 for me, way too many</span>
</span></span></code></pre></div><p><em>Code 2: Find the Press Link</em></p>
<ul>
<li>
<p>Test code: each press link is a relative link, which means we need to remember the originating site</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">html</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://jayapal.house.gov&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl"><span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s1">&#39;html5lib&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Use a set because the links might appear multiple times.</span>
</span></span><span class="line"><span class="cl"><span class="n">links</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">soup</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;press releases&#39;</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">links</span><span class="p">)</span> <span class="c1"># {&#39;/media/press-releases&#39;}</span>
</span></span></code></pre></div></li>
<li>
<p>Actual Code: dict of representative to links</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Set</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">press_releases</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="n">house_url</span> <span class="ow">in</span> <span class="n">good_urls</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="n">html</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">house_url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">	    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s1">&#39;html5lib&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">pr_links</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">soup</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;press releases&#39;</span>
</span></span><span class="line"><span class="cl">	                                             <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()}</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">house_url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">pr_links</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">press_releases</span><span class="p">[</span><span class="n">house_url</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_links</span>
</span></span></code></pre></div><p><em>Code 3: Did press link mention data?</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">house_url</span><span class="p">,</span> <span class="n">pr_links</span> <span class="ow">in</span> <span class="n">press_releases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">pr_link</span> <span class="ow">in</span> <span class="n">pr_links</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">house_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">pr_link</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">paragraph_mentions</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">house_url</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>  <span class="c1"># done with this house_url</span>
</span></span></code></pre></div><h3 id="94-using-the-apis">9.4 Using the APIs<a aria-label="Link to this section" class="paige-header-link" href="#94-using-the-apis"></a></h3>
<h3 id="95-using-twitter-apis">9.5 Using Twitter APIs<a aria-label="Link to this section" class="paige-header-link" href="#95-using-twitter-apis"></a></h3>
<ul>
<li>
<p>Logic</p>
<ol>
<li>Go to <a href="https://developer.twitter.com/">https://developer.twitter.com/</a>.</li>
<li>If you are not signed in, click “Sign in” and enter your Twitter username and password.</li>
<li>Click Apply to apply for a developer account.</li>
<li>Request access for your own personal use.</li>
<li>Fill out the application. It requires 300 words (really) on why you need access, so to get over the limit you could tell them about this book and how much you’re enjoying it.</li>
<li>Wait some indefinite amount of time.</li>
<li>If you know someone who works at Twitter, email them and ask them if they can expedite your application. Otherwise, keep waiting.</li>
<li>Once you get approved, go back to developer.twitter.com, find the “Apps” section, and click “Create an app.”</li>
<li>Fill out all the required fields (again, if you need extra characters for the description, you could talk about this book and how edifying you’re finding it).</li>
<li>Click CREATE.</li>
</ol>
</li>
<li>
<p>_Code1 _: Create twython Instance</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Feel free to plug your key and secret in directly</span>
</span></span><span class="line"><span class="cl"><span class="n">CONSUMER_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;TWITTER_CONSUMER_KEY&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">CONSUMER_SECRET</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;TWITTER_CONSUMER_SECRET&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">webbrowser</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">twython</span> <span class="kn">import</span> <span class="n">Twython</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Get a temporary client to retrieve an authentication URL</span>
</span></span><span class="line"><span class="cl"><span class="n">temp_client</span> <span class="o">=</span> <span class="n">Twython</span><span class="p">(</span><span class="n">CONSUMER_KEY</span><span class="p">,</span> <span class="n">CONSUMER_SECRET</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">temp_creds</span> <span class="o">=</span> <span class="n">temp_client</span><span class="o">.</span><span class="n">get_authentication_tokens</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="n">temp_creds</span><span class="p">[</span><span class="s1">&#39;auth_url&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Now visit that URL to authorize the application and get a PIN</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;go visit </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> and get the PIN code and paste it below&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">PIN_CODE</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;please enter the PIN code: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Now we use that PIN_CODE to get the actual tokens</span>
</span></span><span class="line"><span class="cl"><span class="n">auth_client</span> <span class="o">=</span> <span class="n">Twython</span><span class="p">(</span><span class="n">CONSUMER_KEY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="n">CONSUMER_SECRET</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="n">temp_creds</span><span class="p">[</span><span class="s1">&#39;oauth_token&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="n">temp_creds</span><span class="p">[</span><span class="s1">&#39;oauth_token_secret&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">final_step</span> <span class="o">=</span> <span class="n">auth_client</span><span class="o">.</span><span class="n">get_authorized_tokens</span><span class="p">(</span><span class="n">PIN_CODE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ACCESS_TOKEN</span> <span class="o">=</span> <span class="n">final_step</span><span class="p">[</span><span class="s1">&#39;oauth_token&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">ACCESS_TOKEN_SECRET</span> <span class="o">=</span> <span class="n">final_step</span><span class="p">[</span><span class="s1">&#39;oauth_token_secret&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># And get a new Twython instance using them.</span>
</span></span><span class="line"><span class="cl"><span class="n">twitter</span> <span class="o">=</span> <span class="n">Twython</span><span class="p">(</span><span class="n">CONSUMER_KEY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="n">CONSUMER_SECRET</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="n">ACCESS_TOKEN</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="n">ACCESS_TOKEN_SECRET</span><span class="p">)</span>
</span></span></code></pre></div></li>
</ul>
<p>_Code2a _: Search whether tweet contains the word data</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Search for tweets containing the phrase &#34;data science&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">twitter</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="s1">&#39;&#34;data science&#34;&#39;</span><span class="p">)[</span><span class="s2">&#34;statuses&#34;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="n">user</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="s2">&#34;user&#34;</span><span class="p">][</span><span class="s2">&#34;screen_name&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="s2">&#34;text&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p><em>Code2b: Using Streaming API to collect all data continuously</em></p>
<ul>
<li>define on_success and on_error</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">twython</span> <span class="kn">import</span> <span class="n">TwythonStreamer</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Appending data to a global variable is pretty poor form</span>
</span></span><span class="line"><span class="cl"><span class="c1"># but it makes the example much simpler</span>
</span></span><span class="line"><span class="cl"><span class="n">tweets</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyStreamer</span><span class="p">(</span><span class="n">TwythonStreamer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">on_success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        What do we do when Twitter sends us data?
</span></span></span><span class="line"><span class="cl"><span class="s2">        Here data will be a Python dict representing a tweet.
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># We only want to collect English-language tweets</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lang&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;en&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">tweets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;received tweet #</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tweets</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Stop when we&#39;ve collected enough</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tweets</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">on_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">stream</span> <span class="o">=</span> <span class="n">MyStreamer</span><span class="p">(</span><span class="n">CONSUMER_KEY</span><span class="p">,</span> <span class="n">CONSUMER_SECRET</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ACCESS_TOKEN</span><span class="p">,</span> <span class="n">ACCESS_TOKEN_SECRET</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># starts consuming public statuses that contain the keyword &#39;data&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">stream</span><span class="o">.</span><span class="n">statuses</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">track</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># if instead we wanted to start consuming a sample of *all* public statuses</span>
</span></span><span class="line"><span class="cl"><span class="c1"># stream.statuses.sample()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">top_hashtags</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">hashtag</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                       <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweets</span>
</span></span><span class="line"><span class="cl">                       <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s2">&#34;entities&#34;</span><span class="p">][</span><span class="s2">&#34;hashtags&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">top_hashtags</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</span></span></code></pre></div><h1 id="10-working-with-data">10 Working With Data<a aria-label="Link to this section" class="paige-header-link" href="#10-working-with-data"></a></h1>
<h3 id="101-exploring-your-data">10.1 Exploring Your data<a aria-label="Link to this section" class="paige-header-link" href="#101-exploring-your-data"></a></h3>
<p><em>One Dimension: just one axis</em></p>
<ul>
<li>histogram  a distribution</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</span></span><span class="line"><span class="cl">	<span class="kn">import</span> <span class="nn">math</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">bucketize</span><span class="p">(</span><span class="n">point</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">bucket_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="s2">&#34;&#34;&#34;Floor the point to the next lower multiple of bucket_size&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">bucket_size</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">point</span> <span class="o">/</span> <span class="n">bucket_size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">make_histogram</span><span class="p">(</span><span class="n">points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">bucket_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">	    <span class="s2">&#34;&#34;&#34;Buckets the points and counts how many in each bucket&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">Counter</span><span class="p">(</span><span class="n">bucketize</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">bucket_size</span><span class="p">)</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">plot_histogram</span><span class="p">(</span><span class="n">points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">bucket_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	    <span class="n">histogram</span> <span class="o">=</span> <span class="n">make_histogram</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">bucket_size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">histogram</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">width</span><span class="o">=</span><span class="n">bucket_size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># normal distribution with mean 0, standard deviation 57</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl"><span class="c1"># uniform between -100 and 100</span>
</span></span><span class="line"><span class="cl"><span class="n">uniform</span> <span class="o">=</span> <span class="p">[</span><span class="mi">200</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">-</span> <span class="mi">100</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">plot_histogram</span><span class="p">(</span><span class="n">uniform</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&#34;Uniform Histogram&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p><em>Two Dimensions: Compare 2 Variables Via Scatter Plot</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define 2 axis input</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">random_normal</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Returns a random draw from a standard normal distribution&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">inverse_normal_cdf</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">random_normal</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">ys1</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span> <span class="o">+</span> <span class="n">random_normal</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">ys2</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">x</span> <span class="o">+</span> <span class="n">random_normal</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys1</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ys1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ys2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;xs&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ys&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Very Different Joint Distributions&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><p><em>Many Dimensions</em></p>
<ul>
<li>use correlation matrix</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scratch.linear_algebra</span> <span class="kn">import</span> <span class="n">Matrix</span><span class="p">,</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">make_matrix</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">correlation_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Vector</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Matrix</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns the len(data) x len(data) matrix whose (i, j)-th entry
</span></span></span><span class="line"><span class="cl"><span class="s2">    is the correlation between data[i] and data[j]
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">correlation_ij</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">correlation</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">make_matrix</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">correlation_ij</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># corr_data is a list of four 100-d vectors</span>
</span></span><span class="line"><span class="cl"><span class="n">num_vectors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">corr_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num_vectors</span><span class="p">,</span> <span class="n">num_vectors</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vectors</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vectors</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Scatter column_j on the x-axis vs. column_i on the y-axis</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">corr_data</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">corr_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># unless i == j, in which case show the series name</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&#34;series &#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                                <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">ha</span><span class="o">=</span><span class="s2">&#34;center&#34;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&#34;center&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Then hide axis labels except left and bottom charts</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_vectors</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Fix the bottom-right and top-left axis labels, which are wrong because</span>
</span></span><span class="line"><span class="cl"><span class="c1"># their charts only have text in them</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><h3 id="102-using-named-tuples-to-model-data">10.2 Using Named Tuples To Model Data<a aria-label="Link to this section" class="paige-header-link" href="#102-using-named-tuples-to-model-data"></a></h3>
<ul>
<li>
<p>Rationale:</p>
<ul>
<li>using dict is error prone because of undefined keys.</li>
<li>NamedTuple is a tuple, and is better than ordinary tuple
<ul>
<li>because we can access with named slots</li>
<li>like tuple, it is also immutable</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">StockPrice</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;StockPrice&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;closing_price&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">price</span> <span class="o">=</span> <span class="n">StockPrice</span><span class="p">(</span><span class="s1">&#39;MSFT&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="mf">106.03</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">price</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;MSFT&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">price</span><span class="o">.</span><span class="n">closing_price</span> <span class="o">==</span> <span class="mf">106.03</span>
</span></span></code></pre></div></li>
</ul>
<h3 id="103-dataclasses">10.3 Dataclasses<a aria-label="Link to this section" class="paige-header-link" href="#103-dataclasses"></a></h3>
<ul>
<li>
<p>Mutable data structure</p>
</li>
<li>
<p>Dataclass usage may feel like a namedtuple but it is</p>
<ul>
<li>data classes
<ul>
<li>are implemented as classes</li>
<li>is mutable</li>
</ul>
</li>
<li>while nametuple is implemented as tuples (which is more compact)</li>
</ul>
</li>
<li>
<p>Implement with decorator</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="nd">@dataclass</span>
</span></span><span class="line"><span class="cl">	<span class="k">class</span> <span class="nc">StockPrice2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">	    <span class="n">date</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span>
</span></span><span class="line"><span class="cl">	    <span class="n">closing_price</span><span class="p">:</span> <span class="nb">float</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	    <span class="k">def</span> <span class="nf">is_high_tech</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	        <span class="s2">&#34;&#34;&#34;It&#39;s a class, so we can add methods too&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;MSFT&#39;</span><span class="p">,</span> <span class="s1">&#39;GOOG&#39;</span><span class="p">,</span> <span class="s1">&#39;FB&#39;</span><span class="p">,</span> <span class="s1">&#39;AMZN&#39;</span><span class="p">,</span> <span class="s1">&#39;AAPL&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">price2</span> <span class="o">=</span> <span class="n">StockPrice2</span><span class="p">(</span><span class="s1">&#39;MSFT&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="mf">106.03</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">assert</span> <span class="n">price2</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;MSFT&#39;</span>
</span></span><span class="line"><span class="cl">	<span class="k">assert</span> <span class="n">price2</span><span class="o">.</span><span class="n">closing_price</span> <span class="o">==</span> <span class="mf">106.03</span>
</span></span><span class="line"><span class="cl">	<span class="k">assert</span> <span class="n">price2</span><span class="o">.</span><span class="n">is_high_tech</span><span class="p">()</span>
</span></span></code></pre></div><h3 id="104-cleaning-and-munging">10.4 Cleaning and Munging<a aria-label="Link to this section" class="paige-header-link" href="#104-cleaning-and-munging"></a></h3>
<ul>
<li>What to do with bad data (invalid format, etc..) ?
<ol>
<li>Reject data
<ol>
<li>maybe ok if we have billions of record</li>
</ol>
</li>
<li>Fix the source</li>
<li>Do nothing and hope (haha..)</li>
</ol>
</li>
</ul>
<h3 id="105-manipulating-data">10.5 Manipulating data<a aria-label="Link to this section" class="paige-header-link" href="#105-manipulating-data"></a></h3>
<ul>
<li>What columns, precision do we want to collect?</li>
<li>This is where the business and domain logic first starts to creep in</li>
</ul>
<h3 id="106-rescaling">10.6 Rescaling<a aria-label="Link to this section" class="paige-header-link" href="#106-rescaling"></a></h3>
<ul>
<li>Refer to ==Book: Feature Scaling For Machine Learning== for more details</li>
</ul>
<h3 id="107-tqdm">10.7 TQDM<a aria-label="Link to this section" class="paige-header-link" href="#107-tqdm"></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">tqdm</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># do something slow</span>
</span></span><span class="line"><span class="cl">    <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)]</span>
</span></span></code></pre></div><h3 id="108-dimension-reduction">10.8 Dimension Reduction<a aria-label="Link to this section" class="paige-header-link" href="#108-dimension-reduction"></a></h3>
<h1 id="11-machine-learning">11 Machine Learning<a aria-label="Link to this section" class="paige-header-link" href="#11-machine-learning"></a></h1>
<h3 id="111-modeling">11.1 Modeling<a aria-label="Link to this section" class="paige-header-link" href="#111-modeling"></a></h3>
<ul>
<li>Models are mathematical (or probabilistic) relationship that exists between different variables.</li>
</ul>
<h3 id="112-what-is-ml">11.2 What is ML?<a aria-label="Link to this section" class="paige-header-link" href="#112-what-is-ml"></a></h3>
<ul>
<li>machine learning to refer to creating and using models that are learned from data</li>
</ul>
<h3 id="113-overfitting-and-underfitting">11.3 Overfitting and Underfitting<a aria-label="Link to this section" class="paige-header-link" href="#113-overfitting-and-underfitting"></a></h3>
<ul>
<li>Refer to [[Book - Machine Learning System Design Interview - Detail]]  4.1.3 Regularization</li>
</ul>
<h3 id="114-bias-variance-tradeoffs">11.4 Bias Variance TradeOffs<a aria-label="Link to this section" class="paige-header-link" href="#114-bias-variance-tradeoffs"></a></h3>
<h3 id="115-feature-extraction-and-selection">11.5 Feature Extraction and Selection<a aria-label="Link to this section" class="paige-header-link" href="#115-feature-extraction-and-selection"></a></h3>
<ul>
<li>IMOW: book is a bit shallow on this
<ul>
<li>Dimensional reduction</li>
<li>Regularizationn chang</li>
<li></li>
</ul>
</li>
</ul>
<h1 id="12-k-nearest-neighbor">12 K Nearest Neighbor<a aria-label="Link to this section" class="paige-header-link" href="#12-k-nearest-neighbor"></a></h1>
<h3 id="121-the-model">12.1 The Model<a aria-label="Link to this section" class="paige-header-link" href="#121-the-model"></a></h3>
<ul>
<li>
<p>How it works</p>
<ol>
<li>Look at the K nearest points, as measured by a distance function</li>
<li>The predicted label is the function of the the neighbor&rsquo;s label</li>
</ol>
<ul>
<li>But what about ties?</li>
<li>Pick one of the winners at random.</li>
<li>Weight the votes by distance and pick the weighted winner.</li>
<li>Reduce k until we find a unique winner.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">majority_vote</span><span class="p">(</span><span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Assumes that labels are ordered from nearest to farthest.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">vote_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">winner</span><span class="p">,</span> <span class="n">winner_count</span> <span class="o">=</span> <span class="n">vote_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">num_winners</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">count</span>
</span></span><span class="line"><span class="cl">                           <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">vote_counts</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                           <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="n">winner_count</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">num_winners</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">winner</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># try again without the farthest</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">majority_vote</span><span class="p">(</span><span class="n">labels</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Tie, so look at first 4, then &#39;b&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">majority_vote</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="err">```</span>
</span></span></code></pre></div></li>
<li>
<p>Algorithm</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scratch.linear_algebra</span> <span class="kn">import</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">distance</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LabeledPoint</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">point</span><span class="p">:</span> <span class="n">Vector</span>
</span></span><span class="line"><span class="cl">    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">dot</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v_i</span> <span class="o">*</span> <span class="n">w_i</span> <span class="k">for</span> <span class="n">v_i</span><span class="p">,</span> <span class="n">w_i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># sum of sqaures of 1 vector can be defined in terms of dot function</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">sum_of_squares</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">squared_distance</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Computes (v_1 - w_1) ** 2 + ... + (v_n - w_n) ** 2&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">sum_of_squares</span><span class="p">(</span><span class="n">subtract</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Euclidean distance</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Computes the distance between v and w&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">squared_distance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">knn_classify</span><span class="p">(</span><span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                 <span class="n">labeled_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">LabeledPoint</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="n">new_point</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Order the labeled points from nearest to farthest.</span>
</span></span><span class="line"><span class="cl">    <span class="n">by_distance</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">labeled_points</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                         <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">distance</span><span class="p">(</span><span class="n">lp</span><span class="o">.</span><span class="n">point</span><span class="p">,</span> <span class="n">new_point</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Find the labels for the k closest</span>
</span></span><span class="line"><span class="cl">    <span class="n">k_nearest_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">lp</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">lp</span> <span class="ow">in</span> <span class="n">by_distance</span><span class="p">[:</span><span class="n">k</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># and let them vote.</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">majority_vote</span><span class="p">(</span><span class="n">k_nearest_labels</span><span class="p">)</span>
</span></span></code></pre></div></li>
<li>
<p>Vs KMeans Clustering</p>
<ul>
<li>KNN is a supervised machine learning algorithm used for ==classification==</li>
<li>KMeans is an unsupervised machine learning algorithm used for clustering.</li>
</ul>
</li>
</ul>
<h3 id="122-example-iris-dataset">12.2 Example: Iris Dataset<a aria-label="Link to this section" class="paige-header-link" href="#122-example-iris-dataset"></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># track how many times we see (predicted, actual)</span>
</span></span><span class="line"><span class="cl"><span class="n">confusion_matrix</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">num_correct</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">iris</span> <span class="ow">in</span> <span class="n">iris_test</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">predicted</span> <span class="o">=</span> <span class="n">knn_classify</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">iris_train</span><span class="p">,</span> <span class="n">iris</span><span class="o">.</span><span class="n">point</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">actual</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">label</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">predicted</span> <span class="o">==</span> <span class="n">actual</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">num_correct</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">confusion_matrix</span><span class="p">[(</span><span class="n">predicted</span><span class="p">,</span> <span class="n">actual</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pct_correct</span> <span class="o">=</span> <span class="n">num_correct</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">iris_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">pct_correct</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="123-curse-of-dimensionality">12.3 Curse of Dimensionality<a aria-label="Link to this section" class="paige-header-link" href="#123-curse-of-dimensionality"></a></h3>
<ul>
<li>Limitation of K nearest neighbor is high dimensions space are vast, increasing the chance the points are not close to each other.
<ul>
<li>two points are close only if they’re close in every dimension, and every extra dimension—even if just noise—is another opportunity for each point to be farther away from every other point. When you have a lot of dimensions, it’s likely that the closest points aren’t much closer than average, so two points being close doesn’t mean very much</li>
</ul>
</li>
</ul>
<h3 id="124-further-exploration">12.4 Further Exploration<a aria-label="Link to this section" class="paige-header-link" href="#124-further-exploration"></a></h3>
<h1 id="13-naives-bayes">13 Naives Bayes<a aria-label="Link to this section" class="paige-header-link" href="#13-naives-bayes"></a></h1>
<h3 id="131-really-dumb-spam-filter">13.1 Really Dumb Spam Filter<a aria-label="Link to this section" class="paige-header-link" href="#131-really-dumb-spam-filter"></a></h3>
<ul>
<li>Given
<ul>
<li>S = Spam</li>
<li>X is a vector of word length n</li>
</ul>
</li>
<li>The probability of spam for the sentence is
$$ P(S | X) = [P(X | S)\times P(S)] / P(X)  $$</li>
</ul>
<h3 id="132-more-sophisticated-spam-filter">13.2 More Sophisticated Spam Filter<a aria-label="Link to this section" class="paige-header-link" href="#132-more-sophisticated-spam-filter"></a></h3>
<ul>
<li>
<p>Need to address case  Numerical underflow
$$P(X_1 = x_1,..X_n=x_n) = P(X_1=x_1|S) \times &hellip; \times P(X_n=x_n | S)$$
$$ = \exp[ log(P(X_1=x_1|S)) + log(P(X_n=x_n|S)) ]$$
$$P(X_1=x_1|S) + .. + .. P(X_n=x_n|S)  $$</p>
</li>
<li>
<p>Also need to address : For rare words in spam text messages&ndash;&gt; aka smoothing
$$P(X_i | Spam) = (k + numSpamsContainingX_i)/(2k + numSpams )$$</p>
</li>
</ul>
<h3 id="133-implementation">13.3 Implementation<a aria-label="Link to this section" class="paige-header-link" href="#133-implementation"></a></h3>
<p><em>Code: Naives Bayes</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Set</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>                         <span class="c1"># Convert to lowercase,</span>
</span></span><span class="line"><span class="cl">    <span class="n">all_words</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&#34;[a-z0-9&#39;]+&#34;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>  <span class="c1"># extract the words, and</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">all_words</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">is_spam</span><span class="p">:</span> <span class="nb">bool</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterable</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">math</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NaiveBayesClassifier</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>  <span class="c1"># smoothing factor</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">token_spam_counts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">token_ham_counts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">spam_messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ham_messages</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Message</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Increment message counts</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">is_spam</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">spam_messages</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">ham_messages</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Increment word counts</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">is_spam</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">token_spam_counts</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">token_ham_counts</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">_probabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;returns P(token | spam) and P(token | ham)&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">spam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">token_spam_counts</span><span class="p">[</span><span class="n">token</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">ham</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">token_ham_counts</span><span class="p">[</span><span class="n">token</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">p_token_spam</span> <span class="o">=</span> <span class="p">(</span><span class="n">spam</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spam_messages</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">p_token_ham</span> <span class="o">=</span> <span class="p">(</span><span class="n">ham</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ham_messages</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">p_token_spam</span><span class="p">,</span> <span class="n">p_token_ham</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">text_tokens</span> <span class="o">=</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">log_prob_if_spam</span> <span class="o">=</span> <span class="n">log_prob_if_ham</span> <span class="o">=</span> <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Iterate through each word in our vocabulary</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">prob_if_spam</span><span class="p">,</span> <span class="n">prob_if_ham</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># If *token* appears in the message,</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># add the log probability of seeing it</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">text_tokens</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">log_prob_if_spam</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">prob_if_spam</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">log_prob_if_ham</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">prob_if_ham</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Otherwise add the log probability of _not_ seeing it,</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># which is log(1 - probability of seeing it)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">log_prob_if_spam</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">prob_if_spam</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">log_prob_if_ham</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">prob_if_ham</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">prob_if_spam</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_prob_if_spam</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">prob_if_ham</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_prob_if_ham</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">prob_if_spam</span> <span class="o">/</span> <span class="p">(</span><span class="n">prob_if_spam</span> <span class="o">+</span> <span class="n">prob_if_ham</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="134-testing">13.4 Testing<a aria-label="Link to this section" class="paige-header-link" href="#134-testing"></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">Message</span><span class="p">(</span><span class="s2">&#34;spam rules&#34;</span><span class="p">,</span> <span class="n">is_spam</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">Message</span><span class="p">(</span><span class="s2">&#34;ham rules&#34;</span><span class="p">,</span> <span class="n">is_spam</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">Message</span><span class="p">(</span><span class="s2">&#34;hello ham&#34;</span><span class="p">,</span> <span class="n">is_spam</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">NaiveBayesClassifier</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">text</span> <span class="o">=</span> <span class="s2">&#34;hello spam&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">probs_if_spam</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">),</span>      <span class="c1"># &#34;spam&#34;  (present)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">),</span>  <span class="c1"># &#34;ham&#34;   (not present)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">),</span>  <span class="c1"># &#34;rules&#34; (not present)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span>       <span class="c1"># &#34;hello&#34; (present)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">probs_if_ham</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">),</span>      <span class="c1"># &#34;spam&#34;  (present)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">),</span>  <span class="c1"># &#34;ham&#34;   (not present)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">),</span>  <span class="c1"># &#34;rules&#34; (not present)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">),</span>      <span class="c1"># &#34;hello&#34; (present)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p_if_spam</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">probs_if_spam</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">p_if_ham</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">probs_if_ham</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Should be about 0.83</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">==</span> <span class="n">p_if_spam</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_if_spam</span> <span class="o">+</span> <span class="n">p_if_ham</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="135-using-the-model">13.5 Using The Model<a aria-label="Link to this section" class="paige-header-link" href="#135-using-the-model"></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>  <span class="c1"># So we can treat bytes as a file.</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>         <span class="c1"># To download the files, which</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">tarfile</span>          <span class="c1"># are in .tar.bz format.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">BASE_URL</span> <span class="o">=</span> <span class="s2">&#34;https://spamassassin.apache.org/old/publiccorpus&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">FILES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;20021010_easy_ham.tar.bz2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;20021010_hard_ham.tar.bz2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;20021010_spam.tar.bz2&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># This is where the data will end up,</span>
</span></span><span class="line"><span class="cl"><span class="c1"># in /spam, /easy_ham, and /hard_ham subdirectories.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Change this to where you want the data.</span>
</span></span><span class="line"><span class="cl"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="s1">&#39;spam_data&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">FILES</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Use requests to get the file contents at each URL.</span>
</span></span><span class="line"><span class="cl">    <span class="n">content</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Wrap the in-memory bytes so we can use them as a &#34;file.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">fin</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># And extract all the files to the specified output dir.</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">fin</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r:bz2&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">tf</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">OUTPUT_DIR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">glob</span><span class="o">,</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="c1"># modify the path to wherever you&#39;ve put the files</span>
</span></span><span class="line"><span class="cl"><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;spam_data/*/*&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Message</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># glob.glob returns every filename that matches the wildcarded path</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">is_spam</span> <span class="o">=</span> <span class="s2">&#34;ham&#34;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filename</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># There are some garbage characters in the emails; the errors=&#39;ignore&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># skips them instead of raising an exception.</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">email_file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">email_file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&#34;Subject:&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">subject</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&#34;Subject: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Message</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">is_spam</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>  <span class="c1"># done with this file</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scratch.machine_learning</span> <span class="kn">import</span> <span class="n">split_data</span>
</span></span><span class="line"><span class="cl"><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>      <span class="c1"># just so you get the same answers as me</span>
</span></span><span class="line"><span class="cl"><span class="n">train_messages</span><span class="p">,</span> <span class="n">test_messages</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">NaiveBayesClassifier</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_messages</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</span></span><span class="line"><span class="cl"><span class="n">predictions</span> <span class="o">=</span> <span class="p">[(</span><span class="n">message</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">               <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">test_messages</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Assume that spam_probability &gt; 0.5 corresponds to spam prediction</span>
</span></span><span class="line"><span class="cl"><span class="c1"># and count the combinations of (actual is_spam, predicted is_spam)</span>
</span></span><span class="line"><span class="cl"><span class="n">confusion_matrix</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">((</span><span class="n">message</span><span class="o">.</span><span class="n">is_spam</span><span class="p">,</span> <span class="n">spam_probability</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                           <span class="k">for</span> <span class="n">message</span><span class="p">,</span> <span class="n">spam_probability</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">)</span>
</span></span></code></pre></div><h1 id="14-simple-linear-regression">14 Simple Linear Regression<a aria-label="Link to this section" class="paige-header-link" href="#14-simple-linear-regression"></a></h1>
<h3 id="141-the-model">14.1 The Model<a aria-label="Link to this section" class="paige-header-link" href="#141-the-model"></a></h3>
<ul>
<li>
<p>Task: Predict time of use as a function of numFriends
$$y_i = \beta x_i + \alpha  $$</p>
<ul>
<li>such that
<ul>
<li>$y_i$ is the amount of time user i spend on platform</li>
<li>$x_i$ is the number of friends user_i has on the platform</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Code</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x_i</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">x_i</span> <span class="o">+</span> <span class="n">alpha</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x_i</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y_i</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    The error from predicting beta * x_i + alpha
</span></span></span><span class="line"><span class="cl"><span class="s2">    when the actual value is y_i
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">predict</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">x_i</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_i</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scratch.linear_algebra</span> <span class="kn">import</span> <span class="n">Vector</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">sum_of_sqerrors</span><span class="p">(</span><span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">x_i</span><span class="p">,</span> <span class="n">y_i</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">               <span class="k">for</span> <span class="n">x_i</span><span class="p">,</span> <span class="n">y_i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scratch.linear_algebra</span> <span class="kn">import</span> <span class="n">Vector</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scratch.statistics</span> <span class="kn">import</span> <span class="n">correlation</span><span class="p">,</span> <span class="n">standard_deviation</span><span class="p">,</span> <span class="n">mean</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">least_squares_fit</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Given two vectors x and y,
</span></span></span><span class="line"><span class="cl"><span class="s2">    find the least-squares values of alpha and beta
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">beta</span> <span class="o">=</span> <span class="n">correlation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">standard_deviation</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">standard_deviation</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">alpha</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span>
</span></span></code></pre></div><ul>
<li>Goodness of fit: How well does our parameter fit the data?
<ul>
<li>R-squared (aka coefficient of determination) measures the fraction of total variation in the dependent variable (ie y) is captured by the variable</li>
<li></li>
</ul>
</li>
</ul>
<pre><code>```python
from scratch.statistics import de_mean

def total_sum_of_squares(y: Vector) -&gt; float:
    &quot;&quot;&quot;the total squared variation of y_i's from their mean&quot;&quot;&quot;
    return sum(v ** 2 for v in de_mean(y))

def r_squared(alpha: float, beta: float, x: Vector, y: Vector) -&gt; float:
    &quot;&quot;&quot;
    the fraction of variation in y captured by the model, which equals
    1 - the fraction of variation in y not captured by the model
    &quot;&quot;&quot;
    return 1.0 - (sum_of_sqerrors(alpha, beta, x, y) /
                  total_sum_of_squares(y))
```
</code></pre>
<h3 id="142-using-gradient-descent">14.2 Using Gradient Descent<a aria-label="Link to this section" class="paige-header-link" href="#142-using-gradient-descent"></a></h3>
<ul>
<li>
<p>In 14.1, we solved the close form of the linear equation where we solved the parameters $\alpha \beta$</p>
</li>
<li>
<p>In this section, we use gradient descent as a way to approximate the solution</p>
</li>
<li>
<p>theta = $\alpha , \beta$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">tqdm</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scratch.gradient_descent</span> <span class="kn">import</span> <span class="n">gradient_step</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">10000</span>
</span></span><span class="line"><span class="cl"><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">guess</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()]</span>  <span class="c1"># choose random value to start</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.00001</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">trange</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">)</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">guess</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Partial derivative of loss with respect to alpha</span>
</span></span><span class="line"><span class="cl">        <span class="n">grad_a</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">error</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">x_i</span><span class="p">,</span> <span class="n">y_i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                     <span class="k">for</span> <span class="n">x_i</span><span class="p">,</span> <span class="n">y_i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">num_friends_good</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                         <span class="n">daily_minutes_good</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Partial derivative of loss with respect to beta</span>
</span></span><span class="line"><span class="cl">        <span class="n">grad_b</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">error</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">x_i</span><span class="p">,</span> <span class="n">y_i</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_i</span>
</span></span><span class="line"><span class="cl">                     <span class="k">for</span> <span class="n">x_i</span><span class="p">,</span> <span class="n">y_i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">num_friends_good</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                         <span class="n">daily_minutes_good</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Compute loss to stick in the tqdm description</span>
</span></span><span class="line"><span class="cl">        <span class="n">loss</span> <span class="o">=</span> <span class="n">sum_of_sqerrors</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                               <span class="n">num_friends_good</span><span class="p">,</span> <span class="n">daily_minutes_good</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">t</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Finally, update the guess</span>
</span></span><span class="line"><span class="cl">        <span class="n">guess</span> <span class="o">=</span> <span class="n">gradient_step</span><span class="p">(</span><span class="n">guess</span><span class="p">,</span> <span class="p">[</span><span class="n">grad_a</span><span class="p">,</span> <span class="n">grad_b</span><span class="p">],</span> <span class="o">-</span><span class="n">learning_rate</span><span class="p">)</span>
</span></span></code></pre></div></li>
</ul>
<h3 id="143-maximum-liklihood-estmation-mle">14.3 Maximum Liklihood Estmation (MLE)<a aria-label="Link to this section" class="paige-header-link" href="#143-maximum-liklihood-estmation-mle"></a></h3>
<ul>
<li>In this section, we use MLE to explain why we use least squares fit to derive the closed form for parameters $\alpha, \beta$</li>
<li>MLE estimates the parameters $\theta$ that makes the observed data most probable.
<ul>
<li>Minimizing the sum of squared errors is equivalent to maximizing the likelihood of the observed data.</li>
</ul>
</li>
</ul>
<h1 id="15-multiple-regression">15 Multiple Regression<a aria-label="Link to this section" class="paige-header-link" href="#15-multiple-regression"></a></h1>
<h3 id="15-1-the-model">15. 1 The Model<a aria-label="Link to this section" class="paige-header-link" href="#15-1-the-model"></a></h3>
<ul>
<li>
<p>In Chapter 14, we solve a linear equation with 2 parameters. In this chapter, we increase the number of parameters we will learn.</p>
</li>
<li>
<p>Let&rsquo;s increase the num parameter we learn (go beyond a linear line)
$$y_i = \alpha + \beta_1x_{i1} + &hellip; + \beta_kx_{ik}$$</p>
<ul>
<li>where
<ul>
<li>i = user i</li>
<li>k = number of parameters we are fitting</li>
</ul>
</li>
</ul>
</li>
<li>
<p>model learn parameter as a vector 	$$\beta = [\alpha, \beta_1, .., \beta_k]$$</p>
</li>
<li>
<p>predict code</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;assumes that the first element of x is 1&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
</span></span></code></pre></div></li>
</ul>
<h3 id="15-2-further-assumptions-of-least-squares-model">15. 2 Further Assumptions of Least Squares Model<a aria-label="Link to this section" class="paige-header-link" href="#15-2-further-assumptions-of-least-squares-model"></a></h3>
<ul>
<li>Key assumptions
<ul>
<li>All the features are linearly independent</li>
<li>The parameter of input vector x are uncorrelated with the error</li>
</ul>
</li>
</ul>
<h3 id="153-fitting-the-model">15.3 Fitting the Model<a aria-label="Link to this section" class="paige-header-link" href="#153-fitting-the-model"></a></h3>
<p><em>Code: Helper Functions</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">squared_error</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">error</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">sqerror_gradient</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="n">err</span> <span class="o">=</span> <span class="n">error</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">err</span> <span class="o">*</span> <span class="n">x_i</span> <span class="k">for</span> <span class="n">x_i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span></code></pre></div><p><em>Code: Least Squares Fit</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl">	<span class="kn">import</span> <span class="nn">tqdm</span>
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">scratch.linear_algebra</span> <span class="kn">import</span> <span class="n">vector_mean</span>
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">scratch.gradient_descent</span> <span class="kn">import</span> <span class="n">gradient_step</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">least_squares_fit</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Vector</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	                      <span class="n">ys</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	                      <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	                      <span class="n">num_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	                      <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">	    Find the beta that minimizes the sum of squared errors
</span></span></span><span class="line"><span class="cl"><span class="s2">	    assuming the model y = dot(x, beta).
</span></span></span><span class="line"><span class="cl"><span class="s2">	    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="c1"># Start with a random guess</span>
</span></span><span class="line"><span class="cl">	    <span class="n">guess</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">trange</span><span class="p">(</span><span class="n">num_steps</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&#34;least squares fit&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	        <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	            <span class="n">batch_xs</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="n">batch_size</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	            <span class="n">batch_ys</span> <span class="o">=</span> <span class="n">ys</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="n">batch_size</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	            <span class="n">gradient</span> <span class="o">=</span> <span class="n">vector_mean</span><span class="p">([</span><span class="n">sqerror_gradient</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">guess</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	                                    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">batch_xs</span><span class="p">,</span> <span class="n">batch_ys</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">	            <span class="n">guess</span> <span class="o">=</span> <span class="n">gradient_step</span><span class="p">(</span><span class="n">guess</span><span class="p">,</span> <span class="n">gradient</span><span class="p">,</span> <span class="o">-</span><span class="n">learning_rate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">guess</span>
</span></span></code></pre></div><h3 id="154-interpreting-the-model">15.4 Interpreting the Model<a aria-label="Link to this section" class="paige-header-link" href="#154-interpreting-the-model"></a></h3>
<ul>
<li>The value of the learned coefficients represents the importance of that features, assuming ==all else being equal (big caveat)==
<ul>
<li>Ex: all else being equal, having one friend translate to 2 minutes on the app</li>
<li>Parameters do not explain how the variables interact with each other.</li>
</ul>
</li>
</ul>
<h3 id="155-goodness-of-fit">15.5 Goodness of Fit<a aria-label="Link to this section" class="paige-header-link" href="#155-goodness-of-fit"></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">scratch.simple_linear_regression</span> <span class="kn">import</span> <span class="n">total_sum_of_squares</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">multiple_r_squared</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Vector</span><span class="p">],</span> <span class="n">ys</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="n">sum_of_squared_errors</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">	                                <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">sum_of_squared_errors</span> <span class="o">/</span> <span class="n">total_sum_of_squares</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="156-the-bootstrap">15.6 The Bootstrap<a aria-label="Link to this section" class="paige-header-link" href="#156-the-bootstrap"></a></h3>
<ul>
<li>
<p>Bootstrapping is a method of inferring results for a population from results found on a collection of ==smaller random ==samples== of that population, <strong>using replacement during the sampling process</strong>.</p>
</li>
<li>
<p>Code: utility function</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Callable</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">X</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>        <span class="c1"># Generic type for data</span>
</span></span><span class="line"><span class="cl">	<span class="n">Stat</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;Stat&#39;</span><span class="p">)</span>  <span class="c1"># Generic type for &#34;statistic&#34;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">bootstrap_sample</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">X</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">X</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">	    <span class="s2">&#34;&#34;&#34;randomly samples len(data) elements with replacement&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">bootstrap_statistic</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">X</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	                        <span class="n">stats_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">List</span><span class="p">[</span><span class="n">X</span><span class="p">]],</span> <span class="n">Stat</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	                        <span class="n">num_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Stat</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">	    <span class="s2">&#34;&#34;&#34;evaluates stats_fn on num_samples bootstrap samples from data&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="p">[</span><span class="n">stats_fn</span><span class="p">(</span><span class="n">bootstrap_sample</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">)]</span>
</span></span></code></pre></div><ul>
<li>Code: usage</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 101 points all very close to 100</span>
</span></span><span class="line"><span class="cl"><span class="n">close_to_100</span> <span class="o">=</span> <span class="p">[</span><span class="mf">99.5</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">101</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">medians_close</span> <span class="o">=</span> <span class="n">bootstrap_statistic</span><span class="p">(</span><span class="n">close_to_100</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 101 points, 50 of them near 0, 50 of them near 200</span>
</span></span><span class="line"><span class="cl"><span class="n">far_from_100</span> <span class="o">=</span> <span class="p">([</span><span class="mf">99.5</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()]</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)]</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                <span class="p">[</span><span class="mi">200</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl"><span class="n">medians_far</span> <span class="o">=</span> <span class="n">bootstrap_statistic</span><span class="p">(</span><span class="n">far_from_100</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="157-standard-errors-of-regression-coefficient">15.7 Standard Errors of Regression Coefficient<a aria-label="Link to this section" class="paige-header-link" href="#157-standard-errors-of-regression-coefficient"></a></h3>
<h3 id="158-regularization">15.8 Regularization<a aria-label="Link to this section" class="paige-header-link" href="#158-regularization"></a></h3>
<ul>
<li>Regularization is an approach in which we add to the error term a penalty that gets larger as beta gets larger. We then minimize the combined error and penalty. The more importance we place on the penalty term, the more we discourage large coefficients.</li>
<li>2 Types in LInear Regression
<ol>
<li>Ridge (aka L2)
<ol>
<li>shrink the coefficient overall</li>
</ol>
</li>
<li>Lasso (aka L1)
<ol>
<li>drive coefficient to 0 to learn more sparse models</li>
</ol>
</li>
</ol>
</li>
<li>Code: Ridge (L2)</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="c1"># alpha is a *hyperparameter* controlling how harsh the penalty is.</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># Sometimes it&#39;s called &#34;lambda&#34; but that already means something in Python.</span>
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">ridge_penalty</span><span class="p">(</span><span class="n">beta</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">dot</span><span class="p">(</span><span class="n">beta</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">beta</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">squared_error_ridge</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	                        <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	                        <span class="n">beta</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	                        <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="s2">&#34;&#34;&#34;estimate error plus ridge penalty on beta&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">error</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">ridge_penalty</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">scratch.linear_algebra</span> <span class="kn">import</span> <span class="n">add</span>
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">ridge_penalty_gradient</span><span class="p">(</span><span class="n">beta</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="s2">&#34;&#34;&#34;gradient of just the ridge penalty&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">beta_j</span> <span class="k">for</span> <span class="n">beta_j</span> <span class="ow">in</span> <span class="n">beta</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">sqerror_ridge_gradient</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	                           <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	                           <span class="n">beta</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	                           <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">	    the gradient corresponding to the ith squared error term
</span></span></span><span class="line"><span class="cl"><span class="s2">	    including the ridge penalty
</span></span></span><span class="line"><span class="cl"><span class="s2">	    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">add</span><span class="p">(</span><span class="n">sqerror_gradient</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">	               <span class="n">ridge_penalty_gradient</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">))</span>	
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="c1"># TEST CODE</span>
</span></span><span class="line"><span class="cl">	<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">beta_0</span> <span class="o">=</span> <span class="n">least_squares_fit_ridge</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">daily_minutes_good</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># alpha</span>
</span></span><span class="line"><span class="cl">	                                 <span class="n">learning_rate</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</span></span></code></pre></div><ul>
<li>Code: Lasso</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">lasso_penalty</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">alpha</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">beta_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">beta_i</span> <span class="ow">in</span> <span class="n">beta</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span></span></code></pre></div><h1 id="16-logistic-regression">16 Logistic Regression<a aria-label="Link to this section" class="paige-header-link" href="#16-logistic-regression"></a></h1>
<h3 id="161-the-problem">16.1 The Problem<a aria-label="Link to this section" class="paige-header-link" href="#161-the-problem"></a></h3>
<ul>
<li>
<p>Potential issues with linear regression models</p>
<ul>
<li>Output model range does not match our end use case of 0 or 1</li>
<li>Linear regression assumes
<ol>
<li>Linear relationship between X and the mean of Y
<ol>
<li>Not true if R coefficient is positive</li>
</ol>
</li>
<li>Variance of residual is the same for any value of X</li>
<li>Observations are independent of each other</li>
</ol>
</li>
</ul>
</li>
<li>
<p>Logistic function
$$y = \frac{1}{1 + e^{-x}}$$
$$x = f(x_i\beta)$$</p>
</li>
</ul>
<h3 id="162-the-logistic-function">16.2 The Logistic Function<a aria-label="Link to this section" class="paige-header-link" href="#162-the-logistic-function"></a></h3>
<h3 id="163-applying-the-model">16.3 Applying the Model<a aria-label="Link to this section" class="paige-header-link" href="#163-applying-the-model"></a></h3>
<h3 id="164-goodness-of-fit">16.4 Goodness of Fit<a aria-label="Link to this section" class="paige-header-link" href="#164-goodness-of-fit"></a></h3>
<h3 id="165-support-vector-machines">16.5 Support Vector Machines<a aria-label="Link to this section" class="paige-header-link" href="#165-support-vector-machines"></a></h3>
<h1 id="17-decision-tree">17 Decision Tree<a aria-label="Link to this section" class="paige-header-link" href="#17-decision-tree"></a></h1>
<h3 id="171-what-is-a-decision-tree">17.1 What is a Decision Tree<a aria-label="Link to this section" class="paige-header-link" href="#171-what-is-a-decision-tree"></a></h3>
<ul>
<li>A decision tree uses a tree structure to represent a number of possible decision paths and an outcome for each path.</li>
</ul>
<h3 id="172-entropy">17.2 Entropy<a aria-label="Link to this section" class="paige-header-link" href="#172-entropy"></a></h3>
<ul>
<li>
<p>Entropy measure how much information/randomness there is</p>
<ul>
<li>Applied to ML,
<ul>
<li>high entropy means there are multiple classes label in the set</li>
<li>low entropy means there are few (or 1) class label in the set</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Mathematics
$$H(S) = -p_1\log_2p_1 - &hellip; -p_n\log_2p_n $$</p>
<ul>
<li>S = Partition Set</li>
<li>$p_n$ is the proportion of class | label in the set S</li>
<li>==Entropy is lowest when the $p_n$ is 0 or 1 ==</li>
</ul>
</li>
<li>
<p>Code</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span>
</span></span><span class="line"><span class="cl">	<span class="kn">import</span> <span class="nn">math</span>
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">entropy</span><span class="p">(</span><span class="n">class_probabilities</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="s2">&#34;&#34;&#34;Given a list of class probabilities, compute the entropy&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="o">-</span><span class="n">p</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	               <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">class_probabilities</span>
</span></span><span class="line"><span class="cl">	               <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>                     <span class="c1"># ignore zero probabilities</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">class_probabilities</span><span class="p">(</span><span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">	    <span class="n">total_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="p">[</span><span class="n">count</span> <span class="o">/</span> <span class="n">total_count</span>
</span></span><span class="line"><span class="cl">	            <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">data_entropy</span><span class="p">(</span><span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">entropy</span><span class="p">(</span><span class="n">class_probabilities</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
</span></span></code></pre></div><h3 id="173-entropy-of-a-partition">17.3 Entropy of a Partition<a aria-label="Link to this section" class="paige-header-link" href="#173-entropy-of-a-partition"></a></h3>
<ul>
<li>
<p>Lowest entropy of a  partition is when all the member in a set belongs to a label class</p>
</li>
<li>
<p>Mathematics to calculate the entropy of a partition</p>
<ul>
<li>==If we partition the data by a feature (ie gender) and its value(ie female), we will create multiple sets, each set will have data with labels from class 1 to m==
$$H_{partition} = q_1H(S_1) + &hellip; + q_mH(S_m)$$
<ul>
<li>where</li>
<li>$q_m$ is the proportion of data with class label m</li>
<li>$S_m$ is the resulting set where all the data has gender=male (as an example), but the remaining features (age, race) will each be split until we reach the leaf node.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Code</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">partition_entropy</span><span class="p">(</span><span class="n">subsets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Returns the entropy from this partition of data into subsets&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># subsets is S1, S2, .., S_m in our equation above </span>
</span></span><span class="line"><span class="cl">    <span class="n">total_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span> <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="n">subsets</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data_entropy</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_count</span>
</span></span><span class="line"><span class="cl">               <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="n">subsets</span><span class="p">)</span>
</span></span></code></pre></div></li>
</ul>
<h3 id="174-creating-a-decision-tree">17.4 Creating a Decision Tree<a aria-label="Link to this section" class="paige-header-link" href="#174-creating-a-decision-tree"></a></h3>
<p><em>Algorithm-Simplified</em></p>
<ol>
<li>If the data all have the same label, create a leaf node that predicts that label and then stop.</li>
<li>If the list of attributes is empty (i.e., there are no more possible questions to ask), create a leaf node that predicts the most common label and then stop.</li>
<li>Otherwise, try partitioning the data by each of the attributes (aka feature).</li>
<li>Choose the partition with the ==lowest partition entropy==.</li>
<li>Add a decision node based on the chosen attribute.</li>
<li>Recur on each partitioned subset using the remaining attributes.</li>
</ol>
<h5 id="1741-example-decision-tree-to-see-whether-to-interview-someone-based-on-the-features-level-language-tweets-and-phd">17.4.1 Example: Decision tree to see whether to interview someone based on the features level, language, tweets, and phd<a aria-label="Link to this section" class="paige-header-link" href="#1741-example-decision-tree-to-see-whether-to-interview-someone-based-on-the-features-level-language-tweets-and-phd"></a></h5>
<p><em>Mock Data</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">Optional</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Candidate</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">level</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">lang</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">tweets</span><span class="p">:</span> <span class="nb">bool</span>
</span></span><span class="line"><span class="cl">    <span class="n">phd</span><span class="p">:</span> <span class="nb">bool</span>
</span></span><span class="line"><span class="cl">    <span class="n">did_well</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># allow unlabeled data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                  <span class="c1">#  level     lang     tweets  phd  did_well</span>
</span></span><span class="line"><span class="cl"><span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Candidate</span><span class="p">(</span><span class="s1">&#39;Senior&#39;</span><span class="p">,</span> <span class="s1">&#39;Java&#39;</span><span class="p">,</span>   <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">Candidate</span><span class="p">(</span><span class="s1">&#39;Senior&#39;</span><span class="p">,</span> <span class="s1">&#39;Java&#39;</span><span class="p">,</span>   <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>  <span class="kc">False</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">Candidate</span><span class="p">(</span><span class="s1">&#39;Mid&#39;</span><span class="p">,</span>    <span class="s1">&#39;Python&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">Candidate</span><span class="p">(</span><span class="s1">&#39;Junior&#39;</span><span class="p">,</span> <span class="s1">&#39;Python&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">Candidate</span><span class="p">(</span><span class="s1">&#39;Junior&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span>      <span class="kc">True</span><span class="p">,</span>  <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">Candidate</span><span class="p">(</span><span class="s1">&#39;Junior&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span>      <span class="kc">True</span><span class="p">,</span>  <span class="kc">True</span><span class="p">,</span>  <span class="kc">False</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">Candidate</span><span class="p">(</span><span class="s1">&#39;Mid&#39;</span><span class="p">,</span>    <span class="s1">&#39;R&#39;</span><span class="p">,</span>      <span class="kc">True</span><span class="p">,</span>  <span class="kc">True</span><span class="p">,</span>  <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">Candidate</span><span class="p">(</span><span class="s1">&#39;Senior&#39;</span><span class="p">,</span> <span class="s1">&#39;Python&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>
</span></span></code></pre></div><p><em>Partition The Set of Candidate Based on a attribute/feature</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">TypeVar</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>  <span class="c1"># generic type for inputs</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">partition_by</span><span class="p">(</span><span class="n">inputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">attribute</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">T</span><span class="p">]]:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Partition the inputs into lists based on the specified attribute.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">partitions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">T</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">key</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span>  <span class="c1"># value of the specified attribute</span>
</span></span><span class="line"><span class="cl">        <span class="n">partitions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>    <span class="c1"># add input to the correct partition</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">partitions</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">partition_entropy_by</span><span class="p">(</span><span class="n">inputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                         <span class="n">attribute</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                         <span class="n">label_attribute</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Compute the entropy corresponding to the given partition&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># partitions consist of our inputs</span>
</span></span><span class="line"><span class="cl">    <span class="n">partitions</span> <span class="o">=</span> <span class="n">partition_by</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># but partition_entropy needs just the class labels</span>
</span></span><span class="line"><span class="cl">    <span class="n">labels</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">getattr</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">label_attribute</span><span class="p">)</span> <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">partition</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">              <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">partitions</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">partition_entropy</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span></span></code></pre></div><p><em>Test Code</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">,</span><span class="s1">&#39;lang&#39;</span><span class="p">,</span><span class="s1">&#39;tweets&#39;</span><span class="p">,</span><span class="s1">&#39;phd&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">partition_entropy_by</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;did_well&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="mf">0.69</span> <span class="o">&lt;</span> <span class="n">partition_entropy_by</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="s1">&#39;did_well&#39;</span><span class="p">)</span>  <span class="o">&lt;</span> <span class="mf">0.70</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="mf">0.86</span> <span class="o">&lt;</span> <span class="n">partition_entropy_by</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="s1">&#39;lang&#39;</span><span class="p">,</span> <span class="s1">&#39;did_well&#39;</span><span class="p">)</span>   <span class="o">&lt;</span> <span class="mf">0.87</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="mf">0.78</span> <span class="o">&lt;</span> <span class="n">partition_entropy_by</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="s1">&#39;tweets&#39;</span><span class="p">,</span> <span class="s1">&#39;did_well&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.79</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="mf">0.89</span> <span class="o">&lt;</span> <span class="n">partition_entropy_by</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="s1">&#39;phd&#39;</span><span class="p">,</span> <span class="s1">&#39;did_well&#39;</span><span class="p">)</span>    <span class="o">&lt;</span> <span class="mf">0.90</span>
</span></span></code></pre></div><h3 id="175-putting-it-all-together">17.5 Putting It All Together<a aria-label="Link to this section" class="paige-header-link" href="#175-putting-it-all-together"></a></h3>
<p><em>Code: Inference Logic</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Any</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Leaf</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Split</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">attribute</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">subtrees</span><span class="p">:</span> <span class="nb">dict</span>
</span></span><span class="line"><span class="cl">    <span class="n">default_value</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">DecisionTree</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">Leaf</span><span class="p">,</span> <span class="n">Split</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># This is the result of our training the tree</span>
</span></span><span class="line"><span class="cl"><span class="n">hiring_tree</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span><span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="p">{</span>   <span class="c1"># first, consider &#34;level&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Junior&#39;</span><span class="p">:</span> <span class="n">Split</span><span class="p">(</span><span class="s1">&#39;phd&#39;</span><span class="p">,</span> <span class="p">{</span>     <span class="c1"># if level is &#34;Junior&#34;, next look at &#34;phd&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="kc">False</span><span class="p">:</span> <span class="n">Leaf</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span>       <span class="c1">#   if &#34;phd&#34; is False, predict True</span>
</span></span><span class="line"><span class="cl">        <span class="kc">True</span><span class="p">:</span> <span class="n">Leaf</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>        <span class="c1">#   if &#34;phd&#34; is True, predict False</span>
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Mid&#39;</span><span class="p">:</span> <span class="n">Leaf</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span>           <span class="c1"># if level is &#34;Mid&#34;, just predict True</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Senior&#39;</span><span class="p">:</span> <span class="n">Split</span><span class="p">(</span><span class="s1">&#39;tweets&#39;</span><span class="p">,</span> <span class="p">{</span>  <span class="c1"># if level is &#34;Senior&#34;, look at &#34;tweets&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="kc">False</span><span class="p">:</span> <span class="n">Leaf</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>      <span class="c1">#   if &#34;tweets&#34; is False, predict False</span>
</span></span><span class="line"><span class="cl">        <span class="kc">True</span><span class="p">:</span> <span class="n">Leaf</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>         <span class="c1">#   if &#34;tweets&#34; is True, predict True</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">classify</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">DecisionTree</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;classify the input using the given decision tree&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># If this is a leaf node, return its value</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">Leaf</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="n">value</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Otherwise this tree consists of an attribute to split on</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># and a dictionary whose keys are values of that attribute</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># and whose values are subtrees to consider next</span>
</span></span><span class="line"><span class="cl">    <span class="n">subtree_key</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">attribute</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">subtree_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">subtrees</span><span class="p">:</span>   <span class="c1"># If no subtree for key,</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="n">default_value</span>          <span class="c1"># return the default value.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">subtree</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">subtrees</span><span class="p">[</span><span class="n">subtree_key</span><span class="p">]</span>   <span class="c1"># Choose the appropriate subtree</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">classify</span><span class="p">(</span><span class="n">subtree</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span>        <span class="c1"># and use it to classify the input.</span>
</span></span></code></pre></div><p><em>Code: Build The Tree</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">build_tree_id3</span><span class="p">(</span><span class="n">inputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                   <span class="n">split_attributes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                   <span class="n">target_attribute</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DecisionTree</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Count target labels</span>
</span></span><span class="line"><span class="cl">    <span class="n">label_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">target_attribute</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                           <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">most_common_label</span> <span class="o">=</span> <span class="n">label_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># If there&#39;s a unique label, predict it</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label_counts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Leaf</span><span class="p">(</span><span class="n">most_common_label</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># If no split attributes left, return the majority label</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">split_attributes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Leaf</span><span class="p">(</span><span class="n">most_common_label</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Otherwise split by the best attribute</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">split_entropy</span><span class="p">(</span><span class="n">attribute</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Helper function for finding the best attribute&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">partition_entropy_by</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">target_attribute</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">best_attribute</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">split_attributes</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">split_entropy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">partitions</span> <span class="o">=</span> <span class="n">partition_by</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">best_attribute</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">new_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">split_attributes</span> <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">best_attribute</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursively build the subtrees</span>
</span></span><span class="line"><span class="cl">    <span class="n">subtrees</span> <span class="o">=</span> <span class="p">{</span><span class="n">attribute_value</span> <span class="p">:</span> <span class="n">build_tree_id3</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                                 <span class="n">new_attributes</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                                 <span class="n">target_attribute</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">attribute_value</span><span class="p">,</span> <span class="n">subset</span> <span class="ow">in</span> <span class="n">partitions</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Split</span><span class="p">(</span><span class="n">best_attribute</span><span class="p">,</span> <span class="n">subtrees</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">most_common_label</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="176-random-forests">17.6 Random Forests<a aria-label="Link to this section" class="paige-header-link" href="#176-random-forests"></a></h3>
<ul>
<li>Reduce decision tree&rsquo;s tendency to overfit by bootsgtapping, where
<ul>
<li>bootstrap aggregation (aka bagging): each tree is selected with different sampled subset of data</li>
<li>randomly select subset of attributes</li>
</ul>
</li>
</ul>
<h1 id="18-neural-network">18 Neural Network<a aria-label="Link to this section" class="paige-header-link" href="#18-neural-network"></a></h1>
<h3 id="181-perceptrons">18.1 Perceptrons<a aria-label="Link to this section" class="paige-header-link" href="#181-perceptrons"></a></h3>
<h3 id="182-feed-forward-neural-network">18.2 Feed Forward Neural Network<a aria-label="Link to this section" class="paige-header-link" href="#182-feed-forward-neural-network"></a></h3>
<h3 id="183-back-propagation">18.3 Back propagation<a aria-label="Link to this section" class="paige-header-link" href="#183-back-propagation"></a></h3>
<h3 id="184-example-fiz-fuzz">18.4 Example: Fiz Fuzz<a aria-label="Link to this section" class="paige-header-link" href="#184-example-fiz-fuzz"></a></h3>
<h1 id="19-deep-learning">19 Deep Learning<a aria-label="Link to this section" class="paige-header-link" href="#19-deep-learning"></a></h1>
<h3 id="191-the-tensor">19.1 The Tensor<a aria-label="Link to this section" class="paige-header-link" href="#191-the-tensor"></a></h3>
<h3 id="192-the-layer-abstraction">19.2 The Layer Abstraction<a aria-label="Link to this section" class="paige-header-link" href="#192-the-layer-abstraction"></a></h3>
<h3 id="193-linear-layer">19.3 Linear Layer<a aria-label="Link to this section" class="paige-header-link" href="#193-linear-layer"></a></h3>
<h3 id="194-nn-as-a-sequence-of-layers">19.4 NN As a Sequence of Layers<a aria-label="Link to this section" class="paige-header-link" href="#194-nn-as-a-sequence-of-layers"></a></h3>
<h3 id="195-loss-and-optimization">19.5 Loss and Optimization<a aria-label="Link to this section" class="paige-header-link" href="#195-loss-and-optimization"></a></h3>
<h3 id="196-example-xor-revisited">19.6 Example: XOR Revisited<a aria-label="Link to this section" class="paige-header-link" href="#196-example-xor-revisited"></a></h3>
<h3 id="197-other-activation-functions">19.7 Other Activation Functions<a aria-label="Link to this section" class="paige-header-link" href="#197-other-activation-functions"></a></h3>
<h3 id="198-fizzbuzz-revisited">19.8 FizzBuzz Revisited<a aria-label="Link to this section" class="paige-header-link" href="#198-fizzbuzz-revisited"></a></h3>
<h3 id="199-softmaxes-and-cross-entropy">19.9 Softmaxes and Cross Entropy<a aria-label="Link to this section" class="paige-header-link" href="#199-softmaxes-and-cross-entropy"></a></h3>
<h3 id="1910-dropout">19.10 Dropout<a aria-label="Link to this section" class="paige-header-link" href="#1910-dropout"></a></h3>
<h3 id="1911-example-mnist">19.11 Example: MNIST<a aria-label="Link to this section" class="paige-header-link" href="#1911-example-mnist"></a></h3>
<h3 id="1912-saving-and-loading-models">19.12 Saving and Loading Models<a aria-label="Link to this section" class="paige-header-link" href="#1912-saving-and-loading-models"></a></h3>
<h1 id="20-clustering">20 Clustering<a aria-label="Link to this section" class="paige-header-link" href="#20-clustering"></a></h1>
<h3 id="201-the-idea-k-means">20.1 The Idea (K-Means)<a aria-label="Link to this section" class="paige-header-link" href="#201-the-idea-k-means"></a></h3>
<ul>
<li>Partition the inputs into sets $S_1, .., S_k$  in a way to minimize the squared distance of each point from the $cluster_k$ mean.
<ul>
<li>This is a top down approach, starting from the mean of k clusters. Compared to the bottom up hierarchical clustering in section 20.6</li>
</ul>
</li>
</ul>
<h3 id="202-the-model">20.2 The Model<a aria-label="Link to this section" class="paige-header-link" href="#202-the-model"></a></h3>
<ul>
<li>Algorithm
<ol>
<li>Start with a set of k-means, which are points in d-dimensional space.</li>
<li>Assign each point to the mean to which it is closest.</li>
<li>If no point’s assignment has changed, stop and keep the clusters.</li>
<li>If some point’s assignment has changed, recompute the means and return to step 2.</li>
</ol>
</li>
</ul>
<p><em>Code: How many coordinates 2 vectors differ in</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">scratch.linear_algebra</span> <span class="kn">import</span> <span class="n">Vector</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">num_differences</span><span class="p">(</span><span class="n">v1</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">v2</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">x1</span> <span class="k">for</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x1</span> <span class="o">!=</span> <span class="n">x2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">assert</span> <span class="n">num_differences</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">	<span class="k">assert</span> <span class="n">num_differences</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span></span></code></pre></div><p><em>Code: Given some vectors and their assignments to clusters, compute the mean of the clusters</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">scratch.linear_algebra</span> <span class="kn">import</span> <span class="n">vector_mean</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">cluster_means</span><span class="p">(</span><span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	                  <span class="n">inputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Vector</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	                  <span class="n">assignments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Vector</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">	    <span class="c1"># clusters[i] contains the inputs whose assignment is i</span>
</span></span><span class="line"><span class="cl">	    <span class="n">clusters</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">	    <span class="k">for</span> <span class="nb">input</span><span class="p">,</span> <span class="n">assignment</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">assignments</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	        <span class="n">clusters</span><span class="p">[</span><span class="n">assignment</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	    <span class="c1"># if a cluster is empty, just use a random point</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="p">[</span><span class="n">vector_mean</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span> <span class="k">if</span> <span class="n">cluster</span> <span class="k">else</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	            <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">]</span>
</span></span></code></pre></div><p><em>Code: End to End</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">itertools</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">tqdm</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scratch.linear_algebra</span> <span class="kn">import</span> <span class="n">squared_distance</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">KMeans</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>                      <span class="c1"># number of clusters</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">means</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;return the index of the cluster closest to the input&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                   <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">squared_distance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Vector</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Start with random assignments</span>
</span></span><span class="line"><span class="cl">        <span class="n">assignments</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">())</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Compute means and find new assignments</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">means</span> <span class="o">=</span> <span class="n">cluster_means</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">assignments</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">new_assignments</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span> <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># Check how many assignments changed and if we&#39;re done</span>
</span></span><span class="line"><span class="cl">                <span class="n">num_changed</span> <span class="o">=</span> <span class="n">num_differences</span><span class="p">(</span><span class="n">assignments</span><span class="p">,</span> <span class="n">new_assignments</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">num_changed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># Otherwise keep the new assignments, and compute new means</span>
</span></span><span class="line"><span class="cl">                <span class="n">assignments</span> <span class="o">=</span> <span class="n">new_assignments</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">means</span> <span class="o">=</span> <span class="n">cluster_means</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">assignments</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">t</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;changed: </span><span class="si">{</span><span class="n">num_changed</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="203-example-meetups">20.3 Example: Meetups<a aria-label="Link to this section" class="paige-header-link" href="#203-example-meetups"></a></h3>
<h3 id="204-choosing-k">20.4 Choosing K<a aria-label="Link to this section" class="paige-header-link" href="#204-choosing-k"></a></h3>
<ul>
<li>various ways to choose k
<ul>
<li>Plot squared distance error as a function of k; choose where the graph bends</li>
</ul>
</li>
</ul>
<p><em>Code</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">squared_clustering_errors</span><span class="p">(</span><span class="n">inputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Vector</span><span class="p">],</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="s2">&#34;&#34;&#34;finds the total squared error from k-means clustering the inputs&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="n">clusterer</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">clusterer</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">means</span> <span class="o">=</span> <span class="n">clusterer</span><span class="o">.</span><span class="n">means</span>
</span></span><span class="line"><span class="cl">	    <span class="n">assignments</span> <span class="o">=</span> <span class="p">[</span><span class="n">clusterer</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span> <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">squared_distance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">means</span><span class="p">[</span><span class="n">cluster</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	               <span class="k">for</span> <span class="nb">input</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">assignments</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># now plot from 1 up to len(inputs) clusters</span>
</span></span><span class="line"><span class="cl">	<span class="n">ks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">errors</span> <span class="o">=</span> <span class="p">[</span><span class="n">squared_clustering_errors</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ks</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ks</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&#34;k&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;total squared error&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Total Error vs. # of Clusters&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><h3 id="205-example-clustering-colors">20.5 Example: Clustering Colors<a aria-label="Link to this section" class="paige-header-link" href="#205-example-clustering-colors"></a></h3>
<h3 id="206-bottom-up-hierarchical-clustering">20.6 Bottom Up Hierarchical Clustering<a aria-label="Link to this section" class="paige-header-link" href="#206-bottom-up-hierarchical-clustering"></a></h3>
<ul>
<li>Algorithm
<ol>
<li>Make each input its own cluster of one.</li>
<li>As long as there are multiple clusters remaining, find the two closest clusters and merge them.</li>
</ol>
</li>
</ul>
<p><em>Code: Modeling</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">Union</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">class</span> <span class="nc">Leaf</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	    <span class="n">value</span><span class="p">:</span> <span class="n">Vector</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">class</span> <span class="nc">Merged</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	    <span class="n">children</span><span class="p">:</span> <span class="nb">tuple</span>
</span></span><span class="line"><span class="cl">	    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="c1"># the sequence of the merge</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">leaf1</span> <span class="o">=</span> <span class="n">Leaf</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span>  <span class="mi">20</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="n">leaf2</span> <span class="o">=</span> <span class="n">Leaf</span><span class="p">([</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="n">merged</span> <span class="o">=</span> <span class="n">Merged</span><span class="p">((</span><span class="n">leaf1</span><span class="p">,</span> <span class="n">leaf2</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">Cluster</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">Leaf</span><span class="p">,</span> <span class="n">Merged</span><span class="p">]</span>
</span></span></code></pre></div><p><em>Code: Helper Function</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="c1"># Return all values contained in cluster recursively</span>
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="n">cluster</span><span class="p">:</span> <span class="n">Cluster</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Vector</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">Leaf</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	        <span class="k">return</span> <span class="p">[</span><span class="n">cluster</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	        <span class="k">return</span> <span class="p">[</span><span class="n">value</span>
</span></span><span class="line"><span class="cl">	                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">cluster</span><span class="o">.</span><span class="n">children</span>
</span></span><span class="line"><span class="cl">	                <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">get_values</span><span class="p">(</span><span class="n">child</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">	<span class="k">assert</span> <span class="n">get_values</span><span class="p">(</span><span class="n">merged</span><span class="p">)</span> <span class="o">==</span> <span class="p">[[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># Metric for distance</span>
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">scratch.linear_algebra</span> <span class="kn">import</span> <span class="n">distance</span>
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">cluster_distance</span><span class="p">(</span><span class="n">cluster1</span><span class="p">:</span> <span class="n">Cluster</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	                     <span class="n">cluster2</span><span class="p">:</span> <span class="n">Cluster</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	                     <span class="n">distance_agg</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="nb">min</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">	    compute all the pairwise distances between cluster1 and cluster2
</span></span></span><span class="line"><span class="cl"><span class="s2">	    and apply the aggregation function _distance_agg_ to the resulting list
</span></span></span><span class="line"><span class="cl"><span class="s2">	    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">distance_agg</span><span class="p">([</span><span class="n">distance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	                         <span class="k">for</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">get_values</span><span class="p">(</span><span class="n">cluster1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	                         <span class="k">for</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">get_values</span><span class="p">(</span><span class="n">cluster2</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># Pts will be merged from bottom up; keep track of the order</span>
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">get_merge_order</span><span class="p">(</span><span class="n">cluster</span><span class="p">:</span> <span class="n">Cluster</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">Leaf</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>  <span class="c1"># was never merged</span>
</span></span><span class="line"><span class="cl">	    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	        <span class="k">return</span> <span class="n">cluster</span><span class="o">.</span><span class="n">order</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">get_children</span><span class="p">(</span><span class="n">cluster</span><span class="p">:</span> <span class="n">Cluster</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">Leaf</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&#34;Leaf has no children&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	        <span class="k">return</span> <span class="n">cluster</span><span class="o">.</span><span class="n">children</span>
</span></span></code></pre></div><p><em>Code: Bottom Up</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">bottom_up_cluster</span><span class="p">(</span><span class="n">inputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Vector</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	                      <span class="n">distance_agg</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="nb">min</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Cluster</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="c1"># Start with all leaves</span>
</span></span><span class="line"><span class="cl">	    <span class="n">clusters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Cluster</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Leaf</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span> <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	    <span class="k">def</span> <span class="nf">pair_distance</span><span class="p">(</span><span class="n">pair</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Cluster</span><span class="p">,</span> <span class="n">Cluster</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	        <span class="k">return</span> <span class="n">cluster_distance</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">distance_agg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	    <span class="c1"># as long as we have more than one cluster left...</span>
</span></span><span class="line"><span class="cl">	    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	        <span class="c1"># find the two closest clusters</span>
</span></span><span class="line"><span class="cl">	        <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(((</span><span class="n">cluster1</span><span class="p">,</span> <span class="n">cluster2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	                      <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cluster1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	                      <span class="k">for</span> <span class="n">cluster2</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">[:</span><span class="n">i</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">	                      <span class="n">key</span><span class="o">=</span><span class="n">pair_distance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	        <span class="c1"># remove them from the list of clusters</span>
</span></span><span class="line"><span class="cl">	        <span class="n">clusters</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">clusters</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">c1</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">c2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	        <span class="c1"># merge them, using merge_order = # of clusters left</span>
</span></span><span class="line"><span class="cl">	        <span class="n">merged_cluster</span> <span class="o">=</span> <span class="n">Merged</span><span class="p">((</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	        <span class="c1"># and add their merge</span>
</span></span><span class="line"><span class="cl">	        <span class="n">clusters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">merged_cluster</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	    <span class="c1"># when there&#39;s only one cluster left, return it</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span></code></pre></div><h1 id="21-natural-language-processing">21 Natural Language Processing<a aria-label="Link to this section" class="paige-header-link" href="#21-natural-language-processing"></a></h1>
<h3 id="211-word-clouds">21.1 Word Clouds<a aria-label="Link to this section" class="paige-header-link" href="#211-word-clouds"></a></h3>
<p><em>Given (Word, jobListing cnt, resume cnt)</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="n">data</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="s2">&#34;big data&#34;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;Hadoop&#34;</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;Python&#34;</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s2">&#34;R&#34;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;machine learning&#34;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;statistics&#34;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s2">&#34;data science&#34;</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;analytics&#34;</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s2">&#34;team player&#34;</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">85</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;dynamic&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;synergies&#34;</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s2">&#34;actionable insights&#34;</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;think out of the box&#34;</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s2">&#34;self-starter&#34;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;customer focus&#34;</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s2">&#34;thought leadership&#34;</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">35</span><span class="p">)]</span>
</span></span></code></pre></div><p><em>Code to Plot Word Cloud</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">text_size</span><span class="p">(</span><span class="n">total</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="s2">&#34;&#34;&#34;equals 8 if total is 0, 28 if total is 200&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">total</span> <span class="o">/</span> <span class="mi">200</span> <span class="o">*</span> <span class="mi">20</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">job_popularity</span><span class="p">,</span> <span class="n">resume_popularity</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">job_popularity</span><span class="p">,</span> <span class="n">resume_popularity</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	             <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	             <span class="n">size</span><span class="o">=</span><span class="n">text_size</span><span class="p">(</span><span class="n">job_popularity</span> <span class="o">+</span> <span class="n">resume_popularity</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&#34;Popularity on Job Postings&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;Popularity on Resumes&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><h3 id="212-n-gram-language-models">21.2 n-Gram Language Models<a aria-label="Link to this section" class="paige-header-link" href="#212-n-gram-language-models"></a></h3>
<h3 id="213-grammers">21.3 Grammers<a aria-label="Link to this section" class="paige-header-link" href="#213-grammers"></a></h3>
<h3 id="214-gibbs-sampling">21.4 Gibbs Sampling<a aria-label="Link to this section" class="paige-header-link" href="#214-gibbs-sampling"></a></h3>
<h3 id="215-topics-modeling">21.5 ==Topics Modeling==<a aria-label="Link to this section" class="paige-header-link" href="#215-topics-modeling"></a></h3>
<h3 id="216-word-vectors">21.6 ==Word Vectors==<a aria-label="Link to this section" class="paige-header-link" href="#216-word-vectors"></a></h3>
<p><em>Background</em></p>
<ul>
<li>Word vectors have the nice property that similar words appear near each other</li>
</ul>
<p><em>Code: Similarity Measurement Via Cosine Similarity</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">scratch.linear_algebra</span> <span class="kn">import</span> <span class="n">dot</span><span class="p">,</span> <span class="n">Vector</span>
</span></span><span class="line"><span class="cl">	<span class="kn">import</span> <span class="nn">math</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">cosine_similarity</span><span class="p">(</span><span class="n">v1</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">v2</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dot</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span>
</span></span></code></pre></div><p><em>Code: Create Training Sentences</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;red&#34;</span><span class="p">,</span> <span class="s2">&#34;green&#34;</span><span class="p">,</span> <span class="s2">&#34;blue&#34;</span><span class="p">,</span> <span class="s2">&#34;yellow&#34;</span><span class="p">,</span> <span class="s2">&#34;black&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="n">nouns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;bed&#34;</span><span class="p">,</span> <span class="s2">&#34;car&#34;</span><span class="p">,</span> <span class="s2">&#34;boat&#34;</span><span class="p">,</span> <span class="s2">&#34;cat&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="n">verbs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;is&#34;</span><span class="p">,</span> <span class="s2">&#34;was&#34;</span><span class="p">,</span> <span class="s2">&#34;seems&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="n">adverbs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;very&#34;</span><span class="p">,</span> <span class="s2">&#34;quite&#34;</span><span class="p">,</span> <span class="s2">&#34;extremely&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="n">adjectives</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;slow&#34;</span><span class="p">,</span> <span class="s2">&#34;fast&#34;</span><span class="p">,</span> <span class="s2">&#34;soft&#34;</span><span class="p">,</span> <span class="s2">&#34;hard&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">make_sentence</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="s2">&#34; &#34;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">	        <span class="s2">&#34;The&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	        <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">colors</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">	        <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">nouns</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">	        <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">verbs</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">	        <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">adverbs</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">	        <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">adjectives</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">	        <span class="s2">&#34;.&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="p">])</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">NUM_SENTENCES</span> <span class="o">=</span> <span class="mi">50</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_sentence</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_SENTENCES</span><span class="p">)]</span>
</span></span></code></pre></div><p><em>Code: Vocabulary Converts Word to ID</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">scratch.deep_learning</span> <span class="kn">import</span> <span class="n">Tensor</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">class</span> <span class="nc">Vocabulary</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	        <span class="bp">self</span><span class="o">.</span><span class="n">w2i</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># mapping word -&gt; word_id</span>
</span></span><span class="line"><span class="cl">	        <span class="bp">self</span><span class="o">.</span><span class="n">i2w</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># mapping word_id -&gt; word</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">(</span><span class="n">words</span> <span class="ow">or</span> <span class="p">[]):</span>     <span class="c1"># If words were provided,</span>
</span></span><span class="line"><span class="cl">	            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>             <span class="c1"># add them.</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	    <span class="nd">@property</span>
</span></span><span class="line"><span class="cl">	    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	        <span class="s2">&#34;&#34;&#34;how many words are in the vocabulary&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w2i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	        <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">w2i</span><span class="p">:</span>        <span class="c1"># If the word is new to us:</span>
</span></span><span class="line"><span class="cl">	            <span class="n">word_id</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w2i</span><span class="p">)</span>     <span class="c1"># Find the next id.</span>
</span></span><span class="line"><span class="cl">	            <span class="bp">self</span><span class="o">.</span><span class="n">w2i</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">word_id</span>    <span class="c1"># Add to the word -&gt; word_id map.</span>
</span></span><span class="line"><span class="cl">	            <span class="bp">self</span><span class="o">.</span><span class="n">i2w</span><span class="p">[</span><span class="n">word_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">word</span>    <span class="c1"># Add to the word_id -&gt; word map.</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	    <span class="k">def</span> <span class="nf">get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	        <span class="s2">&#34;&#34;&#34;return the id of the word (or None)&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">w2i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	    <span class="k">def</span> <span class="nf">get_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	        <span class="s2">&#34;&#34;&#34;return the word with the given id (or None)&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">i2w</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	    <span class="k">def</span> <span class="nf">one_hot_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	        <span class="n">word_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	        <span class="k">assert</span> <span class="n">word_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&#34;unknown word </span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	        <span class="k">return</span> <span class="p">[</span><span class="mf">1.0</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">word_id</span> <span class="k">else</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>
</span></span></code></pre></div><p><em>Code: Save and Load Vobcabulary</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">save_vocab</span><span class="p">(</span><span class="n">vocab</span><span class="p">:</span> <span class="n">Vocabulary</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">vocab</span><span class="o">.</span><span class="n">w2i</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>       <span class="c1"># Only need to save w2i</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">load_vocab</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vocabulary</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="n">vocab</span> <span class="o">=</span> <span class="n">Vocabulary</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	        <span class="c1"># Load w2i and generate i2w from it</span>
</span></span><span class="line"><span class="cl">	        <span class="n">vocab</span><span class="o">.</span><span class="n">w2i</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	        <span class="n">vocab</span><span class="o">.</span><span class="n">i2w</span> <span class="o">=</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="n">word</span> <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">vocab</span><span class="o">.</span><span class="n">w2i</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">vocab</span>
</span></span></code></pre></div><p><em>Code: Train Embedding Via SkipGram</em></p>
<ul>
<li>Concepts
<ul>
<li>Skip-gram takes as input a word and generates probabilities for what words are likely to be seen near it. We will feed it training pairs (word, nearby_word) and try to minimize the SoftmaxCrossEntropy loss</li>
<li>Embedding layer takes a word-id input and returns a vector.  We will implement it as a lookup table {word_id -&gt; vector_i }</li>
<li>word_id &ndash;&gt; linear layer &ndash;&gt; softmax
<ul>
<li>dimension of word_id and linear layer = size of vocabulary</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>_Code: Embedding _</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scratch.deep_learning</span> <span class="kn">import</span> <span class="n">Layer</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">random_tensor</span><span class="p">,</span> <span class="n">zeros_like</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Embedding</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_embeddings</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">num_embeddings</span> <span class="o">=</span> <span class="n">num_embeddings</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_dim</span> <span class="o">=</span> <span class="n">embedding_dim</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># One vector of size embedding_dim for each desired embedding</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">random_tensor</span><span class="p">(</span><span class="n">num_embeddings</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">grad</span> <span class="o">=</span> <span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Save last input id</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">last_input_id</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Just select the embedding vector corresponding to the input id&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">input_id</span> <span class="o">=</span> <span class="n">input_id</span>    <span class="c1"># remember for use in backpropagation</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">[</span><span class="n">input_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gradient</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Zero out the gradient corresponding to the last input.</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># This is way cheaper than creating a new all-zero tensor each time.</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_input_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">zero_row</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_dim</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">grad</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">last_input_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">zero_row</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">last_input_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_id</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">grad</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">grads</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grad</span><span class="p">]</span>
</span></span></code></pre></div><p><em>Code: Text Embedding</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TextEmbedding</span><span class="p">(</span><span class="n">Embedding</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocab</span><span class="p">:</span> <span class="n">Vocabulary</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Call the superclass constructor</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">vocab</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># And hang onto the vocab</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span> <span class="o">=</span> <span class="n">vocab</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">word_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">get_id</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">word_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">[</span><span class="n">word_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">closest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Returns the n closest words based on cosine similarity&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">vector</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">word</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Compute pairs (similarity, other_word), and sort most similar first</span>
</span></span><span class="line"><span class="cl">        <span class="n">scores</span> <span class="o">=</span> <span class="p">[(</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">other_word</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="k">for</span> <span class="n">other_word</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">w2i</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">        <span class="n">scores</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">scores</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>
</span></span></code></pre></div><p><em>Code: Create Training Data</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># This is not a great regex, but it works on our data.</span>
</span></span><span class="line"><span class="cl">	<span class="n">tokenized_sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&#34;[a-z]+|[.]&#34;</span><span class="p">,</span> <span class="n">sentence</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	                       <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># Create a vocabulary (that is, a mapping word -&gt; word_id) based on our text.</span>
</span></span><span class="line"><span class="cl">	<span class="n">vocab</span> <span class="o">=</span> <span class="n">Vocabulary</span><span class="p">(</span><span class="n">word</span>
</span></span><span class="line"><span class="cl">	                   <span class="k">for</span> <span class="n">sentence_words</span> <span class="ow">in</span> <span class="n">tokenized_sentences</span>
</span></span><span class="line"><span class="cl">	                   <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sentence_words</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">scratch.deep_learning</span> <span class="kn">import</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">one_hot_encode</span>
</span></span><span class="line"><span class="cl">	<span class="n">inputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">	<span class="n">targets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">tokenized_sentences</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sentence</span><span class="p">):</span>          <span class="c1"># For each word</span>
</span></span><span class="line"><span class="cl">	        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]:</span>   <span class="c1"># take the nearby locations</span>
</span></span><span class="line"><span class="cl">	            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentence</span><span class="p">):</span>           <span class="c1"># that aren&#39;t out of bounds</span>
</span></span><span class="line"><span class="cl">	                <span class="n">nearby_word</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>        <span class="c1"># and get those words.</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	                <span class="c1"># Add an input that&#39;s the original word_id</span>
</span></span><span class="line"><span class="cl">	                <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vocab</span><span class="o">.</span><span class="n">get_id</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	                <span class="c1"># Add a target that&#39;s the one-hot-encoded nearby word</span>
</span></span><span class="line"><span class="cl">	                <span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vocab</span><span class="o">.</span><span class="n">one_hot_encode</span><span class="p">(</span><span class="n">nearby_word</span><span class="p">))</span>
</span></span></code></pre></div><p><em>Code: Create Model</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">scratch.deep_learning</span> <span class="kn">import</span> <span class="n">Sequential</span><span class="p">,</span> <span class="n">Linear</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">EMBEDDING_DIM</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># seems like a good size</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># Define the embedding layer separately, so we can reference it.</span>
</span></span><span class="line"><span class="cl">	<span class="n">embedding</span> <span class="o">=</span> <span class="n">TextEmbedding</span><span class="p">(</span><span class="n">vocab</span><span class="o">=</span><span class="n">vocab</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="n">EMBEDDING_DIM</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">	    <span class="c1"># Given a word (as a vector of word_ids), look up its embedding.</span>
</span></span><span class="line"><span class="cl">	    <span class="n">embedding</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	    <span class="c1"># And use a linear layer to compute scores for &#34;nearby words.&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="n">Linear</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="n">EMBEDDING_DIM</span><span class="p">,</span> <span class="n">output_dim</span><span class="o">=</span><span class="n">vocab</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">])</span>
</span></span></code></pre></div><p><em>Code: Training Loop</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">scratch.deep_learning</span> <span class="kn">import</span> <span class="n">SoftmaxCrossEntropy</span><span class="p">,</span> <span class="n">Momentum</span><span class="p">,</span> <span class="n">GradientDescent</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">loss</span> <span class="o">=</span> <span class="n">SoftmaxCrossEntropy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="n">optimizer</span> <span class="o">=</span> <span class="n">GradientDescent</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	    <span class="n">epoch_loss</span> <span class="o">=</span> <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl">	    <span class="k">for</span> <span class="nb">input</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	        <span class="n">predicted</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	        <span class="n">epoch_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">loss</span><span class="p">(</span><span class="n">predicted</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	        <span class="n">gradient</span> <span class="o">=</span> <span class="n">loss</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">predicted</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	        <span class="n">model</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">print</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">epoch_loss</span><span class="p">)</span>            <span class="c1"># Print the loss</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">print</span><span class="p">(</span><span class="n">embedding</span><span class="o">.</span><span class="n">closest</span><span class="p">(</span><span class="s2">&#34;black&#34;</span><span class="p">))</span>   <span class="c1"># and also a few nearest words</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">print</span><span class="p">(</span><span class="n">embedding</span><span class="o">.</span><span class="n">closest</span><span class="p">(</span><span class="s2">&#34;slow&#34;</span><span class="p">))</span>    <span class="c1"># so we can see what&#39;s being</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">print</span><span class="p">(</span><span class="n">embedding</span><span class="o">.</span><span class="n">closest</span><span class="p">(</span><span class="s2">&#34;car&#34;</span><span class="p">))</span>     <span class="c1"># learned.</span>
</span></span></code></pre></div><p><em>Code: Analysis</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="n">pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">embedding</span><span class="p">[</span><span class="n">w1</span><span class="p">],</span> <span class="n">embedding</span><span class="p">[</span><span class="n">w2</span><span class="p">]),</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	         <span class="k">for</span> <span class="n">w1</span> <span class="ow">in</span> <span class="n">vocab</span><span class="o">.</span><span class="n">w2i</span>
</span></span><span class="line"><span class="cl">	         <span class="k">for</span> <span class="n">w2</span> <span class="ow">in</span> <span class="n">vocab</span><span class="o">.</span><span class="n">w2i</span>
</span></span><span class="line"><span class="cl">	         <span class="k">if</span> <span class="n">w1</span> <span class="o">&lt;</span> <span class="n">w2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="n">pairs</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># PLOT</span>
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">scratch.working_with_data</span> <span class="kn">import</span> <span class="n">pca</span><span class="p">,</span> <span class="n">transform</span>
</span></span><span class="line"><span class="cl">	<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># Extract the first two principal components and transform the word vectors</span>
</span></span><span class="line"><span class="cl">	<span class="n">components</span> <span class="o">=</span> <span class="n">pca</span><span class="p">(</span><span class="n">embedding</span><span class="o">.</span><span class="n">embeddings</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">transformed</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">embedding</span><span class="o">.</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">components</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># Scatter the points (and make them white so they&#39;re &#34;invisible&#34;)</span>
</span></span><span class="line"><span class="cl">	<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">transformed</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># Add annotations for each word at its transformed location</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">vocab</span><span class="o">.</span><span class="n">w2i</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">	    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">transformed</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># And hide the axes</span>
</span></span><span class="line"><span class="cl">	<span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">ax</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><h3 id="217-rnn">21.7 RNN<a aria-label="Link to this section" class="paige-header-link" href="#217-rnn"></a></h3>
<h3 id="218-example-using-a-character-level-rnn">21.8 Example: Using a Character Level RNN<a aria-label="Link to this section" class="paige-header-link" href="#218-example-using-a-character-level-rnn"></a></h3>
<h1 id="22-network-analysis-graph">22 Network Analysis (Graph)<a aria-label="Link to this section" class="paige-header-link" href="#22-network-analysis-graph"></a></h1>
<h3 id="221-betweenness-centrality">22.1 Betweenness Centrality<a aria-label="Link to this section" class="paige-header-link" href="#221-betweenness-centrality"></a></h3>
<h3 id="222-eigenvector-centrality">22.2 Eigenvector Centrality<a aria-label="Link to this section" class="paige-header-link" href="#222-eigenvector-centrality"></a></h3>
<h3 id="223-directed-graphs-and-page-ranks">22.3 Directed Graphs and Page Ranks<a aria-label="Link to this section" class="paige-header-link" href="#223-directed-graphs-and-page-ranks"></a></h3>
<h1 id="23-recommender-system">23 Recommender System<a aria-label="Link to this section" class="paige-header-link" href="#23-recommender-system"></a></h1>
<h3 id="231-manual-curations">23.1 Manual Curations<a aria-label="Link to this section" class="paige-header-link" href="#231-manual-curations"></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="n">users_interests</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">	    <span class="p">[</span><span class="s2">&#34;Hadoop&#34;</span><span class="p">,</span> <span class="s2">&#34;Big Data&#34;</span><span class="p">,</span> <span class="s2">&#34;HBase&#34;</span><span class="p">,</span> <span class="s2">&#34;Java&#34;</span><span class="p">,</span> <span class="s2">&#34;Spark&#34;</span><span class="p">,</span> <span class="s2">&#34;Storm&#34;</span><span class="p">,</span> <span class="s2">&#34;Cassandra&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	    <span class="p">[</span><span class="s2">&#34;NoSQL&#34;</span><span class="p">,</span> <span class="s2">&#34;MongoDB&#34;</span><span class="p">,</span> <span class="s2">&#34;Cassandra&#34;</span><span class="p">,</span> <span class="s2">&#34;HBase&#34;</span><span class="p">,</span> <span class="s2">&#34;Postgres&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	    <span class="p">[</span><span class="s2">&#34;Python&#34;</span><span class="p">,</span> <span class="s2">&#34;scikit-learn&#34;</span><span class="p">,</span> <span class="s2">&#34;scipy&#34;</span><span class="p">,</span> <span class="s2">&#34;numpy&#34;</span><span class="p">,</span> <span class="s2">&#34;statsmodels&#34;</span><span class="p">,</span> <span class="s2">&#34;pandas&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	    <span class="p">[</span><span class="s2">&#34;R&#34;</span><span class="p">,</span> <span class="s2">&#34;Python&#34;</span><span class="p">,</span> <span class="s2">&#34;statistics&#34;</span><span class="p">,</span> <span class="s2">&#34;regression&#34;</span><span class="p">,</span> <span class="s2">&#34;probability&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	    <span class="p">[</span><span class="s2">&#34;machine learning&#34;</span><span class="p">,</span> <span class="s2">&#34;regression&#34;</span><span class="p">,</span> <span class="s2">&#34;decision trees&#34;</span><span class="p">,</span> <span class="s2">&#34;libsvm&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	    <span class="p">[</span><span class="s2">&#34;Python&#34;</span><span class="p">,</span> <span class="s2">&#34;R&#34;</span><span class="p">,</span> <span class="s2">&#34;Java&#34;</span><span class="p">,</span> <span class="s2">&#34;C++&#34;</span><span class="p">,</span> <span class="s2">&#34;Haskell&#34;</span><span class="p">,</span> <span class="s2">&#34;programming languages&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	    <span class="p">[</span><span class="s2">&#34;statistics&#34;</span><span class="p">,</span> <span class="s2">&#34;probability&#34;</span><span class="p">,</span> <span class="s2">&#34;mathematics&#34;</span><span class="p">,</span> <span class="s2">&#34;theory&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	    <span class="p">[</span><span class="s2">&#34;machine learning&#34;</span><span class="p">,</span> <span class="s2">&#34;scikit-learn&#34;</span><span class="p">,</span> <span class="s2">&#34;Mahout&#34;</span><span class="p">,</span> <span class="s2">&#34;neural networks&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	    <span class="p">[</span><span class="s2">&#34;neural networks&#34;</span><span class="p">,</span> <span class="s2">&#34;deep learning&#34;</span><span class="p">,</span> <span class="s2">&#34;Big Data&#34;</span><span class="p">,</span> <span class="s2">&#34;artificial intelligence&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	    <span class="p">[</span><span class="s2">&#34;Hadoop&#34;</span><span class="p">,</span> <span class="s2">&#34;Java&#34;</span><span class="p">,</span> <span class="s2">&#34;MapReduce&#34;</span><span class="p">,</span> <span class="s2">&#34;Big Data&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	    <span class="p">[</span><span class="s2">&#34;statistics&#34;</span><span class="p">,</span> <span class="s2">&#34;R&#34;</span><span class="p">,</span> <span class="s2">&#34;statsmodels&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	    <span class="p">[</span><span class="s2">&#34;C++&#34;</span><span class="p">,</span> <span class="s2">&#34;deep learning&#34;</span><span class="p">,</span> <span class="s2">&#34;artificial intelligence&#34;</span><span class="p">,</span> <span class="s2">&#34;probability&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	    <span class="p">[</span><span class="s2">&#34;pandas&#34;</span><span class="p">,</span> <span class="s2">&#34;R&#34;</span><span class="p">,</span> <span class="s2">&#34;Python&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	    <span class="p">[</span><span class="s2">&#34;databases&#34;</span><span class="p">,</span> <span class="s2">&#34;HBase&#34;</span><span class="p">,</span> <span class="s2">&#34;Postgres&#34;</span><span class="p">,</span> <span class="s2">&#34;MySQL&#34;</span><span class="p">,</span> <span class="s2">&#34;MongoDB&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	    <span class="p">[</span><span class="s2">&#34;libsvm&#34;</span><span class="p">,</span> <span class="s2">&#34;regression&#34;</span><span class="p">,</span> <span class="s2">&#34;support vector machines&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="p">]</span>
</span></span></code></pre></div><h3 id="232-recommending-whats-popular">23.2 Recommending What&rsquo;s Popular<a aria-label="Link to this section" class="paige-header-link" href="#232-recommending-whats-popular"></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">		<span class="c1"># Flatten nested list</span>
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</span></span><span class="line"><span class="cl">	<span class="n">popular_interests</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">interest</span>
</span></span><span class="line"><span class="cl">	                            <span class="k">for</span> <span class="n">user_interests</span> <span class="ow">in</span> <span class="n">users_interests</span>
</span></span><span class="line"><span class="cl">	                            <span class="k">for</span> <span class="n">interest</span> <span class="ow">in</span> <span class="n">user_interests</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># Suggest the most popular interests the user currently does not have</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># CON: new users will get everything; not very personalized</span>
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">most_popular_new_interests</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">	        <span class="n">user_interests</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	        <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span></span><span class="line"><span class="cl">	    <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[(</span><span class="n">interest</span><span class="p">,</span> <span class="n">frequency</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	                   <span class="k">for</span> <span class="n">interest</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="n">popular_interests</span><span class="o">.</span><span class="n">most_common</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	                   <span class="k">if</span> <span class="n">interest</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">user_interests</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">suggestions</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
</span></span></code></pre></div><h3 id="233-user-based-collaborative-filtering">23.3 User Based Collaborative Filtering<a aria-label="Link to this section" class="paige-header-link" href="#233-user-based-collaborative-filtering"></a></h3>
<ul>
<li>Concept
<ul>
<li>Recommend other similar users who has similar interests</li>
<li>Create a user vector where each position represent a interest</li>
<li>Cosine similarity to find close users</li>
</ul>
</li>
</ul>
<p><em>CODE:</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">unique_interests</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">({</span><span class="n">interest</span>
</span></span><span class="line"><span class="cl">                           <span class="k">for</span> <span class="n">user_interests</span> <span class="ow">in</span> <span class="n">users_interests</span>
</span></span><span class="line"><span class="cl">                           <span class="k">for</span> <span class="n">interest</span> <span class="ow">in</span> <span class="n">user_interests</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># -------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Create user vector</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">make_user_interest_vector</span><span class="p">(</span><span class="n">user_interests</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Given a list of interests, produce a vector whose ith element is 1
</span></span></span><span class="line"><span class="cl"><span class="s2">    if unique_interests[i] is in the list, 0 otherwise
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">interest</span> <span class="ow">in</span> <span class="n">user_interests</span> <span class="k">else</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">interest</span> <span class="ow">in</span> <span class="n">unique_interests</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">user_interest_vectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_user_interest_vector</span><span class="p">(</span><span class="n">user_interests</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                         <span class="k">for</span> <span class="n">user_interests</span> <span class="ow">in</span> <span class="n">users_interests</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># -------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Find other simlar users</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scratch.nlp</span> <span class="kn">import</span> <span class="n">cosine_similarity</span>
</span></span><span class="line"><span class="cl"><span class="n">user_similarities</span> <span class="o">=</span> <span class="p">[[</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">interest_vector_i</span><span class="p">,</span> <span class="n">interest_vector_j</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                      <span class="k">for</span> <span class="n">interest_vector_j</span> <span class="ow">in</span> <span class="n">user_interest_vectors</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                     <span class="k">for</span> <span class="n">interest_vector_i</span> <span class="ow">in</span> <span class="n">user_interest_vectors</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">most_similar_users_to</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
</span></span><span class="line"><span class="cl">    <span class="n">pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">other_user_id</span><span class="p">,</span> <span class="n">similarity</span><span class="p">)</span>                      <span class="c1"># Find other</span>
</span></span><span class="line"><span class="cl">             <span class="k">for</span> <span class="n">other_user_id</span><span class="p">,</span> <span class="n">similarity</span> <span class="ow">in</span>                 <span class="c1"># users with</span>
</span></span><span class="line"><span class="cl">                <span class="nb">enumerate</span><span class="p">(</span><span class="n">user_similarities</span><span class="p">[</span><span class="n">user_id</span><span class="p">])</span>         <span class="c1"># nonzero</span>
</span></span><span class="line"><span class="cl">             <span class="k">if</span> <span class="n">user_id</span> <span class="o">!=</span> <span class="n">other_user_id</span> <span class="ow">and</span> <span class="n">similarity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># similarity.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span>                                      <span class="c1"># Sort them</span>
</span></span><span class="line"><span class="cl">                  <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">pair</span><span class="p">:</span> <span class="n">pair</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>                  <span class="c1"># most similar</span>
</span></span><span class="line"><span class="cl">                  <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                               <span class="c1"># first.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># -------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Suggest other users: </span>
</span></span><span class="line"><span class="cl"><span class="c1">#    - for each S similar users</span>
</span></span><span class="line"><span class="cl"><span class="c1">#    - add each S similar user&#39;s simlarity score to interest score dict</span>
</span></span><span class="line"><span class="cl"><span class="c1">#    - return top k score interest</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">user_based_suggestions</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">include_current_interests</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Sum up the similarities</span>
</span></span><span class="line"><span class="cl">    <span class="n">suggestions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">other_user_id</span><span class="p">,</span> <span class="n">similarity</span> <span class="ow">in</span> <span class="n">most_similar_users_to</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">interest</span> <span class="ow">in</span> <span class="n">users_interests</span><span class="p">[</span><span class="n">other_user_id</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="n">suggestions</span><span class="p">[</span><span class="n">interest</span><span class="p">]</span> <span class="o">+=</span> <span class="n">similarity</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Convert them to a sorted list</span>
</span></span><span class="line"><span class="cl">    <span class="n">suggestions</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">suggestions</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                         <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">pair</span><span class="p">:</span> <span class="n">pair</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># weight</span>
</span></span><span class="line"><span class="cl">                         <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># And (maybe) exclude already interests</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">include_current_interests</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">suggestions</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[(</span><span class="n">suggestion</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">suggestion</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">suggestions</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">suggestion</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">users_interests</span><span class="p">[</span><span class="n">user_id</span><span class="p">]]</span>
</span></span></code></pre></div><h3 id="234-item-based-collaborative-filtering">23.4 Item Based Collaborative Filtering<a aria-label="Link to this section" class="paige-header-link" href="#234-item-based-collaborative-filtering"></a></h3>
<ul>
<li>Compute similarities between items (aka interest directly)
<ul>
<li>suggest interests similar to the user&rsquo;s current interest</li>
</ul>
</li>
</ul>
<p><em>CODE</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Transpose our preivous user-to-interest vector to interest-to-user vector</span>
</span></span><span class="line"><span class="cl"><span class="n">interest_user_matrix</span> <span class="o">=</span> <span class="p">[[</span><span class="n">user_interest_vector</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                        <span class="k">for</span> <span class="n">user_interest_vector</span> <span class="ow">in</span> <span class="n">user_interest_vectors</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_interests</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># `unique_interests[0]` is Big Data, and so </span>
</span></span><span class="line"><span class="cl"><span class="c1">#`interest_user_matrix[0]` is: [1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">interest_similarities</span> <span class="o">=</span> <span class="p">[[</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">user_vector_i</span><span class="p">,</span> <span class="n">user_vector_j</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                          <span class="k">for</span> <span class="n">user_vector_j</span> <span class="ow">in</span> <span class="n">interest_user_matrix</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                         <span class="k">for</span> <span class="n">user_vector_i</span> <span class="ow">in</span> <span class="n">interest_user_matrix</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">most_similar_interests_to</span><span class="p">(</span><span class="n">interest_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">similarities</span> <span class="o">=</span> <span class="n">interest_similarities</span><span class="p">[</span><span class="n">interest_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">unique_interests</span><span class="p">[</span><span class="n">other_interest_id</span><span class="p">],</span> <span class="n">similarity</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="k">for</span> <span class="n">other_interest_id</span><span class="p">,</span> <span class="n">similarity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">similarities</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="k">if</span> <span class="n">interest_id</span> <span class="o">!=</span> <span class="n">other_interest_id</span> <span class="ow">and</span> <span class="n">similarity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">pair</span><span class="p">:</span> <span class="n">pair</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                  <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">item_based_suggestions</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">include_current_interests</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Add up the similar interests</span>
</span></span><span class="line"><span class="cl">    <span class="n">suggestions</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_interest_vector</span> <span class="o">=</span> <span class="n">user_interest_vectors</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">interest_id</span><span class="p">,</span> <span class="n">is_interested</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">user_interest_vector</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">is_interested</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">similar_interests</span> <span class="o">=</span> <span class="n">most_similar_interests_to</span><span class="p">(</span><span class="n">interest_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">interest</span><span class="p">,</span> <span class="n">similarity</span> <span class="ow">in</span> <span class="n">similar_interests</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">suggestions</span><span class="p">[</span><span class="n">interest</span><span class="p">]</span> <span class="o">+=</span> <span class="n">similarity</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Sort them by weight</span>
</span></span><span class="line"><span class="cl">    <span class="n">suggestions</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">suggestions</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                         <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">pair</span><span class="p">:</span> <span class="n">pair</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                         <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">include_current_interests</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">suggestions</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[(</span><span class="n">suggestion</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">suggestion</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">suggestions</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">suggestion</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">users_interests</span><span class="p">[</span><span class="n">user_id</span><span class="p">]]</span>
</span></span></code></pre></div><h3 id="235-matrix-factorization">23.5 Matrix Factorization<a aria-label="Link to this section" class="paige-header-link" href="#235-matrix-factorization"></a></h3>
<ul>
<li>
<p>Theory</p>
<ul>
<li>Users and items are represented has a latent type (ie embedding)
<ul>
<li>User matrix = numUsers by vector dim matrix</li>
</ul>
</li>
<li>Model learn the representation such that similarity_score(embedding_user, embedding_item) ~= label(ie rating)</li>
</ul>
</li>
<li>
<p>Example - MoveLens Ratings:</p>
<ul>
<li><a href="http://files.grouplens.org/datasets/movielens/ml-100k.zip">data</a>.</li>
</ul>
</li>
</ul>
<p><em>Code: Ingest Data</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="c1"># Class models</span>
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>
</span></span><span class="line"><span class="cl">	<span class="k">class</span> <span class="nc">Rating</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">	    <span class="n">movie_id</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">	    <span class="n">rating</span><span class="p">:</span> <span class="nb">float</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># Import Movie ratings</span>
</span></span><span class="line"><span class="cl">	<span class="kn">import</span> <span class="nn">csv</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># We specify this encoding to avoid a UnicodeDecodeError.</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># See: https://stackoverflow.com/a/53136168/1076346.</span>
</span></span><span class="line"><span class="cl">	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">MOVIES</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&#34;iso-8859-1&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&#34;|&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">movies</span> <span class="o">=</span> <span class="p">{</span><span class="n">movie_id</span><span class="p">:</span> <span class="n">title</span> <span class="k">for</span> <span class="n">movie_id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># Create a list of [Rating]</span>
</span></span><span class="line"><span class="cl">	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">RATINGS</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&#34;iso-8859-1&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">ratings</span> <span class="o">=</span> <span class="p">[</span><span class="n">Rating</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">movie_id</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">rating</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	               <span class="k">for</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">movie_id</span><span class="p">,</span> <span class="n">rating</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># Split data</span>
</span></span><span class="line"><span class="cl">	<span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl">	<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">split1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">split2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.85</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">train</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[:</span><span class="n">split1</span><span class="p">]</span>              <span class="c1"># 70% of the data</span>
</span></span><span class="line"><span class="cl">	<span class="n">validation</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="n">split1</span><span class="p">:</span><span class="n">split2</span><span class="p">]</span>   <span class="c1"># 15% of the data</span>
</span></span><span class="line"><span class="cl">	<span class="n">test</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="n">split2</span><span class="p">:]</span>               <span class="c1"># 15% of the data</span>
</span></span></code></pre></div><p><em>Explore Data</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># Data structure for accumulating ratings by movie_id</span>
</span></span><span class="line"><span class="cl">	<span class="n">star_wars_ratings</span> <span class="o">=</span> <span class="p">{</span><span class="n">movie_id</span><span class="p">:</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">	                     <span class="k">for</span> <span class="n">movie_id</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">movies</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	                     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&#34;Star Wars|Empire Strikes|Jedi&#34;</span><span class="p">,</span> <span class="n">title</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># Iterate over ratings, accumulating the Star Wars ones</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">if</span> <span class="n">rating</span><span class="o">.</span><span class="n">movie_id</span> <span class="ow">in</span> <span class="n">star_wars_ratings</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	        <span class="n">star_wars_ratings</span><span class="p">[</span><span class="n">rating</span><span class="o">.</span><span class="n">movie_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rating</span><span class="o">.</span><span class="n">rating</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># Compute the average rating for each movie</span>
</span></span><span class="line"><span class="cl">	<span class="n">avg_ratings</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">sum</span><span class="p">(</span><span class="n">title_ratings</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">title_ratings</span><span class="p">),</span> <span class="n">movie_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	               <span class="k">for</span> <span class="n">movie_id</span><span class="p">,</span> <span class="n">title_ratings</span> <span class="ow">in</span> <span class="n">star_wars_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># And then print them in order</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="n">avg_rating</span><span class="p">,</span> <span class="n">movie_id</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">avg_ratings</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">avg_rating</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">movies</span><span class="p">[</span><span class="n">movie_id</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p><em>Code: Baseline Mode predicts the mean</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="n">avg_rating</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">rating</span><span class="o">.</span><span class="n">rating</span> <span class="k">for</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">train</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">baseline_error</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">rating</span><span class="o">.</span><span class="n">rating</span> <span class="o">-</span> <span class="n">avg_rating</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">	                     <span class="k">for</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">test</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># This is what we hope to do better than</span>
</span></span><span class="line"><span class="cl">	<span class="k">assert</span> <span class="mf">1.26</span> <span class="o">&lt;</span> <span class="n">baseline_error</span> <span class="o">&lt;</span> <span class="mf">1.27</span>
</span></span></code></pre></div><p>_Code: Create User and Item Embedding (Random Initially) _</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">scratch.deep_learning</span> <span class="kn">import</span> <span class="n">random_tensor</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">EMBEDDING_DIM</span> <span class="o">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># Find unique ids</span>
</span></span><span class="line"><span class="cl">	<span class="n">user_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">rating</span><span class="o">.</span><span class="n">user_id</span> <span class="k">for</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">movie_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">rating</span><span class="o">.</span><span class="n">movie_id</span> <span class="k">for</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># Then create a random vector per id</span>
</span></span><span class="line"><span class="cl">	<span class="n">user_vectors</span> <span class="o">=</span> <span class="p">{</span><span class="n">user_id</span><span class="p">:</span> <span class="n">random_tensor</span><span class="p">(</span><span class="n">EMBEDDING_DIM</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	                <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">user_ids</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">movie_vectors</span> <span class="o">=</span> <span class="p">{</span><span class="n">movie_id</span><span class="p">:</span> <span class="n">random_tensor</span><span class="p">(</span><span class="n">EMBEDDING_DIM</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	                 <span class="k">for</span> <span class="n">movie_id</span> <span class="ow">in</span> <span class="n">movie_ids</span><span class="p">}</span>
</span></span></code></pre></div><p><em>Code: Training Loop</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span></span><span class="line"><span class="cl">	<span class="kn">import</span> <span class="nn">tqdm</span>
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">scratch.linear_algebra</span> <span class="kn">import</span> <span class="n">dot</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">loop</span><span class="p">(</span><span class="n">dataset</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Rating</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	         <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">with</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	        <span class="n">loss</span> <span class="o">=</span> <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl">	        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rating</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	            <span class="n">movie_vector</span> <span class="o">=</span> <span class="n">movie_vectors</span><span class="p">[</span><span class="n">rating</span><span class="o">.</span><span class="n">movie_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	            <span class="n">user_vector</span> <span class="o">=</span> <span class="n">user_vectors</span><span class="p">[</span><span class="n">rating</span><span class="o">.</span><span class="n">user_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	            <span class="n">predicted</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">user_vector</span><span class="p">,</span> <span class="n">movie_vector</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	            <span class="n">error</span> <span class="o">=</span> <span class="n">predicted</span> <span class="o">-</span> <span class="n">rating</span><span class="o">.</span><span class="n">rating</span>
</span></span><span class="line"><span class="cl">	            <span class="n">loss</span> <span class="o">+=</span> <span class="n">error</span> <span class="o">**</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	            <span class="k">if</span> <span class="n">learning_rate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	                <span class="c1">#     predicted = m_0 * u_0 + ... + m_k * u_k</span>
</span></span><span class="line"><span class="cl">	                <span class="c1"># So each u_j enters output with coefficent m_j</span>
</span></span><span class="line"><span class="cl">	                <span class="c1"># and each m_j enters output with coefficient u_j</span>
</span></span><span class="line"><span class="cl">	                <span class="n">user_gradient</span> <span class="o">=</span> <span class="p">[</span><span class="n">error</span> <span class="o">*</span> <span class="n">m_j</span> <span class="k">for</span> <span class="n">m_j</span> <span class="ow">in</span> <span class="n">movie_vector</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	                <span class="n">movie_gradient</span> <span class="o">=</span> <span class="p">[</span><span class="n">error</span> <span class="o">*</span> <span class="n">u_j</span> <span class="k">for</span> <span class="n">u_j</span> <span class="ow">in</span> <span class="n">user_vector</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	                <span class="c1"># Take gradient steps</span>
</span></span><span class="line"><span class="cl">	                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">EMBEDDING_DIM</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	                    <span class="n">user_vector</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">learning_rate</span> <span class="o">*</span> <span class="n">user_gradient</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	                    <span class="n">movie_vector</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">learning_rate</span> <span class="o">*</span> <span class="n">movie_gradient</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	            <span class="n">t</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;avg loss: </span><span class="si">{</span><span class="n">loss</span> <span class="o">/</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p><em>Code: HyperParameter Tuning</em></p>
<ul>
<li>Decrease learning rate</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	<span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.05</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	    <span class="n">learning_rate</span> <span class="o">*=</span> <span class="mf">0.9</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">print</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">loop</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">loop</span><span class="p">(</span><span class="n">validation</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">loop</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</span></span></code></pre></div><h1 id="24-database-and-sql">24 Database and SQL<a aria-label="Link to this section" class="paige-header-link" href="#24-database-and-sql"></a></h1>
<h3 id="241-create-and-insert">24.1 Create and Insert<a aria-label="Link to this section" class="paige-header-link" href="#241-create-and-insert"></a></h3>
<h3 id="242-update">24.2 Update<a aria-label="Link to this section" class="paige-header-link" href="#242-update"></a></h3>
<h3 id="243-delete">24.3 Delete<a aria-label="Link to this section" class="paige-header-link" href="#243-delete"></a></h3>
<h3 id="244-select">24.4 Select<a aria-label="Link to this section" class="paige-header-link" href="#244-select"></a></h3>
<h3 id="245-group-by">24.5 Group By<a aria-label="Link to this section" class="paige-header-link" href="#245-group-by"></a></h3>
<h3 id="246-order-by">24.6 Order By<a aria-label="Link to this section" class="paige-header-link" href="#246-order-by"></a></h3>
<h3 id="247-join">24.7 Join<a aria-label="Link to this section" class="paige-header-link" href="#247-join"></a></h3>
<h3 id="248-query-optimization">24.8 Query Optimization<a aria-label="Link to this section" class="paige-header-link" href="#248-query-optimization"></a></h3>
<h3 id="249-nosql">24.9 NoSQL<a aria-label="Link to this section" class="paige-header-link" href="#249-nosql"></a></h3>
<h1 id="25-mapreduce">25 MapReduce<a aria-label="Link to this section" class="paige-header-link" href="#25-mapreduce"></a></h1>
<h3 id="251-example-word-count">25.1 Example: Word Count<a aria-label="Link to this section" class="paige-header-link" href="#251-example-word-count"></a></h3>
<h3 id="252-why-mapreduce">25.2 Why MapReduce<a aria-label="Link to this section" class="paige-header-link" href="#252-why-mapreduce"></a></h3>
<h3 id="253-mapreduce-more-generally">25.3 MapReduce More Generally<a aria-label="Link to this section" class="paige-header-link" href="#253-mapreduce-more-generally"></a></h3>
<h3 id="254-example-analyzing-status-update">25.4 Example: Analyzing Status Update<a aria-label="Link to this section" class="paige-header-link" href="#254-example-analyzing-status-update"></a></h3>
<h3 id="255-example-matrix-multiplication">25.5 Example: Matrix Multiplication<a aria-label="Link to this section" class="paige-header-link" href="#255-example-matrix-multiplication"></a></h3>
<h3 id="256-combiners">25.6 Combiners<a aria-label="Link to this section" class="paige-header-link" href="#256-combiners"></a></h3>
</div>


    </div>
</article>




    
    



    



    



    



    



    



    



    



    







                        
                    </main>

                    









    

    


<footer class="mb-3" id="paige-footer">
    

    
        <div class="mb-3" id="paige-prev-next">
            
                <p class="mb-0 text-center text-secondary" id="paige-next">
                    <a class="link-secondary" href="http://localhost:1313/books/machine-learning/essential-math-for-data-science/">Essential Math For Data Science</a> &rsaquo;
                </p>
            

            
        </div>
    

    

    

    

    
</footer>

                </div>
            </div>
        </div>

        















    
    
    


<script  crossorigin="anonymous"   defer  integrity="sha256-gfPiYYSP&#43;RNtNeRBt45mJombFJmNf0V0Ipu785Obi0M="   referrerpolicy="no-referrer"  src="/js/paige/bootstrap/bootstrap.bundle.min.81f3e261848ff9136d35e441b78e6626899b14998d7f4574229bbbf3939b8b43.js" ></script>



    













    
    
    


<script  crossorigin="anonymous"   defer  integrity="sha256-kqnbKZyzZFmn0J2JtRxwdeNh0b3FknYDyAd&#43;mGKI73c="   referrerpolicy="no-referrer"  src="/js/paige/katex/katex.min.min.92a9db299cb36459a7d09d89b51c7075e361d1bdc5927603c8077e986288ef77.js" ></script>

    













    
    
    


<script  crossorigin="anonymous"   defer  integrity="sha256-pQMCGuz&#43;5jpyog4zEVyH/xvxJRsPM9M7d7t6&#43;TiyEA8="  onload="renderMathInElement(document.body);"   referrerpolicy="no-referrer"  src="/js/paige/katex/auto-render.min.min.a503021aecfee63a72a20e33115c87ff1bf1251b0f33d33b77bb7af938b2100f.js" ></script>






    



    



    



    



    



    



    



    



    



    



    



    



    



    



    





<noscript>JavaScript is required</noscript>


        
    </body>
</html>
